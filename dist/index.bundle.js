/*! For license information please see index.bundle.js.LICENSE.txt */
(()=>{var e,t,r,s,n,a,i,o,c={265:(e,t,r)=>{"use strict";e=r.nmd(e);const s=(e=0)=>t=>`[${38+e};5;${t}m`,n=(e=0)=>(t,r,s)=>`[${38+e};2;${t};${r};${s}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,s]of Object.entries(t)){for(const[r,n]of Object.entries(s))t[r]={open:`[${n[0]}m`,close:`[${n[1]}m`},s[r]=t[r],e.set(n[0],n[1]);Object.defineProperty(t,r,{value:s,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=s(),t.color.ansi16m=n(),t.bgColor.ansi256=s(10),t.bgColor.ansi16m=n(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map((e=>e+e)).join(""));const s=Number.parseInt(r,16);return[s>>16&255,s>>8&255,255&s]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},1156:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});const s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const a=new Uint8Array(16);function i(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(a)}const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));const c=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();const n=(e=e||{}).random||(e.rng||i)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}(n)}},9743:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Headers:()=>i,Request:()=>o,Response:()=>c,default:()=>a,fetch:()=>n});var s=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();const n=s.fetch,a=s.fetch.bind(s),i=s.Headers,o=s.Request,c=s.Response},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=c(e),r=t[0],s=t[1];return 3*(r+s)/4-s},t.toByteArray=function(e){var t,r,a=c(e),i=a[0],o=a[1],l=new n(function(e,t,r){return 3*(t+r)/4-r}(0,i,o)),u=0,d=o>0?i-4:i;for(r=0;r<d;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===o&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,l[u++]=255&t),1===o&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,s=e.length,n=s%3,a=[],i=16383,o=0,c=s-n;o<c;o+=i)a.push(l(e,o,o+i>c?c:o+i));return 1===n?(t=e[s-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[s-2]<<8)+e[s-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],s=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=a.length;i<o;++i)r[i]=a[i],s[a.charCodeAt(i)]=i;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,s){for(var n,a,i=[],o=t;o<s;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(r[(a=n)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},7513:e=>{e.exports=function(e,t,r,s,n){var a,i;if(void 0===s)s=0;else if((s|=0)<0||s>=e.length)throw new RangeError("invalid lower bound");if(void 0===n)n=e.length-1;else if((n|=0)<s||n>=e.length)throw new RangeError("invalid upper bound");for(;s<=n;)if((i=+r(e[a=s+(n-s>>>1)],t,a,e))<0)s=a+1;else{if(!(i>0))return a;n=a-1}return~s}},3204:e=>{"use strict";const t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,s=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,i=new RegExp("^"+a.source),o=new RegExp(a.source+n.source,"gu"),c=new RegExp("\\d+"+n.source,"gu"),l=(e,n)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(n={pascalCase:!1,preserveConsecutiveUppercase:!1,...n},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const a=!1===n.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(n.locale),l=!1===n.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(n.locale);return 1===e.length?n.pascalCase?l(e):a(e):(e!==a(e)&&(e=((e,s,n)=>{let a=!1,i=!1,o=!1;for(let c=0;c<e.length;c++){const l=e[c];a&&t.test(l)?(e=e.slice(0,c)+"-"+e.slice(c),a=!1,o=i,i=!0,c++):i&&o&&r.test(l)?(e=e.slice(0,c-1)+"-"+e.slice(c-1),o=i,i=!1,a=!0):(a=s(l)===l&&n(l)!==l,o=i,i=n(l)===l&&s(l)!==l)}return e})(e,a,l)),e=e.replace(i,""),e=n.preserveConsecutiveUppercase?((e,t)=>(s.lastIndex=0,e.replace(s,(e=>t(e)))))(e,a):a(e),n.pascalCase&&(e=l(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,c.lastIndex=0,e.replace(o,((e,r)=>t(r))).replace(c,(e=>t(e)))))(e,l))};e.exports=l,e.exports.default=l},2466:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function s(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,s,a,i){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new n(s,a||e,i),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],o]:e._events[c].push(o):(e._events[c]=o,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,s,n=[];if(0===this._eventsCount)return n;for(s in e=this._events)t.call(e,s)&&n.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,a=s.length,i=new Array(a);n<a;n++)i[n]=s[n].fn;return i},o.prototype.listenerCount=function(e){var t=r?r+e:e,s=this._events[t];return s?s.fn?1:s.length:0},o.prototype.emit=function(e,t,s,n,a,i){var o=r?r+e:e;if(!this._events[o])return!1;var c,l,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,s),!0;case 4:return u.fn.call(u.context,t,s,n),!0;case 5:return u.fn.call(u.context,t,s,n,a),!0;case 6:return u.fn.call(u.context,t,s,n,a,i),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,s);break;case 4:u[l].fn.call(u[l].context,t,s,n);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,s,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||n&&!o.once||s&&o.context!==s||i(this,a);else{for(var c=0,l=[],u=o.length;c<u;c++)(o[c].fn!==t||n&&!o[c].once||s&&o[c].context!==s)&&l.push(o[c]);l.length?this._events[a]=1===l.length?l[0]:l:i(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},6563:(e,t)=>{"use strict"},7345:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},5860:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6729),n=r(8147),a=r(6506),i=()=>{},o=new n.TimeoutError;t.default=class extends s{constructor(e){var t,r,s,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=i,this._resolveIdle=i,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(s=e.interval)||void 0===s?void 0:s.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=i,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=i,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,s)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const a=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&s(o)}));r(await a)}catch(e){s(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},7489:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let s=0,n=e.length;for(;n>0;){const a=n/2|0;let i=s+a;r(e[i],t)<=0?(s=++i,n-=a+1):n=a}return s}},6506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(7489);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const n=s.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(n,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},2693:(e,t,r)=>{"use strict";const s=r(8837),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class a extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const i=(e,t)=>new Promise(((r,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=s.operation(t);o.attempt((async s=>{try{r(await e(s))}catch(e){if(!(e instanceof Error))return void i(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof a)o.stop(),i(e.originalError);else if(e instanceof TypeError&&(c=e.message,!n.includes(c)))o.stop(),i(e);else{((e,t,r)=>{const s=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=s})(e,s,t);try{await t.onFailedAttempt(e)}catch(e){return void i(e)}o.retry(e)||i(o.mainError())}}var c}))}));e.exports=i,e.exports.default=i,e.exports.AbortError=a},8837:(e,t,r)=>{e.exports=r(2280)},2280:(e,t,r)=>{var s=r(793);t.operation=function(e){var r=t.timeouts(e);return new s(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],n=0;n<t.retries;n++)s.push(this.createTimeout(n,t));return e&&e.forever&&!s.length&&s.push(this.createTimeout(n,t)),s.sort((function(e,t){return e-t})),s},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,s=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(s,t.maxTimeout)},t.wrap=function(e,r,s){if(r instanceof Array&&(s=r,r=null),!s)for(var n in s=[],e)"function"==typeof e[n]&&s.push(n);for(var a=0;a<s.length;a++){var i=s[a],o=e[i];e[i]=function(s){var n=t.operation(r),a=Array.prototype.slice.call(arguments,1),i=a.pop();a.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),i.apply(this,arguments))})),n.attempt((function(){s.apply(e,a)}))}.bind(e,o),e[i].options=r}}},793:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var s=this;return this._timer=setTimeout((function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout((function(){s._operationTimeoutCb(s._attempts)}),s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,s=0;s<this._errors.length;s++){var n=this._errors[s],a=n.message,i=(e[a]||0)+1;e[a]=i,i>=r&&(t=n,r=i)}return t}},8147:(e,t,r)=>{"use strict";const s=r(7345);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}const a=(e,t,r)=>new Promise(((a,i)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);const o=setTimeout((()=>{if("function"==typeof r){try{a(r())}catch(e){i(e)}return}const s=r instanceof Error?r:new n("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),i(s)}),t);s(e.then(a,i),(()=>{clearTimeout(o)}))}));e.exports=a,e.exports.default=a,e.exports.TimeoutError=n},8841:(e,t,r)=>{"use strict";t.Y_=void 0;const s=r(4357);Object.defineProperty(t,"Y_",{enumerable:!0,get:function(){return s.zodToJsonSchema}}),s.zodToJsonSchema},7181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultOptions=t.defaultOptions=void 0,t.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1},t.getDefaultOptions=e=>"string"==typeof e?Object.assign(Object.assign({},t.defaultOptions),{name:e}):Object.assign(Object.assign({},t.defaultOptions),e)},1908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRefs=void 0;const s=r(7181);t.getRefs=e=>{const t=(0,s.getDefaultOptions)(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return Object.assign(Object.assign({},t),{currentPath:r,propertyPath:void 0,seen:[]})}},6519:(e,t)=>{"use strict";function r(e,t,r,s){(null==s?void 0:s.errorMessages)&&r&&(e.errorMessage=Object.assign(Object.assign({},e.errorMessage),{[t]:r}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setResponseValueAndErrors=t.addErrorMessage=void 0,t.addErrorMessage=r,t.setResponseValueAndErrors=function(e,t,s,n,a){e[t]=s,r(e,t,n,a)}},9959:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDef=void 0;const s=r(8754),n=r(6840),a=r(2886),i=r(2722),o=r(5823),c=r(423),l=r(9444),u=r(4117),d=r(3245),h=r(4804),p=r(2105),f=r(2734),m=r(8392),g=r(8716),y=r(2295),b=r(2200),v=r(5907),_=r(993),w=r(8490),O=r(938),k=r(8289),P=r(1250),T=r(9033),x=r(3564),I=r(9226),A=r(9229),E=r(3133),S=r(9646),j=r(8e3),C=r(34);function R(e,t){const r=t.seen.find((t=>Object.is(t.def,e)));if(r)return N(r,t);const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.push(s);const n=L(e,e.typeName,t);return n&&D(e,n),s.jsonSchema=n,n}t.parseDef=R;const N=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:0===e.path.length?"":1===e.path.length?`${e.path[0]}/`:e.path.join("/")};case"relative":return{$ref:$(t.currentPath,e.path)};case"none":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):e.jsonSchema}},$=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},L=(e,t,r)=>{switch(t){case s.ZodFirstPartyTypeKind.ZodString:return(0,A.parseStringDef)(e,r);case s.ZodFirstPartyTypeKind.ZodNumber:return(0,w.parseNumberDef)(e,r);case s.ZodFirstPartyTypeKind.ZodObject:return(0,O.parseObjectDef)(e,r);case s.ZodFirstPartyTypeKind.ZodBigInt:return(0,i.parseBigintDef)();case s.ZodFirstPartyTypeKind.ZodBoolean:return(0,o.parseBooleanDef)();case s.ZodFirstPartyTypeKind.ZodDate:return(0,u.parseDateDef)();case s.ZodFirstPartyTypeKind.ZodUndefined:return(0,S.parseUndefinedDef)();case s.ZodFirstPartyTypeKind.ZodNull:return(0,v.parseNullDef)(r);case s.ZodFirstPartyTypeKind.ZodArray:return(0,a.parseArrayDef)(e,r);case s.ZodFirstPartyTypeKind.ZodUnion:case s.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,j.parseUnionDef)(e,r);case s.ZodFirstPartyTypeKind.ZodIntersection:return(0,f.parseIntersectionDef)(e,r);case s.ZodFirstPartyTypeKind.ZodTuple:return(0,E.parseTupleDef)(e,r);case s.ZodFirstPartyTypeKind.ZodRecord:return(0,x.parseRecordDef)(e,r);case s.ZodFirstPartyTypeKind.ZodLiteral:return(0,m.parseLiteralDef)(e,r);case s.ZodFirstPartyTypeKind.ZodEnum:return(0,p.parseEnumDef)(e);case s.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,y.parseNativeEnumDef)(e);case s.ZodFirstPartyTypeKind.ZodNullable:return(0,_.parseNullableDef)(e,r);case s.ZodFirstPartyTypeKind.ZodOptional:return(0,k.parseOptionalDef)(e,r);case s.ZodFirstPartyTypeKind.ZodMap:return(0,g.parseMapDef)(e,r);case s.ZodFirstPartyTypeKind.ZodSet:return(0,I.parseSetDef)(e,r);case s.ZodFirstPartyTypeKind.ZodLazy:return R(e.getter()._def,r);case s.ZodFirstPartyTypeKind.ZodPromise:return(0,T.parsePromiseDef)(e,r);case s.ZodFirstPartyTypeKind.ZodNaN:case s.ZodFirstPartyTypeKind.ZodNever:return(0,b.parseNeverDef)();case s.ZodFirstPartyTypeKind.ZodEffects:return(0,h.parseEffectsDef)(e,r);case s.ZodFirstPartyTypeKind.ZodAny:return(0,n.parseAnyDef)();case s.ZodFirstPartyTypeKind.ZodUnknown:return(0,C.parseUnknownDef)();case s.ZodFirstPartyTypeKind.ZodDefault:return(0,d.parseDefaultDef)(e,r);case s.ZodFirstPartyTypeKind.ZodBranded:return(0,c.parseBrandedDef)(e,r);case s.ZodFirstPartyTypeKind.ZodCatch:return(0,l.parseCatchDef)(e,r);case s.ZodFirstPartyTypeKind.ZodPipeline:return(0,P.parsePipelineDef)(e,r);case s.ZodFirstPartyTypeKind.ZodFunction:case s.ZodFirstPartyTypeKind.ZodVoid:case s.ZodFirstPartyTypeKind.ZodSymbol:default:return}},D=(e,t)=>(e.description&&(t.description=e.description),t)},6840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAnyDef=void 0,t.parseAnyDef=function(){return{}}},2886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseArrayDef=void 0;const s=r(8754),n=r(6519),a=r(9959);t.parseArrayDef=function(e,t){var r,i;const o={type:"array"};return(null===(i=null===(r=e.type)||void 0===r?void 0:r._def)||void 0===i?void 0:i.typeName)!==s.ZodFirstPartyTypeKind.ZodAny&&(o.items=(0,a.parseDef)(e.type._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))),e.minLength&&(0,n.setResponseValueAndErrors)(o,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&(0,n.setResponseValueAndErrors)(o,"maxItems",e.maxLength.value,e.maxLength.message,t),o}},2722:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBigintDef=void 0,t.parseBigintDef=function(){return{type:"integer",format:"int64"}}},5823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBooleanDef=void 0,t.parseBooleanDef=function(){return{type:"boolean"}}},423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBrandedDef=void 0;const s=r(9959);t.parseBrandedDef=function(e,t){return(0,s.parseDef)(e.type._def,t)}},9444:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCatchDef=void 0;const s=r(9959);t.parseCatchDef=(e,t)=>(0,s.parseDef)(e.innerType._def,t)},4117:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDateDef=void 0,t.parseDateDef=function(){return{type:"string",format:"date-time"}}},3245:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDefaultDef=void 0;const s=r(9959);t.parseDefaultDef=function(e,t){return Object.assign(Object.assign({},(0,s.parseDef)(e.innerType._def,t)),{default:e.defaultValue()})}},4804:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEffectsDef=void 0;const s=r(9959);t.parseEffectsDef=function(e,t){return"input"===t.effectStrategy?(0,s.parseDef)(e.schema._def,t):{}}},2105:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEnumDef=void 0,t.parseEnumDef=function(e){return{type:"string",enum:e.values}}},2734:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIntersectionDef=void 0;const s=r(9959);t.parseIntersectionDef=function(e,t){const r=[(0,s.parseDef)(e.left._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]})),(0,s.parseDef)(e.right._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","1"]}))].filter((e=>!!e));return r.length?{allOf:r}:void 0}},8392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLiteralDef=void 0,t.parseLiteralDef=function(e,t){const r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}},8716:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMapDef=void 0;const s=r(9959);t.parseMapDef=function(e,t){return{type:"array",maxItems:125,items:{type:"array",items:[(0,s.parseDef)(e.keyType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","0"]}))||{},(0,s.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","1"]}))||{}],minItems:2,maxItems:2}}}},2295:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNativeEnumDef=void 0,t.parseNativeEnumDef=function(e){const t=e.values,r=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),s=Array.from(new Set(r.map((e=>typeof e))));return{type:1===s.length?"string"===s[0]?"string":"number":["string","number"],enum:r}}},2200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNeverDef=void 0,t.parseNeverDef=function(){return{not:{}}}},5907:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullDef=void 0,t.parseNullDef=function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}},993:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullableDef=void 0;const s=r(9959),n=r(8e3);t.parseNullableDef=function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:n.primitiveMappings[e.innerType._def.typeName],nullable:!0}:{type:[n.primitiveMappings[e.innerType._def.typeName],"null"]};const r=(0,s.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","0"]}));return r?"openApi3"===t.target?Object.assign(Object.assign({},r),{nullable:!0}):{anyOf:[r,{type:"null"}]}:void 0}},8490:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNumberDef=void 0;const s=r(6519);t.parseNumberDef=function(e,t){const r={type:"number"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"int":r.type="integer",(0,s.addErrorMessage)(r,"type",n.message,t);break;case"min":"jsonSchema7"===t.target?n.inclusive?(0,s.setResponseValueAndErrors)(r,"minimum",n.value,n.message,t):(0,s.setResponseValueAndErrors)(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),(0,s.setResponseValueAndErrors)(r,"minimum",n.value,n.message,t));break;case"max":"jsonSchema7"===t.target?n.inclusive?(0,s.setResponseValueAndErrors)(r,"maximum",n.value,n.message,t):(0,s.setResponseValueAndErrors)(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),(0,s.setResponseValueAndErrors)(r,"maximum",n.value,n.message,t));break;case"multipleOf":(0,s.setResponseValueAndErrors)(r,"multipleOf",n.value,n.message,t)}return r}},938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseObjectDef=void 0;const s=r(9959);t.parseObjectDef=function(e,t){var r;const n=Object.assign(Object.assign({type:"object"},Object.entries(e.shape()).reduce(((e,[r,n])=>{if(void 0===n||void 0===n._def)return e;const a=(0,s.parseDef)(n._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]}));return void 0===a?e:{properties:Object.assign(Object.assign({},e.properties),{[r]:a}),required:n.isOptional()?e.required:[...e.required,r]}}),{properties:{},required:[]})),{additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(r=(0,s.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===r||r});return n.required.length||delete n.required,n}},8289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseOptionalDef=void 0;const s=r(9959);t.parseOptionalDef=(e,t)=>{var r;if(t.currentPath.toString()===(null===(r=t.propertyPath)||void 0===r?void 0:r.toString()))return(0,s.parseDef)(e.innerType._def,t);const n=(0,s.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","1"]}));return n?{anyOf:[{not:{}},n]}:{}}},1250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePipelineDef=void 0;const s=r(9959);t.parsePipelineDef=(e,t)=>{const r=(0,s.parseDef)(e.in._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]}));return{allOf:[r,(0,s.parseDef)(e.out._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf",r?"1":"0"]}))].filter((e=>void 0!==e))}}},9033:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePromiseDef=void 0;const s=r(9959);t.parsePromiseDef=function(e,t){return(0,s.parseDef)(e.type._def,t)}},3564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseRecordDef=void 0;const s=r(8754),n=r(9959),a=r(9229);t.parseRecordDef=function(e,t){var r,i,o;const c={type:"object",additionalProperties:(0,n.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]}))||{}};if((null===(r=e.keyType)||void 0===r?void 0:r._def.typeName)===s.ZodFirstPartyTypeKind.ZodString&&(null===(i=e.keyType._def.checks)||void 0===i?void 0:i.length)){const r=Object.entries((0,a.parseStringDef)(e.keyType._def,t)).reduce(((e,[t,r])=>"type"===t?e:Object.assign(Object.assign({},e),{[t]:r})),{});return Object.assign(Object.assign({},c),{propertyNames:r})}return(null===(o=e.keyType)||void 0===o?void 0:o._def.typeName)===s.ZodFirstPartyTypeKind.ZodEnum?Object.assign(Object.assign({},c),{propertyNames:{enum:e.keyType._def.values}}):c}},9226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSetDef=void 0;const s=r(6519),n=r(9959);t.parseSetDef=function(e,t){const r={type:"array",items:(0,n.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))};return e.minSize&&(0,s.setResponseValueAndErrors)(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&(0,s.setResponseValueAndErrors)(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}},9229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringDef=void 0;const s=r(6519);t.parseStringDef=function(e,t){const r={type:"string"};if(e.checks)for(const i of e.checks)switch(i.kind){case"min":(0,s.setResponseValueAndErrors)(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":(0,s.setResponseValueAndErrors)(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":(0,s.setResponseValueAndErrors)(r,"format","email",i.message,t);break;case"url":(0,s.setResponseValueAndErrors)(r,"format","uri",i.message,t);break;case"uuid":(0,s.setResponseValueAndErrors)(r,"format","uuid",i.message,t);break;case"regex":a(r,i.regex.source,i.message,t);break;case"cuid":a(r,"^c[^\\s-]{8,}$",i.message,t);break;case"cuid2":a(r,"^[a-z][a-z0-9]*$",i.message,t);break;case"startsWith":a(r,"^"+n(i.value),i.message,t);break;case"endsWith":a(r,n(i.value)+"$",i.message,t);break;case"trim":break;case"datetime":(0,s.setResponseValueAndErrors)(r,"format","date-time",i.message,t);break;case"length":(0,s.setResponseValueAndErrors)(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),(0,s.setResponseValueAndErrors)(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t)}return r};const n=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),a=(e,t,r,n)=>{var a;e.pattern||(null===(a=e.allOf)||void 0===a?void 0:a.some((e=>e.pattern)))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push(Object.assign({pattern:e.pattern},e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}})),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push(Object.assign({pattern:t},r&&n.errorMessages&&{errorMessage:{pattern:r}}))):(0,s.setResponseValueAndErrors)(e,"pattern",t,r,n)}},3133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseTupleDef=void 0;const s=r(9959);t.parseTupleDef=function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,r)=>(0,s.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]})))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:(0,s.parseDef)(e.rest._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalItems"]}))}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,r)=>(0,s.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]})))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}},9646:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUndefinedDef=void 0,t.parseUndefinedDef=function(){return{not:{}}}},8e3:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnionDef=t.primitiveMappings=void 0;const s=r(9959);t.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},t.parseUnionDef=function(e,r){if("openApi3"===r.target)return n(e,r);const s=e.options instanceof Map?Array.from(e.options.values()):e.options;if(s.every((e=>e._def.typeName in t.primitiveMappings&&(!e._def.checks||!e._def.checks.length)))){const e=s.reduce(((e,r)=>{const s=t.primitiveMappings[r._def.typeName];return s&&!e.includes(s)?[...e,s]:e}),[]);return{type:e.length>1?e:e[0]}}if(s.every((e=>"ZodLiteral"===e._def.typeName))){const e=s.reduce(((e,t)=>{const r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===s.length){const t=e.filter(((e,t,r)=>r.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:s.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(s.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:s.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return n(e,r)};const n=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,r)=>(0,s.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf",`${r}`]})))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return r.length?{anyOf:r}:void 0}},34:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnknownDef=void 0,t.parseUnknownDef=function(){return{}}},4357:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;const s=r(9959),n=r(1908);t.zodToJsonSchema=(e,t)=>{var r;const a=(0,n.getRefs)(t),i="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>{var n;return Object.assign(Object.assign({},e),{[t]:null!==(n=(0,s.parseDef)(r._def,Object.assign(Object.assign({},a),{currentPath:[...a.basePath,a.definitionPath,t]})))&&void 0!==n?n:{}})}),{}):void 0,o="string"==typeof t?t:null==t?void 0:t.name,c=null!==(r=(0,s.parseDef)(e._def,void 0===o?a:Object.assign(Object.assign({},a),{currentPath:[...a.basePath,a.definitionPath,o]})))&&void 0!==r?r:{},l=void 0===o?i?Object.assign(Object.assign({},c),{[a.definitionPath]:i}):c:{$ref:[..."relative"===a.$refStrategy?[]:a.basePath,a.definitionPath,o].join("/"),[a.definitionPath]:Object.assign(Object.assign({},i),{[o]:c})};return"jsonSchema7"===a.target&&(l.$schema="http://json-schema.org/draft-07/schema#"),l}},8280:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;const s=r(9110);t.ZodIssueCode=s.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class n extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},s=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(s);else if("invalid_return_type"===n.code)s(n.returnTypeError);else if("invalid_arguments"===n.code)s(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,s=0;for(;s<n.path.length;){const r=n.path[s];s===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],s++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,s.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=n,n.create=e=>new n(e)},6996:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;const n=s(r(9349));t.defaultErrorMap=n.default;let a=n.default;t.setErrorMap=function(e){a=e},t.getErrorMap=function(){return a}},6349:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(6996),t),n(r(3187),t),n(r(116),t),n(r(9110),t),n(r(5433),t),n(r(8280),t)},8762:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,(r=t.errorUtil||(t.errorUtil={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},r.toString=e=>"string"==typeof e?e:null==e?void 0:e.message},3187:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;const n=r(6996),a=s(r(9349));t.makeIssue=e=>{const{data:t,path:r,errorMaps:s,issueData:n}=e,a=[...r,...n.path||[]],i={...n,path:a};let o="";const c=s.filter((e=>!!e)).slice().reverse();for(const e of c)o=e(i,{data:t,defaultError:o}).message;return{...n,path:a,message:n.message||o}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,r){const s=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,(0,n.getErrorMap)(),a.default].filter((e=>!!e))});e.common.issues.push(s)};class i{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){const s=[];for(const n of r){if("aborted"===n.status)return t.INVALID;"dirty"===n.status&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const r=[];for(const e of t)r.push({key:await e.key,value:await e.value});return i.mergeObjectSync(e,r)}static mergeObjectSync(e,r){const s={};for(const n of r){const{key:r,value:a}=n;if("aborted"===r.status)return t.INVALID;if("aborted"===a.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===r.value||void 0===a.value&&!n.alwaysSet||(s[r.value]=a.value)}return{status:e.value,value:s}}}t.ParseStatus=i,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},116:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9110:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),s={};for(const e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r=t.util||(t.util={})),(t.objectUtil||(t.objectUtil={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":return Array.isArray(e)?t.ZodParsedType.array:null===e?t.ZodParsedType.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?t.ZodParsedType.promise:"undefined"!=typeof Map&&e instanceof Map?t.ZodParsedType.map:"undefined"!=typeof Set&&e instanceof Set?t.ZodParsedType.set:"undefined"!=typeof Date&&e instanceof Date?t.ZodParsedType.date:t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},8754:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;const o=a(r(6349));t.z=o,i(r(6349),t),t.default=o},9349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9110),n=r(8280);t.default=(e,t)=>{let r;switch(e.code){case n.ZodIssueCode.invalid_type:r=e.received===s.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case n.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,s.util.jsonStringifyReplacer)}`;break;case n.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${s.util.joinValues(e.keys,", ")}`;break;case n.ZodIssueCode.invalid_union:r="Invalid input";break;case n.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${s.util.joinValues(e.options)}`;break;case n.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${s.util.joinValues(e.options)}, received '${e.received}'`;break;case n.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case n.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case n.ZodIssueCode.invalid_date:r="Invalid date";break;case n.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:s.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case n.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case n.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case n.ZodIssueCode.custom:r="Invalid input";break;case n.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case n.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case n.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,s.util.assertNever(e)}return{message:r}}},5433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.date=t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=void 0;const s=r(6996),n=r(8762),a=r(3187),i=r(9110),o=r(8280);class c{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const l=(e,t)=>{if((0,a.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new o.ZodError(e.common.issues);return this._error=t,this._error}}};function u(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:s,description:n}=e;if(t&&(r||s))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=s?s:t.defaultError}:{message:null!=r?r:t.defaultError},description:n}}class d{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return(0,i.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,i.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new a.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,i.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if((0,a.isAsync)(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,i.getParsedType)(e)},n=this._parseSync({data:e,path:s.path,parent:s});return l(s,n)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,i.getParsedType)(e)},s=this._parse({data:e,path:r.path,parent:r}),n=await((0,a.isAsync)(s)?s:Promise.resolve(s));return l(r,n)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,s)=>{const n=e(t),a=()=>s.addIssue({code:o.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>!!e||(a(),!1))):!!n||(a(),!1)}))}refinement(e,t){return this._refinement(((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1)))}_refinement(e){return new Y({schema:this,typeName:oe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Q.create(this,this._def)}nullable(){return ee.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return R.create(this,this._def)}promise(){return X.create(this,this._def)}or(e){return L.create([this,e],this._def)}and(e){return U.create(this,e,this._def)}transform(e){return new Y({...u(this._def),schema:this,typeName:oe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new te({...u(this._def),innerType:this,defaultValue:t,typeName:oe.ZodDefault})}brand(){return new ne({typeName:oe.ZodBranded,type:this,...u(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new re({...u(this._def),innerType:this,catchValue:t,typeName:oe.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ae.create(this,e)}readonly(){return ie.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=d,t.Schema=d,t.ZodSchema=d;const h=/^c[^\s-]{8,}$/i,p=/^[a-z][a-z0-9]*$/,f=/^[0-9A-HJKMNP-TV-Z]{26}$/,m=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,g=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let y;const b=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,v=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class _ extends d{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==i.ZodParsedType.string){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.string,received:t.parsedType}),a.INVALID}const t=new a.ParseStatus;let r;for(const l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),t.dirty());else if("max"===l.kind)e.data.length>l.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),t.dirty());else if("length"===l.kind){const s=e.data.length>l.value,n=e.data.length<l.value;(s||n)&&(r=this._getOrReturnCtx(e,r),s?(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):n&&(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),t.dirty())}else if("email"===l.kind)g.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"email",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("emoji"===l.kind)y||(y=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),y.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"emoji",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("uuid"===l.kind)m.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"uuid",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("cuid"===l.kind)h.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"cuid",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("cuid2"===l.kind)p.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"cuid2",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("ulid"===l.kind)f.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"ulid",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("url"===l.kind)try{new URL(e.data)}catch(s){r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"url",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"regex",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),t.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{startsWith:l.value},message:l.message}),t.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{endsWith:l.value},message:l.message}),t.dirty()):"datetime"===l.kind?((c=l).precision?c.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${c.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${c.precision}}Z$`):0===c.precision?c.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):c.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:"datetime",message:l.message}),t.dirty()):"ip"===l.kind?(s=e.data,("v4"!==(n=l.version)&&n||!b.test(s))&&("v6"!==n&&n||!v.test(s))&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"ip",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty())):i.util.assertNever(l);var s,n,c;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:o.ZodIssueCode.invalid_string,...n.errorUtil.errToObj(r)})}_addCheck(e){return new _({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...n.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...n.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...n.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...n.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...n.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...n.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...n.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...n.errorUtil.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...n.errorUtil.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...n.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...n.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...n.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...n.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...n.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...n.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...n.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,n.errorUtil.errToObj(e))}trim(){return new _({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new _({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new _({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function w(e,t){const r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,n=r>s?r:s;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}t.ZodString=_,_.create=e=>{var t;return new _({checks:[],typeName:oe.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...u(e)})};class O extends d{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==i.ZodParsedType.number){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.number,received:t.parsedType}),a.INVALID}let t;const r=new a.ParseStatus;for(const s of this._def.checks)"int"===s.kind?i.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"multipleOf"===s.kind?0!==w(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.not_finite,message:s.message}),r.dirty()):i.util.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,n.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,n.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,n.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,n.errorUtil.toString(t))}setLimit(e,t,r,s){return new O({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:n.errorUtil.toString(s)}]})}_addCheck(e){return new O({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:n.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:n.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:n.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:n.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:n.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:n.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:n.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:n.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:n.errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&i.util.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=O,O.create=e=>new O({checks:[],typeName:oe.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...u(e)});class k extends d{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==i.ZodParsedType.bigint){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.bigint,received:t.parsedType}),a.INVALID}let t;const r=new a.ParseStatus;for(const s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):i.util.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,n.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,n.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,n.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,n.errorUtil.toString(t))}setLimit(e,t,r,s){return new k({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:n.errorUtil.toString(s)}]})}_addCheck(e){return new k({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:n.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:n.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:n.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:n.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:n.errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=k,k.create=e=>{var t;return new k({checks:[],typeName:oe.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...u(e)})};class P extends d{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==i.ZodParsedType.boolean){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.boolean,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodBoolean=P,P.create=e=>new P({typeName:oe.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...u(e)});class T extends d{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==i.ZodParsedType.date){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.date,received:t.parsedType}),a.INVALID}if(isNaN(e.data.getTime())){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_date}),a.INVALID}const t=new a.ParseStatus;let r;for(const s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),t.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),t.dirty()):i.util.assertNever(s);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new T({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:n.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:n.errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=T,T.create=e=>new T({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:oe.ZodDate,...u(e)});class x extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.symbol){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.symbol,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodSymbol=x,x.create=e=>new x({typeName:oe.ZodSymbol,...u(e)});class I extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.undefined,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodUndefined=I,I.create=e=>new I({typeName:oe.ZodUndefined,...u(e)});class A extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.null){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.null,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodNull=A,A.create=e=>new A({typeName:oe.ZodNull,...u(e)});class E extends d{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,a.OK)(e.data)}}t.ZodAny=E,E.create=e=>new E({typeName:oe.ZodAny,...u(e)});class S extends d{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,a.OK)(e.data)}}t.ZodUnknown=S,S.create=e=>new S({typeName:oe.ZodUnknown,...u(e)});class j extends d{_parse(e){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.never,received:t.parsedType}),a.INVALID}}t.ZodNever=j,j.create=e=>new j({typeName:oe.ZodNever,...u(e)});class C extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.void,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodVoid=C,C.create=e=>new C({typeName:oe.ZodVoid,...u(e)});class R extends d{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==i.ZodParsedType.array)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.array,received:t.parsedType}),a.INVALID;if(null!==s.exactLength){const e=t.data.length>s.exactLength.value,n=t.data.length<s.exactLength.value;(e||n)&&((0,a.addIssueToContext)(t,{code:e?o.ZodIssueCode.too_big:o.ZodIssueCode.too_small,minimum:n?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&((0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&((0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>s.type._parseAsync(new c(t,e,t.path,r))))).then((e=>a.ParseStatus.mergeArray(r,e)));const n=[...t.data].map(((e,r)=>s.type._parseSync(new c(t,e,t.path,r))));return a.ParseStatus.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new R({...this._def,minLength:{value:e,message:n.errorUtil.toString(t)}})}max(e,t){return new R({...this._def,maxLength:{value:e,message:n.errorUtil.toString(t)}})}length(e,t){return new R({...this._def,exactLength:{value:e,message:n.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}function N(e){if(e instanceof $){const t={};for(const r in e.shape){const s=e.shape[r];t[r]=Q.create(N(s))}return new $({...e._def,shape:()=>t})}return e instanceof R?new R({...e._def,type:N(e.element)}):e instanceof Q?Q.create(N(e.unwrap())):e instanceof ee?ee.create(N(e.unwrap())):e instanceof z?z.create(e.items.map((e=>N(e)))):e}t.ZodArray=R,R.create=(e,t)=>new R({type:e,minLength:null,maxLength:null,exactLength:null,typeName:oe.ZodArray,...u(t)});class $ extends d{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=i.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==i.ZodParsedType.object){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.object,received:t.parsedType}),a.INVALID}const{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),l=[];if(!(this._def.catchall instanceof j&&"strip"===this._def.unknownKeys))for(const e in r.data)n.includes(e)||l.push(e);const u=[];for(const e of n){const t=s[e],n=r.data[e];u.push({key:{status:"valid",value:e},value:t._parse(new c(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof j){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of l)u.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)l.length>0&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.unrecognized_keys,keys:l}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of l){const s=r.data[t];u.push({key:{status:"valid",value:t},value:e._parse(new c(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of u){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>a.ParseStatus.mergeObjectSync(t,e))):a.ParseStatus.mergeObjectSync(t,u)}get shape(){return this._def.shape()}strict(e){return n.errorUtil.errToObj,new $({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var s,a,i,o;const c=null!==(i=null===(a=(s=this._def).errorMap)||void 0===a?void 0:a.call(s,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=n.errorUtil.errToObj(e).message)&&void 0!==o?o:c}:{message:c}}}:{}})}strip(){return new $({...this._def,unknownKeys:"strip"})}passthrough(){return new $({...this._def,unknownKeys:"passthrough"})}extend(e){return new $({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new $({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:oe.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new $({...this._def,catchall:e})}pick(e){const t={};return i.util.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new $({...this._def,shape:()=>t})}omit(e){const t={};return i.util.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new $({...this._def,shape:()=>t})}deepPartial(){return N(this)}partial(e){const t={};return i.util.objectKeys(this.shape).forEach((r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()})),new $({...this._def,shape:()=>t})}required(e){const t={};return i.util.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Q;)e=e._def.innerType;t[r]=e}})),new $({...this._def,shape:()=>t})}keyof(){return J(i.util.objectKeys(this.shape))}}t.ZodObject=$,$.create=(e,t)=>new $({shape:()=>e,unknownKeys:"strip",catchall:j.create(),typeName:oe.ZodObject,...u(t)}),$.strictCreate=(e,t)=>new $({shape:()=>e,unknownKeys:"strict",catchall:j.create(),typeName:oe.ZodObject,...u(t)}),$.lazycreate=(e,t)=>new $({shape:e,unknownKeys:"strip",catchall:j.create(),typeName:oe.ZodObject,...u(t)});class L extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new o.ZodError(e.ctx.common.issues)));return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union,unionErrors:r}),a.INVALID}));{let e;const s=[];for(const n of r){const r={...t,common:{...t.common,issues:[]},parent:null},a=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=s.map((e=>new o.ZodError(e)));return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union,unionErrors:n}),a.INVALID}}get options(){return this._def.options}}t.ZodUnion=L,L.create=(e,t)=>new L({options:e,typeName:oe.ZodUnion,...u(t)});const D=e=>e instanceof K?D(e.schema):e instanceof Y?D(e.innerType()):e instanceof H?[e.value]:e instanceof W?e.options:e instanceof G?Object.keys(e.enum):e instanceof te?D(e._def.innerType):e instanceof I?[void 0]:e instanceof A?[null]:null;class M extends d{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.ZodParsedType.object)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.object,received:t.parsedType}),a.INVALID;const r=this.discriminator,s=t.data[r],n=this.optionsMap.get(s);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):((0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),a.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const r of t){const t=D(r.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const n of t){if(s.has(n))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);s.set(n,r)}}return new M({typeName:oe.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...u(r)})}}function Z(e,t){const r=(0,i.getParsedType)(e),s=(0,i.getParsedType)(t);if(e===t)return{valid:!0,data:e};if(r===i.ZodParsedType.object&&s===i.ZodParsedType.object){const r=i.util.objectKeys(t),s=i.util.objectKeys(e).filter((e=>-1!==r.indexOf(e))),n={...e,...t};for(const r of s){const s=Z(e[r],t[r]);if(!s.valid)return{valid:!1};n[r]=s.data}return{valid:!0,data:n}}if(r===i.ZodParsedType.array&&s===i.ZodParsedType.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let s=0;s<e.length;s++){const n=Z(e[s],t[s]);if(!n.valid)return{valid:!1};r.push(n.data)}return{valid:!0,data:r}}return r===i.ZodParsedType.date&&s===i.ZodParsedType.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}t.ZodDiscriminatedUnion=M;class U extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(e,s)=>{if((0,a.isAborted)(e)||(0,a.isAborted)(s))return a.INVALID;const n=Z(e.value,s.value);return n.valid?(((0,a.isDirty)(e)||(0,a.isDirty)(s))&&t.dirty(),{status:t.value,value:n.data}):((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_intersection_types}),a.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>s(e,t))):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=U,U.create=(e,t,r)=>new U({left:e,right:t,typeName:oe.ZodIntersection,...u(r)});class z extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.array)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.array,received:r.parsedType}),a.INVALID;if(r.data.length<this._def.items.length)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map(((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new c(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(s).then((e=>a.ParseStatus.mergeArray(t,e))):a.ParseStatus.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new z({...this._def,rest:e})}}t.ZodTuple=z,z.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new z({items:e,typeName:oe.ZodTuple,rest:null,...u(t)})};class F extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.object)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.object,received:r.parsedType}),a.INVALID;const s=[],n=this._def.keyType,l=this._def.valueType;for(const e in r.data)s.push({key:n._parse(new c(r,e,r.path,e)),value:l._parse(new c(r,r.data[e],r.path,e))});return r.common.async?a.ParseStatus.mergeObjectAsync(t,s):a.ParseStatus.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return new F(t instanceof d?{keyType:e,valueType:t,typeName:oe.ZodRecord,...u(r)}:{keyType:_.create(),valueType:e,typeName:oe.ZodRecord,...u(t)})}}t.ZodRecord=F;class B extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.map)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.map,received:r.parsedType}),a.INVALID;const s=this._def.keyType,n=this._def.valueType,l=[...r.data.entries()].map((([e,t],a)=>({key:s._parse(new c(r,e,r.path,[a,"key"])),value:n._parse(new c(r,t,r.path,[a,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of l){const s=await r.key,n=await r.value;if("aborted"===s.status||"aborted"===n.status)return a.INVALID;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of l){const s=r.key,n=r.value;if("aborted"===s.status||"aborted"===n.status)return a.INVALID;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}}}t.ZodMap=B,B.create=(e,t,r)=>new B({valueType:t,keyType:e,typeName:oe.ZodMap,...u(r)});class V extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.set)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.set,received:r.parsedType}),a.INVALID;const s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const n=this._def.valueType;function l(e){const r=new Set;for(const s of e){if("aborted"===s.status)return a.INVALID;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}const u=[...r.data.values()].map(((e,t)=>n._parse(new c(r,e,r.path,t))));return r.common.async?Promise.all(u).then((e=>l(e))):l(u)}min(e,t){return new V({...this._def,minSize:{value:e,message:n.errorUtil.toString(t)}})}max(e,t){return new V({...this._def,maxSize:{value:e,message:n.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=V,V.create=(e,t)=>new V({valueType:e,minSize:null,maxSize:null,typeName:oe.ZodSet,...u(t)});class q extends d{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.ZodParsedType.function)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.function,received:t.parsedType}),a.INVALID;function r(e,r){return(0,a.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,s.getErrorMap)(),s.defaultErrorMap].filter((e=>!!e)),issueData:{code:o.ZodIssueCode.invalid_arguments,argumentsError:r}})}function n(e,r){return(0,a.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,s.getErrorMap)(),s.defaultErrorMap].filter((e=>!!e)),issueData:{code:o.ZodIssueCode.invalid_return_type,returnTypeError:r}})}const c={errorMap:t.common.contextualErrorMap},l=t.data;if(this._def.returns instanceof X){const e=this;return(0,a.OK)((async function(...t){const s=new o.ZodError([]),a=await e._def.args.parseAsync(t,c).catch((e=>{throw s.addIssue(r(t,e)),s})),i=await Reflect.apply(l,this,a);return await e._def.returns._def.type.parseAsync(i,c).catch((e=>{throw s.addIssue(n(i,e)),s}))}))}{const e=this;return(0,a.OK)((function(...t){const s=e._def.args.safeParse(t,c);if(!s.success)throw new o.ZodError([r(t,s.error)]);const a=Reflect.apply(l,this,s.data),i=e._def.returns.safeParse(a,c);if(!i.success)throw new o.ZodError([n(a,i.error)]);return i.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new q({...this._def,args:z.create(e).rest(S.create())})}returns(e){return new q({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new q({args:e||z.create([]).rest(S.create()),returns:t||S.create(),typeName:oe.ZodFunction,...u(r)})}}t.ZodFunction=q;class K extends d{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=K,K.create=(e,t)=>new K({getter:e,typeName:oe.ZodLazy,...u(t)});class H extends d{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{received:t.data,code:o.ZodIssueCode.invalid_literal,expected:this._def.value}),a.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function J(e,t){return new W({values:e,typeName:oe.ZodEnum,...u(t)})}t.ZodLiteral=H,H.create=(e,t)=>new H({value:e,typeName:oe.ZodLiteral,...u(t)});class W extends d{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return(0,a.addIssueToContext)(t,{expected:i.util.joinValues(r),received:t.parsedType,code:o.ZodIssueCode.invalid_type}),a.INVALID}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return(0,a.addIssueToContext)(t,{received:t.data,code:o.ZodIssueCode.invalid_enum_value,options:r}),a.INVALID}return(0,a.OK)(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return W.create(e)}exclude(e){return W.create(this.options.filter((t=>!e.includes(t))))}}t.ZodEnum=W,W.create=J;class G extends d{_parse(e){const t=i.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==i.ZodParsedType.string&&r.parsedType!==i.ZodParsedType.number){const e=i.util.objectValues(t);return(0,a.addIssueToContext)(r,{expected:i.util.joinValues(e),received:r.parsedType,code:o.ZodIssueCode.invalid_type}),a.INVALID}if(-1===t.indexOf(e.data)){const e=i.util.objectValues(t);return(0,a.addIssueToContext)(r,{received:r.data,code:o.ZodIssueCode.invalid_enum_value,options:e}),a.INVALID}return(0,a.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=G,G.create=(e,t)=>new G({values:e,typeName:oe.ZodNativeEnum,...u(t)});class X extends d{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.ZodParsedType.promise&&!1===t.common.async)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.promise,received:t.parsedType}),a.INVALID;const r=t.parsedType===i.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,a.OK)(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}t.ZodPromise=X,X.create=(e,t)=>new X({type:e,typeName:oe.ZodPromise,...u(t)});class Y extends d{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===oe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,n={addIssue:e=>{(0,a.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===s.type){const e=s.transform(r.data,n);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r}))):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===s.type){const e=e=>{const t=s.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===s.status?a.INVALID:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?a.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===s.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,a.isValid)(e))return e;const i=s.transform(e.value,n);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>(0,a.isValid)(e)?Promise.resolve(s.transform(e.value,n)).then((e=>({status:t.value,value:e}))):e))}i.util.assertNever(s)}}t.ZodEffects=Y,t.ZodTransformer=Y,Y.create=(e,t,r)=>new Y({schema:e,typeName:oe.ZodEffects,effect:t,...u(r)}),Y.createWithPreprocess=(e,t,r)=>new Y({schema:t,effect:{type:"preprocess",transform:e},typeName:oe.ZodEffects,...u(r)});class Q extends d{_parse(e){return this._getType(e)===i.ZodParsedType.undefined?(0,a.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=Q,Q.create=(e,t)=>new Q({innerType:e,typeName:oe.ZodOptional,...u(t)});class ee extends d{_parse(e){return this._getType(e)===i.ZodParsedType.null?(0,a.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=ee,ee.create=(e,t)=>new ee({innerType:e,typeName:oe.ZodNullable,...u(t)});class te extends d{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===i.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=te,te.create=(e,t)=>new te({innerType:e,typeName:oe.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...u(t)});class re extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,a.isAsync)(s)?s.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new o.ZodError(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new o.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=re,re.create=(e,t)=>new re({innerType:e,typeName:oe.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...u(t)});class se extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.nan){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.nan,received:t.parsedType}),a.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=se,se.create=e=>new se({typeName:oe.ZodNaN,...u(e)}),t.BRAND=Symbol("zod_brand");class ne extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=ne;class ae extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?a.INVALID:"dirty"===e.status?(t.dirty(),(0,a.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?a.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ae({in:e,out:t,typeName:oe.ZodPipeline})}}t.ZodPipeline=ae;class ie extends d{_parse(e){const t=this._def.innerType._parse(e);return(0,a.isValid)(t)&&(t.value=Object.freeze(t.value)),t}}var oe;t.ZodReadonly=ie,ie.create=(e,t)=>new ie({innerType:e,typeName:oe.ZodReadonly,...u(t)}),t.custom=(e,t={},r)=>e?E.create().superRefine(((s,n)=>{var a,i;if(!e(s)){const e="function"==typeof t?t(s):"string"==typeof t?{message:t}:t,o=null===(i=null!==(a=e.fatal)&&void 0!==a?a:r)||void 0===i||i,c="string"==typeof e?{message:e}:e;n.addIssue({code:"custom",...c,fatal:o})}})):E.create(),t.late={object:$.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(oe=t.ZodFirstPartyTypeKind||(t.ZodFirstPartyTypeKind={})),t.instanceof=(e,r={message:`Input not instance of ${e.name}`})=>(0,t.custom)((t=>t instanceof e),r);const ce=_.create;t.string=ce;const le=O.create;t.number=le;const ue=se.create;t.nan=ue;const de=k.create;t.bigint=de;const he=P.create;t.boolean=he;const pe=T.create;t.date=pe;const fe=x.create;t.symbol=fe;const me=I.create;t.undefined=me;const ge=A.create;t.null=ge;const ye=E.create;t.any=ye;const be=S.create;t.unknown=be;const ve=j.create;t.never=ve;const _e=C.create;t.void=_e;const we=R.create;t.array=we;const Oe=$.create;t.object=Oe;const ke=$.strictCreate;t.strictObject=ke;const Pe=L.create;t.union=Pe;const Te=M.create;t.discriminatedUnion=Te;const xe=U.create;t.intersection=xe;const Ie=z.create;t.tuple=Ie;const Ae=F.create;t.record=Ae;const Ee=B.create;t.map=Ee;const Se=V.create;t.set=Se;const je=q.create;t.function=je;const Ce=K.create;t.lazy=Ce;const Re=H.create;t.literal=Re;const Ne=W.create;t.enum=Ne;const $e=G.create;t.nativeEnum=$e;const Le=X.create;t.promise=Le;const De=Y.create;t.effect=De,t.transformer=De;const Me=Q.create;t.optional=Me;const Ze=ee.create;t.nullable=Ze;const Ue=Y.createWithPreprocess;t.preprocess=Ue;const ze=ae.create;t.pipeline=ze,t.ostring=()=>ce().optional(),t.onumber=()=>le().optional(),t.oboolean=()=>he().optional(),t.coerce={string:e=>_.create({...e,coerce:!0}),number:e=>O.create({...e,coerce:!0}),boolean:e=>P.create({...e,coerce:!0}),bigint:e=>k.create({...e,coerce:!0}),date:e=>T.create({...e,coerce:!0})},t.NEVER=a.INVALID},8138:(e,t,r)=>{"use strict";r.a(e,(async(e,t)=>{try{var s=r(6379),n=r(7570),a=r(7633),i=r(1810),o=r(3302),c=r(6786);document.addEventListener("submit",(e=>{e.preventDefault(),_()}));const l="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",u=new s.z({openAIApiKey:l}),d="Given a question, convert it into a standalone question.question: {question} standalone question:",h=n.Pf.fromTemplate(d),p="You are a helpful and enthusiastic support bot who can answer a given question about Scrimba based on the context provided. Try to find the answer in the context. If you really don't know the answer, say \"I'm sorry, I don't know the answer to that.\" And direct the questioner to email help@scrimba.com. Don't try to make up an answer. Always speak as if you were chatting to a friend.\ncontext: {context}\nquestion: {question}\nanswer: \n",f=n.Pf.fromTemplate(p),m=h.pipe(u).pipe(new a.AN),g=c.lW.from([e=>e.standalone_question,i.X,o.X]),y=f.pipe(u).pipe(new a.AN),b=c.lW.from([{standalone_question:m,original_input:new c.sk},{context:g,question:({original_input:e})=>e.question},y]),v=await b.invoke({question:"What are the technical requirements for running scrimba? I have a very old laptop which is not that powerful."});async function _(){const e=document.getElementById("user-input"),t=document.getElementById("chatbot-conversation-container"),r=e.value;e.value="";const s=document.createElement("div");s.classList.add("speech","speech-human"),t.appendChild(s),s.textContent=r,t.scrollTop=t.scrollHeight;const n=document.createElement("div");n.classList.add("speech","speech-ai"),t.appendChild(n),n.textContent=result,t.scrollTop=t.scrollHeight}console.log(v),t()}catch(w){t(w)}}),1)},3302:(e,t,r)=>{"use strict";function s(e){return e.map((e=>e.pageContent)).join("\n\n")}r.d(t,{X:()=>s})},1810:(e,t,r)=>{"use strict";r.d(t,{X:()=>kt}),r(4190);var s=r(3905),n=r(3450);class a extends n.eq{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,t)}async getRelevantDocuments(e,t){const r=(0,s.QH)(t),n=await s.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a=await(n?.handleRetrieverStart(this.toJSON(),e,void 0,void 0,void 0,void 0,r.runName));try{const t=await this._getRelevantDocuments(e,a);return await(a?.handleRetrieverEnd(t)),t}catch(e){throw await(a?.handleRetrieverError(e)),e}}}var i=r(6141);class o extends a{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,"mmr"===e.searchType&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if("mmr"===this.searchType){if("function"!=typeof this.vectorStore.maxMarginalRelevanceSearch)throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t?.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class c extends i.i{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r,s){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map((e=>e[0]))}async similaritySearchWithScore(e,t=4,r,s){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,s,n,a){if("number"==typeof e)return new o({vectorStore:this,k:e,filter:t,tags:[...s??[],this._vectorstoreType()],metadata:n,verbose:a,callbacks:r});{const t={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return new o("mmr"===e?.searchType?{...t,searchKwargs:e.searchKwargs}:{...t})}}}class l{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}function u(e,t){let r=0,s=0,n=0;for(let a=0;a<e.length;a++)r+=e[a]*t[a],s+=e[a]*e[a],n+=t[a]*t[a];return r/(Math.sqrt(s)*Math.sqrt(n))}function d(e,t){return function(e,t,r){if(0===e.length||0===e[0].length||0===t.length||0===t[0].length)return[[]];if(e[0].length!==t[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[e.length,e[0].length]} and Y has shape ${[t.length,t[0].length]}.`);return e.map((e=>t.map((t=>r(e,t))).map((e=>Number.isNaN(e)?0:e))))}(e,t,u)}r(7513),r(6563),Object.prototype.toString;class h extends c{_vectorstoreType(){return"supabase"}constructor(e,t){super(e,t),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"upsertBatchSize",{enumerable:!0,configurable:!0,writable:!0,value:500}),this.client=t.client,this.tableName=t.tableName||"documents",this.queryName=t.queryName||"match_documents",this.filter=t.filter,this.upsertBatchSize=t.upsertBatchSize??this.upsertBatchSize}async addDocuments(e,t){const r=e.map((({pageContent:e})=>e));return this.addVectors(await this.embeddings.embedDocuments(r),e,t)}async addVectors(e,t,r){const s=e.map(((e,r)=>({content:t[r].pageContent,embedding:e,metadata:t[r].metadata})));let n=[];for(let e=0;e<s.length;e+=this.upsertBatchSize){const t=s.slice(e,e+this.upsertBatchSize).map(((t,s)=>r?.ids?{id:r.ids[e+s],...t}:t)),a=await this.client.from(this.tableName).upsert(t).select();if(a.error)throw new Error(`Error inserting: ${a.error.message} ${a.status} ${a.statusText}`);a.data&&(n=n.concat(a.data.map((e=>e.id))))}return n}async delete(e){const{ids:t}=e;for(const e of t)await this.client.from(this.tableName).delete().eq("id",e)}async _searchSupabase(e,t,r){if(r&&this.filter)throw new Error("cannot provide both `filter` and `this.filter`");const s=r??this.filter??{},n={query_embedding:e};let a;if("function"==typeof s)a=e=>s(e).limit(t);else{if("object"!=typeof s)throw new Error("invalid filter type");n.filter=s,n.match_count=t,a=e=>e}const i=this.client.rpc(this.queryName,n),{data:o,error:c}=await a(i);if(c)throw new Error(`Error searching for documents: ${c.code} ${c.message} ${c.details}`);return o}async similaritySearchVectorWithScore(e,t,r){return(await this._searchSupabase(e,t,r)).map((e=>[new l({metadata:e.metadata,pageContent:e.content}),e.similarity]))}async maxMarginalRelevanceSearch(e,t){const r=await this.embeddings.embedQuery(e),s=await this._searchSupabase(r,t.fetchK??20,t.filter),n=function(e,t,r=.5,s=4){if(Math.min(s,t.length)<=0)return[];const n=d(Array.isArray(e[0])?e:[e],t)[0],a=function(e){if(0===e.length)return{maxIndex:-1,maxValue:NaN};let t=e[0],r=0;for(let s=1;s<e.length;s+=1)e[s]>t&&(r=s,t=e[s]);return{maxIndex:r,maxValue:t}}(n).maxIndex,i=[t[a]],o=[a];for(;o.length<Math.min(s,t.length);){let e=-1/0,s=-1;const a=d(t,i);n.forEach(((t,n)=>{if(o.includes(n))return;const i=Math.max(...a[n]),c=r*t-(1-r)*i;c>e&&(e=c,s=n)})),i.push(t[s]),o.push(s)}return o}(r,s.map((e=>e.embedding)),t.lambda,t.k);return n.map((e=>new l({metadata:s[e].metadata,pageContent:s[e].content})))}static async fromTexts(e,t,r,s){const n=[];for(let r=0;r<e.length;r+=1){const s=Array.isArray(t)?t[r]:t,a=new l({pageContent:e[r],metadata:s});n.push(a)}return h.fromDocuments(n,r,s)}static async fromDocuments(e,t,r){const s=new this(t,r);return await s.addDocuments(e),s}static async fromExistingIndex(e,t){return new this(e,t)}}var p=r(7265);class f extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class m extends f{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class g extends f{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class y extends f{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}class b{constructor(e,{headers:t={},customFetch:s}={}){this.url=e,this.headers=t,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,9743)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r,s,n,a,i;return s=this,n=void 0,i=function*(){try{const{headers:s,method:n,body:a}=t;let i,o={};a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",i=a):"string"==typeof a?(o["Content-Type"]="text/plain",i=a):"undefined"!=typeof FormData&&a instanceof FormData?i=a:(o["Content-Type"]="application/json",i=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:i}).catch((e=>{throw new m(e)})),l=c.headers.get("x-relay-error");if(l&&"true"===l)throw new g(c);if(!c.ok)throw new y(c);let u,d=(null!==(r=c.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return u="application/json"===d?yield c.json():"application/octet-stream"===d?yield c.blob():"multipart/form-data"===d?yield c.formData():yield c.text(),{data:u,error:null}}catch(e){return{data:null,error:e}}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{c(i.next(e))}catch(e){t(e)}}function o(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(r,o)}c((i=i.apply(s,n||[])).next())}))}}var v=r(9743);class _ extends class extends class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=v.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,r,s;let n=null,a=null,i=null,o=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),l=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");s&&l&&l.length>1&&(i=parseInt(l[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(n={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,i=null,o=406,c="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(a=[],n=null,o=200,c="OK")}catch(r){404===e.status&&""===t?(o=204,c="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(s=null==n?void 0:n.details)||void 0===s?void 0:s.includes("0 rows"))&&(n=null,o=200,c="OK"),n&&this.shouldThrowOnError)throw n}return{error:n,data:a,count:i,status:o,statusText:c}}));return this.shouldThrowOnError||(r=r.catch((e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}}))),r.then(e,t)}}{select(e){let t=!1;const r=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.order`:"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,a=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:a="text"}={}){var i;const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=null!==(i=this.headers.Accept)&&void 0!==i?i:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const a=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class w{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const a=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e))).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new _({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new _({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new _({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new _({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new _({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const O={"X-Client-Info":"postgrest-js/1.9.1"};class k{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},O),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new w(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new k(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let n;const a=new URL(`${this.url}/rpc/${e}`);let i;r?(n="HEAD",Object.entries(t).forEach((([e,t])=>{a.searchParams.append(e,`${t}`)}))):(n="POST",i=t);const o=Object.assign({},this.headers);return s&&(o.Prefer=`count=${s}`),new _({method:n,url:a,headers:o,schema:this.schemaName,body:i,fetch:this.fetch,allowEmpty:!1})}}const P={"X-Client-Info":"realtime-js/2.9.1"};var T,x,I,A,E,S,j,C;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(T||(T={})),(C=x||(x={})).closed="closed",C.errored="errored",C.joined="joined",C.joining="joining",C.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(I||(I={})),function(e){e.websocket="websocket"}(A||(A={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(E||(E={}));class R{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}class N{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const i=r.decode(e.slice(a,a+s));a+=s;const o=r.decode(e.slice(a,a+n));return a+=n,{ref:null,topic:i,event:o,payload:JSON.parse(r.decode(e.slice(a,e.byteLength)))}}}class ${constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(S||(S={}));class L{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},(e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=L.syncState(this.state,e,t,r),this.pendingDiffs.forEach((e=>{this.state=L.syncDiff(this.state,e,t,r)})),this.pendingDiffs=[],s()})),this.channel._on(r.diff,{},(e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=L.syncDiff(this.state,e,t,r),s())})),this.onJoin(((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})})),this.onLeave(((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,r,s){const n=this.cloneDeep(e),a=this.transformState(t),i={},o={};return this.map(n,((e,t)=>{a[e]||(o[e]=t)})),this.map(a,((e,t)=>{const r=n[e];if(r){const s=t.map((e=>e.presence_ref)),n=r.map((e=>e.presence_ref)),a=t.filter((e=>n.indexOf(e.presence_ref)<0)),c=r.filter((e=>s.indexOf(e.presence_ref)<0));a.length>0&&(i[e]=a),c.length>0&&(o[e]=c)}else i[e]=t})),this.syncDiff(n,{joins:i,leaves:o},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,((t,s)=>{var n;const a=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),a.length>0){const r=e[t].map((e=>e.presence_ref)),s=a.filter((e=>r.indexOf(e.presence_ref)<0));e[t].unshift(...s)}r(t,a,s)})),this.map(a,((t,r)=>{let n=e[t];if(!n)return;const a=r.map((e=>e.presence_ref));n=n.filter((e=>a.indexOf(e.presence_ref)<0)),e[t]=n,s(t,n,r),0===n.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((r=>t(r,e[r])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):s,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(j||(j={}));const D=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce(((r,s)=>(r[s]=M(s,e,t,n),r)),{})},M=(e,t,r,s)=>{const n=t.find((t=>t.name===e)),a=null==n?void 0:n.type,i=r[e];return a&&!s.includes(a)?Z(a,i):U(i)},Z=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return V(t,r)}switch(e){case j.bool:return z(t);case j.float4:case j.float8:case j.int2:case j.int4:case j.int8:case j.numeric:case j.oid:return F(t);case j.json:case j.jsonb:return B(t);case j.timestamp:return q(t);case j.abstime:case j.date:case j.daterange:case j.int4range:case j.int8range:case j.money:case j.reltime:case j.text:case j.time:case j.timestamptz:case j.timetz:case j.tsrange:case j.tstzrange:default:return U(t)}},U=e=>e,z=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},F=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},B=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},V=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const n=e.slice(1,r);try{s=JSON.parse("["+n+"]")}catch(e){s=n?n.split(","):[]}return s.map((e=>Z(t,e)))}return e},q=e=>"string"==typeof e?e.replace(" ","T"):e;var K,H,J;!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(K||(K={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes"}(H||(H={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(J||(J={}));class W{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=x.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new $(this,I.join,this.params,this.timeout),this.rejoinTimer=new R((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=x.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=x.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=x.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=x.errored,this.rejoinTimer.scheduleTimeout())})),this._on(I.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new L(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a}}=this.params;this._onError((t=>e&&e("CHANNEL_ERROR",t))),this._onClose((()=>e&&e("CLOSED")));const i={},o={broadcast:n,presence:a,postgres_changes:null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map((e=>e.filter)))&&void 0!==s?s:[]};this.socket.accessToken&&(i.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:o},i)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(({postgres_changes:t})=>{var r;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,a=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:i,schema:o,table:c,filter:l}}=n,u=t&&t[r];if(!u||u.event!==i||u.schema!==o||u.table!==c||u.filter!==l)return this.unsubscribe(),void(e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=a,void(e&&e("SUBSCRIBED"))}e&&e("SUBSCRIBED")})).receive("error",(t=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{e&&e("TIMED_OUT")}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise((r=>{var s,n,a;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===a?void 0:a.ack)||r("ok"),i.receive("ok",(()=>r("ok"))),i.receive("timeout",(()=>r("timed out")))}));{const{event:n,payload:a}=e,i={method:"POST",headers:{apikey:null!==(r=this.socket.accessToken)&&void 0!==r?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(s=t.timeout)&&void 0!==s?s:this.timeout)).ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=x.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(I.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((r=>{const s=new $(this,I.leave,{},e);s.receive("ok",(()=>{t(),r("ok")})).receive("timeout",(()=>{t(),r("timed out")})).receive("error",(()=>{r("error")})),s.send(),this._canPush()||s.trigger("ok",{})}))}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout((()=>s.abort()),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new $(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const a=e.toLocaleLowerCase(),{close:i,error:o,leave:c,join:l}=I;if(r&&[i,o,c,l].indexOf(a)>=0&&r!==this._joinRef())return;let u=this._onMessage(a,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter((e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===a})).map((e=>e.callback(u,r))):null===(n=this.bindings[a])||void 0===n||n.filter((e=>{var r,s,n,i,o,c;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,i=null===(r=e.filter)||void 0===r?void 0:r.event;return a&&(null===(s=t.ids)||void 0===s?void 0:s.includes(a))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(o=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===r||r===(null===(c=null==t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a})).map((e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:a}=e,i={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:a};u=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(u,r)}))}_isClosed(){return this.state===x.closed}_isJoined(){return this.state===x.joined}_isJoining(){return this.state===x.joining}_isLeaving(){return this.state===x.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter((e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&W.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(I.close,{},e)}_onError(e){this._on(I.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=x.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=D(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=D(e.columns,e.old_record)),t}}const G=()=>{},X="undefined"!=typeof WebSocket;class Y{constructor(e,t){var s;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=P,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=G,this.conn=null,this.sendBuffer=[],this.serializer=new N,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,9743)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${A.websocket}`,(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;n&&(this.accessToken=n),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new R((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});else{if(X)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new Q(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),r.e(26).then(r.t.bind(r,7026,23)).then((({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case T.connecting:return E.Connecting;case T.open:return E.Open;case T.closing:return E.Closing;default:return E.Closed}}isConnected(){return this.connectionState()===E.Open}channel(e,t={config:{}}){const r=new W(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:n}=e,a=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach((t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(I.access_token,{access_token:e})}))}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:r,payload:s,ref:n}=e;(n&&n===this.pendingHeartbeatRef||r===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${n&&"("+n+")"||""}`,s),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(r,s,n))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this._sendHeartbeat()),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(I.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Q{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=T.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class ee extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function te(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class re extends ee{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class se extends ee{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const ne=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,9743)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)};var ae=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))};const ie=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oe=(e,t)=>ae(void 0,void 0,void 0,(function*(){const s=yield(n=void 0,a=void 0,i=void 0,o=function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(r.bind(r,9743))).Response:Response},new(i||(i=Promise))((function(e,t){function r(e){try{c(o.next(e))}catch(e){t(e)}}function s(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}c((o=o.apply(n,a||[])).next())})));var n,a,i,o;e instanceof s?e.json().then((r=>{t(new re(ie(r),e.status||500))})).catch((e=>{t(new se(ie(e),e))})):t(new se(ie(e),e))}));function ce(e,t,r,s,n,a){return ae(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{e(r,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,a)).then((e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()})).then((e=>i(e))).catch((e=>oe(e,o)))}))}))}function le(e,t,r,s){return ae(this,void 0,void 0,(function*(){return ce(e,"GET",t,r,s)}))}function ue(e,t,r,s,n){return ae(this,void 0,void 0,(function*(){return ce(e,"POST",t,s,n,r)}))}function de(e,t,r,s,n){return ae(this,void 0,void 0,(function*(){return ce(e,"DELETE",t,s,n,r)}))}var he=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))};const pe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fe={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class me{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ne(s)}uploadOrUpdate(e,t,r,s){return he(this,void 0,void 0,(function*(){try{let n;const a=Object.assign(Object.assign({},fe),s),i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",a.cacheControl)):(n=r,i["cache-control"]=`max-age=${a.cacheControl}`,i["content-type"]=a.contentType);const o=this._removeEmptyFolders(t),c=this._getFinalPath(o),l=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:i},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{})),u=yield l.json();return l.ok?{data:{path:o,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}upload(e,t,r){return he(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,r)}))}uploadToSignedUrl(e,t,r,s){return he(this,void 0,void 0,(function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),i=new URL(this.url+`/object/upload/sign/${a}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:fe.upsert},s),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);const o=yield this.fetch(i.toString(),{method:"PUT",body:e,headers:a}),c=yield o.json();return o.ok?{data:{path:n,fullPath:c.Key},error:null}:{data:null,error:c}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}createSignedUploadUrl(e){return he(this,void 0,void 0,(function*(){try{let t=this._getFinalPath(e);const r=yield ue(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),n=s.searchParams.get("token");if(!n)throw new ee("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:n},error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}update(e,t,r){return he(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,r)}))}move(e,t){return he(this,void 0,void 0,(function*(){try{return{data:yield ue(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}copy(e,t){return he(this,void 0,void 0,(function*(){try{return{data:{path:(yield ue(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}createSignedUrl(e,t,r){return he(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e),n=yield ue(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}createSignedUrls(e,t,r){return he(this,void 0,void 0,(function*(){try{const s=yield ue(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null}))),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}download(e,t){return he(this,void 0,void 0,(function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield le(this.fetch,`${this.url}/${r}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&s.push(i);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${o}`)}}}remove(e){return he(this,void 0,void 0,(function*(){try{return{data:yield de(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}list(e,t,r){return he(this,void 0,void 0,(function*(){try{const s=Object.assign(Object.assign(Object.assign({},pe),t),{prefix:e||""});return{data:yield ue(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ge={"X-Client-Info":"storage-js/2.5.5"};var ye=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))};class be extends class{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},ge),t),this.fetch=ne(r)}listBuckets(){return ye(this,void 0,void 0,(function*(){try{return{data:yield le(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}getBucket(e){return ye(this,void 0,void 0,(function*(){try{return{data:yield le(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}createBucket(e,t={public:!1}){return ye(this,void 0,void 0,(function*(){try{return{data:yield ue(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}updateBucket(e,t){return ye(this,void 0,void 0,(function*(){try{const r=yield function(e,t,r,s,n){return ae(this,void 0,void 0,(function*(){return ce(e,"PUT",t,s,undefined,r)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}emptyBucket(e){return ye(this,void 0,void 0,(function*(){try{return{data:yield ue(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}deleteBucket(e){return ye(this,void 0,void 0,(function*(){try{return{data:yield de(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(te(e))return{data:null,error:e};throw e}}))}}{constructor(e,t={},r){super(e,t,r)}from(e){return new me(this.url,this.headers,e,this.fetch)}}let ve="";ve="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const _e={"X-Client-Info":`supabase-js-${ve}/2.39.2`};const we=e=>{let t;return t=e||("undefined"==typeof fetch?v.default:fetch),(...e)=>t(...e)},Oe=(e,t,r)=>{const s=we(r),n="undefined"==typeof Headers?v.Headers:Headers;return(r,a)=>{return i=void 0,o=void 0,l=function*(){var i;const o=null!==(i=yield t())&&void 0!==i?i:e;let c=new n(null==a?void 0:a.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${o}`),s(r,Object.assign(Object.assign({},a),{headers:c}))},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{n(l.next(e))}catch(e){t(e)}}function s(e){try{n(l.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof c?n:new c((function(e){e(n)}))).then(r,s)}n((l=l.apply(i,o||[])).next())}));var i,o,c,l}},ke=()=>"undefined"!=typeof document,Pe={tested:!1,writable:!1},Te=()=>{if(!ke())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Pe.tested)return Pe.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Pe.tested=!0,Pe.writable=!0}catch(e){Pe.tested=!0,Pe.writable=!1}return Pe.writable};function xe(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach(((e,r)=>{t[r]=e}))}catch(e){}return r.searchParams.forEach(((e,r)=>{t[r]=e})),t}const Ie=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,9743)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Ae=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Ee=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},Se=async(e,t)=>{await e.removeItem(t)};class je{constructor(){this.promise=new je.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function Ce(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,s,n,a,i,o,c,l="",u=0;for(e=e.replace("-","+").replace("_","/");u<e.length;)a=t.indexOf(e.charAt(u++)),i=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),r=a<<2|i>>4,s=(15&i)<<4|o>>2,n=(3&o)<<6|c,l+=String.fromCharCode(r),64!=o&&0!=s&&(l+=String.fromCharCode(s)),64!=c&&0!=n&&(l+=String.fromCharCode(n));return l}(r))}function Re(e){return("0"+e.toString(16)).substr(-2)}function Ne(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,Re).join("")}async function $e(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}je.promiseConstructor=Promise;class Le extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function De(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Me extends Le{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ze extends Le{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ue extends Le{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ze extends Ue{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Fe extends Ue{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Be extends Ue{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Ve extends Ue{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class qe extends Ue{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ke extends Ue{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function He(e){return De(e)&&"AuthRetryableFetchError"===e.name}class Je extends Ue{constructor(e,t,r){super(e,"AuthWeakPasswordError",t),this.reasons=r}}const We=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ge=[502,503,504];async function Xe(e){if(!("object"==typeof(t=e)&&null!==t&&"status"in t&&"ok"in t&&"json"in t&&"function"==typeof t.json))throw new Ke(We(e),0);var t;if(Ge.includes(e.status))throw new Ke(We(e),e.status);let r;try{r=await e.json()}catch(e){throw new Ze(We(e),e)}if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new Je(We(r),e.status,r.weak_password.reasons);throw new Me(We(r),e.status||500)}async function Ye(e,t,r,s){var n;const a=Object.assign({},null==s?void 0:s.headers);(null==s?void 0:s.jwt)&&(a.Authorization=`Bearer ${s.jwt}`);const i=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(i.redirect_to=s.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await async function(e,t,r,s,n,a){const i=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,{},a);let o;try{o=await e(r,i)}catch(e){throw console.error(e),new Ke(We(e),0)}if(o.ok||await Xe(o),null==s?void 0:s.noResolveJson)return o;try{return await o.json()}catch(e){await Xe(e)}}(e,t,r+o,{headers:a,noResolveJson:null==s?void 0:s.noResolveJson},0,null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(c):{data:Object.assign({},c),error:null}}function Qe(e){var t;let r=null;var s;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function et(e){const t=Qe(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function tt(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function rt(e){return{data:e,error:null}}function st(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a}=e,i=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a},user:Object.assign({},i)},error:null}}function nt(e){return e}class at{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ie(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Ye(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(De(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await Ye(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:tt})}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await Ye(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:st,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(De(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await Ye(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:tt})}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,n,a,i,o;try{const c={nextPage:null,lastPage:0,total:0},l=await Ye(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:nt});if(l.error)throw l.error;const u=await l.json(),d=null!==(a=l.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=l.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t})),c.total=parseInt(d)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(e){if(De(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){try{return await Ye(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:tt})}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){try{return await Ye(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:tt})}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){try{return await Ye(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:tt})}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){try{const{data:t,error:r}=await Ye(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(De(e))return{data:null,error:e};throw e}}async _deleteFactor(e){try{return{data:await Ye(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(De(e))return{data:null,error:e};throw e}}}const it={getItem:e=>Te()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Te()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Te()&&globalThis.localStorage.removeItem(e)}};function ot(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const ct=!!(globalThis&&Te()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class lt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ut extends lt{}async function dt(e,t,r){ct&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout((()=>{s.abort(),ct&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},(async s=>{if(!s){if(0===t)throw ct&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new ut(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ct)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}ct&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{ct&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ht={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.62.0"},flowType:"implicit",debug:!1},pt=3e4;async function ft(e,t,r){return await r()}class mt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=mt.nextInstanceID,mt.nextInstanceID+=1,this.instanceID>0&&ke()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},ht),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new at({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ie(s.fetch),this.lock=s.lock||ft,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,s.lock?this.lock=s.lock:ke()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=dt:this.lock=ft,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Te()?this.storage=it:(this.memoryStorage={},this.storage=ot(this.memoryStorage)):(this.memoryStorage={},this.storage=ot(this.memoryStorage)),ke()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (2.62.0) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){try{const e=!!ke()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),"Identity is already linked"===(null==r?void 0:r.message)||"Identity is already linked to another user"===(null==r?void 0:r.message)||await this._removeSession(),{error:r};const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout((async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return De(e)?{error:e}:{error:new Ze("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,r,s;try{let n;if(await this._removeSession(),"email"in e){const{email:r,password:s,options:a}=e;let i=null,o=null;if("pkce"===this.flowType){const e=Ne();await Ae(this.storage,`${this.storageKey}-code-verifier`,e),i=await $e(e),o=e===i?"plain":"s256"}n=await Ye(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:o},xform:Qe})}else{if(!("phone"in e))throw new Be("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:i}=e;n=await Ye(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(r=null==i?void 0:i.data)&&void 0!==r?r:{},channel:null!==(s=null==i?void 0:i.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Qe})}}const{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:c,session:o},error:null}}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if(await this._removeSession(),"email"in e){const{email:r,password:s,options:n}=e;t=await Ye(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:et})}else{if(!("phone"in e))throw new Be("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await Ye(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:et})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Fe}}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,r,s,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await Ee(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/"),{data:n,error:a}=await Ye(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Qe});return await Se(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:null!=s?s:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new Fe}}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:n,nonce:a}=e,i=await Ye(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Qe}),{data:o,error:c}=i;return c?{data:{user:null,session:null},error:c}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:c}):{data:{user:null,session:null},error:new Fe}}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,r,s,n,a;try{if(await this._removeSession(),"email"in e){const{email:s,options:n}=e;let a=null,i=null;if("pkce"===this.flowType){const e=Ne();await Ae(this.storage,`${this.storageKey}-code-verifier`,e),a=await $e(e),i=e===a?"plain":"s256"}const{error:o}=await Ye(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:i},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:r}=e,{data:i,error:o}=await Ye(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(a=null==r?void 0:r.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Be("You must provide either an email or phone number.")}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,r;try{let s,n;"email_change"!==e.type&&"phone_change"!==e.type&&await this._removeSession(),"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:a,error:i}=await Ye(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:Qe});if(i)throw i;if(!a)throw new Error("An error occurred on token verification.");const o=a.session,c=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:c,session:o},error:null}}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,r,s;try{await this._removeSession();let n=null,a=null;if("pkce"===this.flowType){const e=Ne();await Ae(this.storage,`${this.storageKey}-code-verifier`,e),n=await $e(e),a=e===n?"plain":"s256"}return await Ye(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:rt})}catch(e){if(De(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ze;const{error:s}=await Ye(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}}))}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{"email_change"!=e.type&&"phone_change"!=e.type&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:a}=await Ye(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:a,error:i}=await Ye(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:i}}throw new Be("You must provide either an email or phone number and a type")}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Ee(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return{data:{session:e},error:null};const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,(async()=>await this._getUser())))}async _getUser(e){try{return e?await Ye(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:tt}):await this._useSession((async e=>{var t,r;const{data:s,error:n}=e;if(n)throw n;return await Ye(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(t=s.session)||void 0===t?void 0:t.access_token)&&void 0!==r?r:void 0,xform:tt})}))}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new ze;const a=s.session;let i=null,o=null;if("pkce"===this.flowType&&null!=e.email){const e=Ne();await Ae(this.storage,`${this.storageKey}-code-verifier`,e),i=await $e(e),o=e===i?"plain":"s256"}const{data:c,error:l}=await Ye(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:a.access_token,xform:tt});if(l)throw l;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}}))}catch(e){if(De(e))return{data:{user:null},error:e};throw e}}_decodeJWT(e){return Ce(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ze;const t=Date.now()/1e3;let r=t,s=!0,n=null;const a=Ce(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:a}=await this._getUser(e.access_token);if(a)throw a;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(De(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new ze;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e){try{if(!ke())throw new Ve("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new Ve("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!e)throw new qe("Not a valid PKCE flow url.");const t=xe(window.location.href);if(e){if(!t.code)throw new qe("No code detected.");const{data:e,error:r}=await this._exchangeCodeForSession(t.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:e.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ve(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:a,expires_in:i,expires_at:o,token_type:c}=t;if(!(n&&i&&a&&c))throw new Ve("No session defined in URL");const l=Math.round(Date.now()/1e3),u=parseInt(i);let d=l+u;o&&(d=parseInt(o));const h=d-l;1e3*h<=pt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${u}s`);const p=d-u;l-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,l):l-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,d,l);const{data:f,error:m}=await this._getUser(n);if(m)throw m;const g={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:u,expires_at:d,refresh_token:a,token_type:c,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:t.type},error:null}}catch(e){if(De(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantFlow(){const e=xe(window.location.href);return!(!ke()||!e.access_token&&!e.error_description)}async _isPKCEFlow(){const e=xe(window.location.href),t=await Ee(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const a=null===(r=s.session)||void 0===r?void 0:r.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return De(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Se(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession((async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}}))}async resetPasswordForEmail(e,t={}){let r=null,s=null;if("pkce"===this.flowType){const e=Ne();await Ae(this.storage,`${this.storageKey}-code-verifier`,`${e}/PASSWORD_RECOVERY`),r=await $e(e),s=e===r?"plain":"s256"}try{return await Ye(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(De(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(e){if(De(e))return{data:null,error:e};throw e}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession((async t=>{var r,s,n,a,i;const{data:o,error:c}=t;if(c)throw c;const l=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Ye(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(i=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==i?i:void 0})}));if(s)throw s;return ke()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(t){if(De(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var r,s;const{data:n,error:a}=t;if(a)throw a;return await Ye(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})}))}catch(e){if(De(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*r),this._debug(t,"refreshing attempt",r),await Ye(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Qe})),s=(e,t,r)=>r&&r.error&&He(r.error)&&Date.now()+200*(e+1)-n<pt,new Promise(((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await r(n);if(!s(n,0,t))return void e(t)}catch(e){if(!s(n))return void t(e)}})()})))}catch(e){if(this._debug(t,"error",e),De(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ke()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Ee(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=Math.round(Date.now()/1e3),n=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${n?"":" not"} expired with margin of 10s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),He(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(e){return this._debug(t,"error",e),void console.error(e)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ze;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new je;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new ze;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={session:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(e){if(this._debug(s,"error",e),De(e)){const r={session:null,error:e};return He(e)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map((async r=>{try{await r.callback(e,t)}catch(e){n.push(e)}}));if(await Promise.all(a),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await Ae(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Se(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ke()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),pt);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const e=Date.now();try{return await this._useSession((async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-e)/pt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof lt))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ke()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const e=Ne();await Ae(this.storage,`${this.storageKey}-code-verifier`,e);const t=await $e(e),r=e===t?"plain":"s256";this._debug("PKCE","code verifier",`${e.substring(0,5)}...`,"code challenge",t,"method",r);const n=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(r)}`});s.push(n.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Ye(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})}))}catch(e){if(De(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession((async t=>{var r,s;const{data:n,error:a}=t;if(a)return{data:null,error:a};const{data:i,error:o}=await Ye(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:((null===(s=null==i?void 0:i.totp)||void 0===s?void 0:s.qr_code)&&(i.totp.qr_code=`data:image/svg+xml;utf-8,${i.totp.qr_code}`),{data:i,error:null})}))}catch(e){if(De(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:i}=await Ye(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:i})}))}catch(e){if(De(e))return{data:null,error:e};throw e}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Ye(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})}))}catch(e){if(De(e))return{data:null,error:e};throw e}}))}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter((e=>"totp"===e.factor_type&&"verified"===e.status));return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(s.access_token);let i=null;a.aal&&(i=a.aal);let o=i;return(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==r?r:[]).length>0&&(o="aal2"),{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:a.amr||[]},error:null}}))))}}mt.nextInstanceID=0;class gt extends mt{constructor(e){super(e)}}const yt={headers:_e},bt={schema:"public"},vt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},_t={};const wt=new p.V6({openAIApiKey:"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"}),Ot=new class{constructor(e,t,r){var s,n,a,i,o,c,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,this.from=e=>this.rest.from(e),this.schema=e=>this.rest.schema(e),this.rpc=(e,t={},r)=>this.rest.rpc(e,t,r),!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=e.replace(/\/$/,"");this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,p=function(e,t){const{db:r,auth:s,realtime:n,global:a}=e,{db:i,auth:o,realtime:c,global:l}=t;return{db:Object.assign(Object.assign({},i),r),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},l),a)}}(null!=r?r:{},{db:bt,realtime:_t,auth:Object.assign(Object.assign({},vt),{storageKey:h}),global:yt});this.storageKey=null!==(n=null===(s=p.auth)||void 0===s?void 0:s.storageKey)&&void 0!==n?n:"",this.headers=null!==(i=null===(a=p.global)||void 0===a?void 0:a.headers)&&void 0!==i?i:{},this.auth=this._initSupabaseAuthClient(null!==(o=p.auth)&&void 0!==o?o:{},this.headers,null===(c=p.global)||void 0===c?void 0:c.fetch),this.fetch=Oe(t,this._getAccessToken.bind(this),null===(l=p.global)||void 0===l?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new k(`${d}/rest/v1`,{headers:this.headers,schema:null===(u=p.db)||void 0===u?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new b(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new be(this.storageUrl,this.headers,this.fetch)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,r,s,n,a;return r=this,s=void 0,a=function*(){const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(i,o)}c((a=a.apply(r,s||[])).next())}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:a,debug:i},o,c){const l={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new gt({url:this.authUrl,headers:Object.assign(Object.assign({},l),o),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,debug:i,fetch:c})}_initRealtimeClient(e){return new Y(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r)}}("https://ltrxdjmtmjwxswlgcbxp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx0cnhkam10bWp3eHN3bGdjYnhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDQ5Njg0MjgsImV4cCI6MjAyMDU0NDQyOH0.gUYmIYX4GwF_UaXyAxoGMABUDHziq7Bd9PwLsPS2YbY",undefined);const kt=new h(wt,{client:Ot,tableName:"documents",queryName:"match_documents"}).asRetriever()},6515:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var s=r(1156),n=r(6141);class a extends class{}{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,n.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||"true"!=="MISSING_ENV_VAR"?.LANGCHAIN_CALLBACKS_BACKGROUND}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return n.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return n.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends a{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:s.Z()}),Object.assign(this,e)}}}}},3905:(e,t,r)=>{"use strict";r.d(t,{Ye:()=>J,QH:()=>F});var s=r(1156),n=r(6515),a=r(265),i=r(4075);function o(e,t){return`${e.open}${t}${e.close}`}function c(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function l(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:u}=a;class d extends i.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const s=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?o(a.bold,s):s})).join(" > ");return o(u.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[chain/start]")} [${t}] Entering Chain run with input: ${c(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[chain/end]")} [${t}] [${l(e)}] Exiting Chain run with output: ${c(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[chain/error]")} [${t}] [${l(e)}] Chain run errored with error: ${c(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${o(u.green,"[llm/start]")} [${t}] Entering LLM run with input: ${c(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[llm/end]")} [${t}] [${l(e)}] Exiting LLM run with output: ${c(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[llm/error]")} [${t}] [${l(e)}] LLM run errored with error: ${c(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[tool/end]")} [${t}] [${l(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[tool/error]")} [${t}] [${l(e)}] Tool run errored with error: ${c(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${c(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[retriever/end]")} [${t}] [${l(e)}] Exiting Retriever run with output: ${c(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[retriever/error]")} [${t}] [${l(e)}] Retriever run errored with error: ${c(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${o(u.blue,"[agent/action]")} [${r}] Agent selected action: ${c(t.actions[t.actions.length-1],"[action]")}`)}}const h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,p={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let f;const m=new Uint8Array(16);function g(){if(!f&&(f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!f))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(m)}const y=[];for(let e=0;e<256;++e)y.push((e+256).toString(16).slice(1));const b=function(e,t,r){if(p.randomUUID&&!t&&!e)return p.randomUUID();const s=(e=e||{}).random||(e.rng||g)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return y[e[t+0]]+y[e[t+1]]+y[e[t+2]]+y[e[t+3]]+"-"+y[e[t+4]]+y[e[t+5]]+"-"+y[e[t+6]]+y[e[t+7]]+"-"+y[e[t+8]]+y[e[t+9]]+"-"+y[e[t+10]]+y[e[t+11]]+y[e[t+12]]+y[e[t+13]]+y[e[t+14]]+y[e[t+15]]}(s)};var v=r(2693),_=r(5860);const w=[400,401,403,404,405,406,407,408,409];class O{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t=_.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>v((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&w.includes(+t))throw e},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function k(e){return"function"==typeof e?._getType}function P(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}const T=()=>"undefined"!=typeof Deno;let x,I;async function A(){if(void 0===x){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||T()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":T()?"deno":"other":"node",e})(),t=function(){if(void 0!==I)return I;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const r of e){const e=E(r);void 0!==e&&(t[r]=e)}return I=t,t}();x={library:"langsmith",runtime:e,...t}}return x}function E(e){try{return"undefined"!=typeof process?"MISSING_ENV_VAR"?.[e]:void 0}catch(e){return}}const S=e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},j=async(e,t)=>{const r=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};function C(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function R(e){return"true"===E("LANGCHAIN_HIDE_INPUTS")?{}:e}function N(e){return"true"===E("LANGCHAIN_HIDE_OUTPUTS")?{}:e}function $(e){if("string"!=typeof(t=e)||!h.test(t))throw new Error(`Invalid UUID: ${e}`);var t}class L{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});const t=L.getDefaultClientConfig();this.apiUrl=C(e.apiUrl??t.apiUrl)??"",this.apiKey=C(e.apiKey??t.apiKey),this.webUrl=C(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new O(e.callerOptions??{})}static getDefaultClientConfig(){const e=E("LANGCHAIN_API_KEY");return{apiUrl:E("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984"),apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){if(!S(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:S(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _getResponse(e,t){const r=t?.toString()??"",s=`${this.apiUrl}${e}?${r}`,n=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);return n}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(s));const n=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const i=await a.json();if(0===i.length)break;if(yield i,i.length<s)break;r+=i.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){let n=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(n)}),a=await t.json();if(!a)break;if(!a[s])break;yield a[s];const i=a.cursors;if(!i)break;if(!i.next)break;n.cursor=i.next}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},s=await A(),n=e.project_name;delete e.project_name;const a={session_name:n,...e,extra:{...e.extra,runtime:{...s,...r.runtime}}};a.inputs=R(a.inputs),a.outputs&&(a.outputs=N(a.outputs));const i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await j(i,"create run")}async updateRun(e,t){$(e),t.inputs&&(t.inputs=R(t.inputs)),t.outputs&&(t.outputs=N(t.outputs));const r={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await j(s,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){$(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:E("LANGCHAIN_PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),s[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(s[t].child_runs=r[t]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:s,startTime:n,executionOrder:a,runType:i,error:o,id:c,query:l,filter:u,limit:d}){let h=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");h=(await this.readProject({projectName:t})).id}const p={session:h?[h]:null,run_type:i,reference_example:s,query:l,filter:u,execution_order:a,parent_run:r?[r]:null,start_time:n?n.toISOString():null,error:o,id:c,limit:d};for await(const e of this._getCursorPaginatedList("/runs/query",p))yield*e}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||b()};$(e);const s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await s.json();if(null===n||!("share_token"in n))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){$(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(t,"unshare run")}async readRunSharedLink(e){$(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)r.append("id",e);$(e);const s=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await s.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),$(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),s=await r.json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};$(e);const s=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await s.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){$(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(t,"unshare dataset")}async readSharedDataset(e){$(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:n=null,referenceDatasetId:a=null}){const i=s?"?upsert=true":"",o=`${this.apiUrl}/sessions${i}`,c=n||{};r&&(c.metadata=r);const l={name:e,extra:c,description:t};null!==a&&(l.reference_dataset_id=a);const u=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),d=await u.json();if(!u.ok)throw new Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return d}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:n=null,endTime:a=null}){const i=`${this.apiUrl}/sessions/${e}`;let o=n;s&&(o={...o||{},metadata:s});const c={name:t,extra:o,description:r,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(fetch,i,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)}),u=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return u}async readProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)$(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");s.append("name",t)}const n=await this._get(r,s);let a;if(Array.isArray(n)){if(0===n.length)throw new Error(`Project[id=${e}, name=${t}] not found`);a=n[0]}else a=n;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:n,referenceFree:a}={}){const i=new URLSearchParams;if(void 0!==e)for(const t of e)i.append("id",t);if(void 0!==t&&i.append("name",t),void 0!==r&&i.append("name_contains",r),void 0!==s)i.append("reference_dataset",s);else if(void 0!==n){const e=await this.readDataset({datasetName:n});i.append("reference_dataset",e.id)}void 0!==a&&i.append("reference_free",a.toString());for await(const e of this._getPaginated("/sessions",i))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e,$(r);const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(s,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:n,dataType:a,name:i}){const o=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach((e=>{c.append("input_keys",e)})),s.forEach((e=>{c.append("output_keys",e)})),n&&c.append("description",n),a&&c.append("data_type",a),i&&c.append("name",i);const l=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok){const e=await l.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const s={name:e,description:t};r&&(s.data_type=r);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok){const t=await n.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${n.status} ${n.statusText}`)}return await n.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)$(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");s.append("name",t)}const n=await this._get(r,s);let a;if(Array.isArray(n)){if(0===n.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=n[0]}else a=n;return a}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:n}={}){const a=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)a.append("id",e);void 0!==s&&a.append("name",s),void 0!==n&&a.append("name_contains",n);for await(const e of this._getPaginated("/datasets",a))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(s=(await this.readDataset({datasetName:t})).id),void 0===s)throw new Error("Must provide datasetName or datasetId");$(s),r+=`/${s}`;const n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:n,exampleId:a}){let i=r;if(void 0===i&&void 0===s)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==s)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:s})).id);const o={dataset_id:i,inputs:e,outputs:t,created_at:(n||new Date).toISOString(),id:a},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map((e=>k(e)?P(e):e)),n=k(t)?P(t):t;return this.createExample({input:s},{output:n},r)}async readExample(e){$(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let s;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)s=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");s=(await this.readDataset({datasetName:t})).id}const n=new URLSearchParams({dataset:s});if(void 0!==r)for(const e of r)n.append("id",e);for await(const e of this._getPaginated("/examples",n))yield*e}async deleteExample(e){$(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){$(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s}={loadChildRuns:!1}){let n,a;if("string"==typeof e)n=await this.readRun(e,{loadChildRuns:s});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);n=e}null!==n.reference_example_id&&void 0!==n.reference_example_id&&(a=await this.readExample(n.reference_example_id));const i=await t.evaluateRun(n,a);let o=r??{};return i.evaluatorInfo&&(o={...o,...i.evaluatorInfo}),await this.createFeedback(n.id,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,feedbackSourceType:"model"})}async createFeedback(e,t,{score:r,value:s,correction:n,comment:a,sourceInfo:i,feedbackSourceType:o="api",sourceRunId:c,feedbackId:l,eager:u=!1}){const d={type:o??"api",metadata:i??{}};void 0===c||void 0===d?.metadata||d.metadata.__run||(d.metadata.__run={run_id:c}),void 0!==d?.metadata&&void 0!==d.metadata.__run?.run_id&&$(d.metadata.__run.run_id);const h={id:l??b(),run_id:e,key:t,score:r,value:s,correction:n,comment:a,feedback_source:d},p=`${this.apiUrl}/feedback`+(u?"/eager":""),f=await this.caller.call(fetch,p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms)});return await j(f,"create feedback"),h}async updateFeedback(e,{score:t,value:r,correction:s,comment:n}){const a={};null!=t&&(a.score=t),null!=r&&(a.value=r),null!=s&&(a.correction=s),null!=n&&(a.comment=n),$(e);const i=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await j(i,"update feedback")}async readFeedback(e){$(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){$(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const e of t)s.append("key",e);if(r)for(const e of r)s.append("source",e);for await(const e of this._getPaginated("/feedback",s))yield*e}}var D=r(6374);class M extends i.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:s}=e;this.projectName=r??(0,D.lS)("LANGCHAIN_PROJECT")??(0,D.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new L({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await(0,D.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}var Z=r(3908);let U;async function z(e,t){!0===t?await e():(void 0===U&&(U=new(0,_.default)({autoStart:!0,concurrency:1})),U.add(e))}function F(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class B{constructor(e,t,r,s,n,a,i,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>z((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class V extends B{getChild(e){const t=new J(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class q extends B{async handleLLMNewToken(e,t,r,s,n,a){await Promise.all(this.handlers.map((r=>z((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}}),r.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class K extends B{getChild(e){const t=new J(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,n){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,r,s,n){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class H extends B{getChild(e){const t=new J(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>z((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class J extends class{setHandler(e){return this.setHandlers([e])}}{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,r,n,a,i,o,c){return Promise.all(t.map((async t=>{const r=(0,s.Z)();return await Promise.all(this.handlers.map((s=>z((async()=>{if(!s.ignoreLLM)try{await(s.handleLLMStart?.(e,[t],r,this._parentRunId,a,this.tags,this.metadata,c))}catch(e){console.error(`Error in handler ${s.constructor.name}, handleLLMStart: ${e}`)}}),s.awaitHandlers)))),new q(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r,n,a,i,o,c){return Promise.all(t.map((async t=>{const r=(0,s.Z)();return await Promise.all(this.handlers.map((s=>z((async()=>{if(!s.ignoreLLM)try{if(s.handleChatModelStart)await(s.handleChatModelStart?.(e,[t],r,this._parentRunId,a,this.tags,this.metadata,c));else if(s.handleLLMStart){const n=(0,Z.zs)(t);await(s.handleLLMStart?.(e,[n],r,this._parentRunId,a,this.tags,this.metadata,c))}}catch(e){console.error(`Error in handler ${s.constructor.name}, handleLLMStart: ${e}`)}}),s.awaitHandlers)))),new q(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=(0,s.Z)(),n,a,i,o){return await Promise.all(this.handlers.map((s=>z((async()=>{if(!s.ignoreChain)try{await(s.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,n,o))}catch(e){console.error(`Error in handler ${s.constructor.name}, handleChainStart: ${e}`)}}),s.awaitHandlers)))),new K(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,s.Z)(),n,a,i,o){return await Promise.all(this.handlers.map((s=>z((async()=>{if(!s.ignoreAgent)try{await(s.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${s.constructor.name}, handleToolStart: ${e}`)}}),s.awaitHandlers)))),new H(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,s.Z)(),n,a,i,o){return await Promise.all(this.handlers.map((s=>z((async()=>{if(!s.ignoreRetriever)try{await(s.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${s.constructor.name}, handleRetrieverStart: ${e}`)}}),s.awaitHandlers)))),new V(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new J(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const s of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===s.name))||r.addHandler(s,t);return r}static fromHandlers(e){class t extends n.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,s.Z)()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,n,a,i){let o;(e||t)&&(Array.isArray(e)||!e?(o=new J,o.setHandlers(e?.map(W)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(W):t?.handlers,!1));const c="true"===(0,D.lS)("LANGCHAIN_VERBOSE")||i?.verbose,l="true"===(0,D.lS)("LANGCHAIN_TRACING_V2"),u=l||((0,D.lS)("LANGCHAIN_TRACING")??!1);if(c||u){if(o||(o=new J),c&&!o.handlers.some((e=>e.name===d.prototype.name))){const e=new d;o.addHandler(e,!0)}u&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&l&&o.addHandler(await async function(){return new M}(),!0)}return(r||s)&&o&&(o.addTags(r??[]),o.addTags(s??[],!1)),(n||a)&&o&&(o.addMetadata(n??{}),o.addMetadata(a??{},!1)),o}}function W(e){return"name"in e?e:n.E.fromMethods(e)}},6141:(e,t,r)=>{"use strict";r.d(t,{i:()=>l,j:()=>c});var s=r(2466);function n(e,t){return t?.[e]||s(e)}function a(e,t,r){const s={};for(const n in e)Object.hasOwn(e,n)&&(s[t(n,r)]=e[n]);return s}function i(e){return Array.isArray(e)?[...e]:{...e}}function o(e,t){const r=i(e);for(const[e,s]of Object.entries(t)){const[t,...n]=e.split(".").reverse();let a=r;for(const e of n.reverse()){if(void 0===a[e])break;a[e]=i(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[s]})}return r}function c(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}r(3204);class l{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,c(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof l||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,s=r;const[n,...a]=e.split(".").reverse();for(const e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in s&&void 0!==s[e]||("object"==typeof t[e]&&null!=t[e]?s[e]={}:Array.isArray(t[e])&&(s[e]=[])),t=t[e],s=s[e]}n in t&&void 0!==t[n]&&(s[n]=s[n]||t[n])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:a(Object.keys(t).length?o(r,t):r,n,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},3908:(e,t,r)=>{"use strict";r.d(t,{Cr:()=>f,E1:()=>y,GC:()=>d,HD:()=>b,J:()=>g,Xz:()=>m,gY:()=>u,ro:()=>l,xk:()=>c,xq:()=>p,zs:()=>v});var s=r(6141);function n(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class a extends s.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){const e=this._getType();if("human"===e)return new l({...this});if("ai"===e)return new d({...this});if("system"===e)return new p({...this});if("function"===e)return new f({...this});if(g.isInstance(this))return new b({...this});throw new Error("Unknown message type.")}}function i(e){return Array.isArray(e)&&e.every((e=>"number"==typeof e.index))}class o extends a{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[e,s]of Object.entries(t))if(void 0===r[e])r[e]=s;else{if(typeof r[e]!=typeof s)throw new Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e])r[e]=r[e]+s;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if("tool_calls"!==e||!i(r[e])||!i(s))throw new Error(`additional_kwargs[${e}] already exists in this message chunk.`);for(const t of s)void 0!==r[e]?.[t.index]?r[e]=r[e]?.map(((e,r)=>r!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}})):r[e][t.index]=t}else r[e]=this._mergeAdditionalKwargs(r[e],s)}return r}}class c extends a{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class l extends o{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new l({content:n(this.content,e.content),additional_kwargs:l._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class u extends a{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class d extends o{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new d({content:n(this.content,e.content),additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class h extends a{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class p extends o{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new p({content:n(this.content,e.content),additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class f extends o{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new f({content:n(this.content,e.content),additional_kwargs:f._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class m extends o{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new m({content:n(this.content,e.content),additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}class g extends a{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function y(e){if("string"==typeof e)return new c(e);if(function(e){return"function"==typeof e?._getType}(e))return e;const[t,r]=e;if("human"===t||"user"===t)return new c({content:r});if("ai"===t||"assistant"===t)return new u({content:r});if("system"===t)return new h({content:r});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class b extends o{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new b({content:n(this.content,e.content),additional_kwargs:b._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function v(e,t="Human",r="AI"){const s=[];for(const n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else{if("generic"!==n._getType())throw new Error(`Got unsupported message type: ${n._getType()}`);e=n.role}const a=n.name?`${n.name}, `:"";s.push(`${e}: ${a}${n.content}`)}return s.join("\n")}},1141:(e,t,r)=>{"use strict";r.d(t,{GU:()=>o,nw:()=>i});var s=r(6141),n=r(3908);class a extends s.i{}class i extends a{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.xk(this.value)]}}class o extends a{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,n.zs)(this.messages)}toChatMessages(){return this.messages}}},619:(e,t,r)=>{"use strict";r.d(t,{d:()=>n});var s=r(3450);class n extends s.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[e,s]of Object.entries(t))r[e]="string"==typeof s?s:await s();return{...r,...e}}async invoke(e,t){return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,1214));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,1214));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,7315));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}},9242:(e,t,r)=>{"use strict";r.d(t,{S:()=>a}),r(3908);var s=r(1141),n=(r(3450),r(619));r(1214);class a extends n.d{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new s.GU(t)}}},7315:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FewShotChatMessagePromptTemplate:()=>c,FewShotPromptTemplate:()=>o});var s=r(1307),n=r(7327),a=r(1214),i=r(9242);class o extends s.A{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new o(s)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map((e=>this.examplePrompt.format(e)))),a=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return(0,n.SM)(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await a.PromptTemplate.deserialize(t);let s;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return s=e.examples,new o({inputVariables:e.input_variables,examplePrompt:r,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class c extends i.S{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.af)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=await this.getExamples(t);r=r.map((e=>{const t={};return this.examplePrompt.inputVariables.forEach((r=>{t[r]=e[r]})),t}));const s=[];for(const e of r){const t=await this.examplePrompt.formatMessages(e);s.push(...t)}return s}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=(await Promise.all(r.map((e=>this.examplePrompt.formatMessages(e))))).flat().map((e=>e.content)),a=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return(0,n.SM)(a,this.templateFormat,t)}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new c(s)}}},1214:(e,t,r)=>{"use strict";r.r(t),r.d(t,{PromptTemplate:()=>a});var s=r(1307),n=r(7327);class a extends s.A{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.af)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,n.SM)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s="\n\n",n=""){const i=[n,...e,t].join(s);return new a({inputVariables:r,template:i})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){const s=new Set;return(0,n.$M)(e,t).forEach((e=>{"variable"===e.type&&s.add(e.name)})),new a({inputVariables:[...s],templateFormat:t,template:e,...r})}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new a(s)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new a({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},1307:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(1141),n=r(619);class a extends n.d{async formatPromptValue(e){const t=await this.format(e);return new s.nw(t)}}},7327:(e,t,r)=>{"use strict";r.d(t,{$M:()=>o,SM:()=>i,af:()=>c});const s=e=>{const t=e.split(""),r=[],s=(e,r)=>{for(let s=r;s<t.length;s+=1)if(e.includes(t[s]))return s;return-1};let n=0;for(;n<t.length;)if("{"===t[n]&&n+1<t.length&&"{"===t[n+1])r.push({type:"literal",text:"{"}),n+=2;else if("}"===t[n]&&n+1<t.length&&"}"===t[n+1])r.push({type:"literal",text:"}"}),n+=2;else if("{"===t[n]){const e=s("}",n);if(e<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(n+1,e).join("")}),n=e+1}else{if("}"===t[n])throw new Error("Single '}' in template.");{const e=s("{}",n),a=(e<0?t.slice(n):t.slice(n,e)).join("");r.push({type:"literal",text:a}),n=e<0?t.length:e}}return r},n={"f-string":(e,t)=>s(e).reduce(((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw new Error(`Missing value for input ${r.name}`)}return e+r.text}),"")},a={"f-string":s},i=(e,t,r)=>n[t](e,r),o=(e,t)=>a[t](e),c=(e,t,r)=>{if(!(t in n)){const e=Object.keys(n);throw new Error(`Invalid template format. Got \`${t}\`;\n                         should be one of ${e}`)}try{const s=r.reduce(((e,t)=>(e[t]="foo",e)),{});i(e,t,s)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},3450:(e,t,r)=>{"use strict";r.d(t,{eq:()=>v,Vh:()=>A,dT:()=>P,lW:()=>k});var s=r(2693),n=r(3905),a=r(344),i=r(4075);class o extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new o({start:e=>function r(){return t.read().then((({done:t,value:s})=>{if(!t)return e.enqueue(s),r();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new o({async pull(t){const{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)}})}}function c(e,t=2){const r=Array.from({length:t},(()=>[]));return r.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function l(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const r={...e};for(const[e,s]of Object.entries(t))r[e]=e in r?l(r[e],s):s;return r}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class u{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((r,s)=>{this.firstResult=e.next(),this.firstResult.then(t).then(r,s)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}class d{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){const t=this.ops.concat(e.ops),r=(0,a.af)({},t);return new h({ops:t,state:r[r.length-1].newDocument})}}class h extends d{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=(0,a.af)(this.state,e.ops);return new h({ops:t,state:r[r.length-1].newDocument})}}class p extends i.Z{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=o.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(void 0===e.parent_run_id)return!1;const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async onRunCreate(e){if(void 0===e.parent_run_id&&await this.writer.write(new d({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]})),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new d({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new d({ops:r});await this.writer.write(s)}finally{if(void 0===e.parent_run_id){const t=new d({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){const r=this.keyMapByRunId[e.id];if(void 0===r)return;const s=new d({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(s)}}var f=r(6141),m=r(7798),g=r(9636);class y extends i.Z{constructor({config:e,onStart:t,onEnd:r,onError:s}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}function b(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class v extends f.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new _({bound:this,kwargs:e,config:{}})}map(){return new w({bound:this})}withRetry(e){return new O({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new _({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new x({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},(()=>e))}async batch(e,t,r){const s=this._getOptionsList(t??{},e.length),n=new g.L({maxConcurrency:r?.maxConcurrency,onFailedAttempt:e=>{throw e}}),a=e.map(((e,t)=>n.call((async()=>{try{return await this.invoke(e,s[t])}catch(e){if(r?.returnExceptions)return e;throw e}}))));return Promise.all(a)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return o.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,[t,r]}async _callWithConfig(e,t,r){const s=await(0,m.Le)(r),n=await(s?.handleChainStart(this.toJSON(),b(t,"input"),void 0,r?.runType,void 0,void 0,r?.runName??this.getName()));let a;try{a=await e.bind(this)(t,r,n)}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(b(a,"output"))),a}async _batchWithConfig(e,t,r,s){const n=this._getOptionsList(r??{},t.length),a=await Promise.all(n.map(m.Le)),i=await Promise.all(a.map(((e,r)=>e?.handleChainStart(this.toJSON(),b(t[r],"input"),void 0,n[r].runType,void 0,void 0,n[r].runName??this.getName()))));let o;try{o=await e(t,n,i,s)}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(b(o,"output"))))),o}async*_transformStreamWithConfig(e,t,r){let s,n,a=!0,i=!0;const o=await(0,m.Le)(r);let c;try{const d=await async function(e,t,r,...s){const n=new u(t,r),a=await n.setup;return{output:e(n,a,...s),setup:a}}(t,async function*(){for await(const t of e){if(a)if(void 0===s)s=t;else try{s=l(s,t)}catch{s=void 0,a=!1}yield t}}(),(async()=>o?.handleChainStart(this.toJSON(),{input:""},void 0,r?.runType,void 0,void 0,r?.runName??this.getName())),r);c=d.setup;for await(const e of d.output)if(yield e,i)if(void 0===n)n=e;else try{n=l(n,e)}catch{n=void 0,i=!1}}catch(e){throw await(c?.handleChainError(e,void 0,void 0,void 0,{inputs:b(s,"input")})),e}await(c?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:b(s,"input")}))}_patchConfig(e={},t,r){const s={...e};return void 0!==t?(delete s.runName,{...s,callbacks:t}):(void 0!==r&&(s.recursionLimit=r),s)}pipe(e){return new k({first:this,last:I(e)})}pick(e){return this.pipe(new E(e))}assign(e){return this.pipe(new A(new P({steps:e})))}async*transform(e,t){let r;for await(const t of e)r=void 0===r?t:l(r,t);yield*this._streamIterator(r,t)}async*streamLog(e,t,r){const s=new p({...r,autoClose:!1}),n=t??{},{callbacks:a}=n;if(void 0===a)n.callbacks=[s];else if(Array.isArray(a))n.callbacks=a.concat([s]);else{const e=a.copy();e.inheritableHandlers.push(s),n.callbacks=e}const i=await this.stream(e,n),o=async function(){try{for await(const e of i){const t=new d({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await s.writer.write(t)}}finally{await s.writer.close()}}();try{for await(const e of s)yield e}finally{await o}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:r}){return new _({bound:this,config:{},configFactories:[s=>({callbacks:[new y({config:s,onStart:e,onEnd:t,onError:r})]})]})}}class _ extends v{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(e){const t=(0,m.t8)(this.config,e);return(0,m.t8)(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){const s=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig({...e,...this.kwargs})))):await this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig({...t,...this.kwargs}))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&v.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new _({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new y({config:s,onStart:e,onEnd:t,onError:r})]})]})}}class w extends v{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new w({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r?.getChild()))}withListeners({onStart:e,onEnd:t,onError:r}){return new w({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class O extends _{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const s=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r?.getChild(s))}async _invoke(e,t,r){return s((s=>super.invoke(e,this._patchConfigForRetry(s,t,r))),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,n){const a={};try{await s((async s=>{const i=e.map(((e,t)=>t)).filter((e=>void 0===a[e.toString()]||a[e.toString()]instanceof Error)),o=i.map((t=>e[t])),c=i.map((e=>this._patchConfigForRetry(s,t?.[e],r?.[e]))),l=await super.batch(o,c,{...n,returnExceptions:!0});let u;for(let e=0;e<l.length;e+=1){const t=l[e],r=i[e];t instanceof Error&&void 0===u&&(u=t),a[r.toString()]=t}if(u)throw u;return l}),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==n?.returnExceptions)throw e}return Object.keys(a).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>a[parseInt(e,10)]))}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class k extends v{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await(0,m.Le)(t),s=await(r?.handleChainStart(this.toJSON(),b(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let n,a=e;try{const e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){const n=e[r];a=await n.invoke(a,this._patchConfig(t,s?.getChild(`seq:step:${r+1}`)))}n=await this.last.invoke(a,this._patchConfig(t,s?.getChild(`seq:step:${this.steps.length}`)))}catch(e){throw await(s?.handleChainError(e)),e}return await(s?.handleChainEnd(b(n,"output"))),n}async batch(e,t,r){const s=this._getOptionsList(t??{},e.length),n=await Promise.all(s.map(m.Le)),a=await Promise.all(n.map(((t,r)=>t?.handleChainStart(this.toJSON(),b(e[r],"input"),void 0,void 0,void 0,void 0,s[r].runName))));let i,o=e;try{const e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){const n=e[t];o=await n.batch(o,a.map(((e,r)=>this._patchConfig(s[r],e?.getChild(`seq:step:${t+1}`)))),r)}i=await this.last.batch(o,a.map((e=>this._patchConfig(s[this.steps.length-1],e?.getChild(`seq:step:${this.steps.length}`)))),r)}catch(e){throw await Promise.all(a.map((t=>t?.handleChainError(e)))),e}return await Promise.all(a.map(((e,t)=>e?.handleChainEnd(b(i[t],"output"))))),i}async*_streamIterator(e,t){const r=await(0,m.Le)(t),s=await(r?.handleChainStart(this.toJSON(),b(e,"input"),void 0,void 0,void 0,void 0,t?.runName)),n=[this.first,...this.middle,this.last];let a,i=!0;try{let r=n[0].transform(async function*(){yield e}(),this._patchConfig(t,s?.getChild("seq:step:1")));for(let e=1;e<n.length;e+=1){const a=n[e];r=await a.transform(r,this._patchConfig(t,s?.getChild(`seq:step:${e+1}`)))}for await(const e of r)if(yield e,i)if(void 0===a)a=e;else try{a=l(a,e)}catch(e){a=void 0,i=!1}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(b(a,"output")))}pipe(e){return k.isRunnableSequence(e)?new k({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new k({first:this.first,middle:[...this.middle,this.last],last:I(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&v.isRunnable(e)}static from([e,...t],r){return new k({first:I(e),middle:t.slice(0,-1).map(I),last:I(t[t.length-1]),name:r})}}class P extends v{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=I(r)}static from(e){return new P({steps:e})}async invoke(e,t){const r=await(0,m.Le)(t),s=await(r?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName)),n={};try{await Promise.all(Object.entries(this.steps).map((async([r,a])=>{n[r]=await a.invoke(e,this._patchConfig(t,s?.getChild(`map:key:${r}`)))})))}catch(e){throw await(s?.handleChainError(e)),e}return await(s?.handleChainEnd(n)),n}async*_transform(e,t,r){const s={...this.steps},n=c(e,Object.keys(s).length),a=new Map(Object.entries(s).map((([e,s],a)=>{const i=s.transform(n[a],this._patchConfig(r,t?.getChild(`map:key:${e}`)));return[e,i.next().then((t=>({key:e,gen:i,result:t})))]})));for(;a.size;){const{key:e,result:t,gen:r}=await Promise.race(a.values());a.delete(e),t.done||(yield{[e]:t.value},a.set(e,r.next().then((t=>({key:e,gen:r,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return o.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}class T extends v{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new T({func:e})}async _invoke(e,t,r){let s=await this.func(e,{config:t});if(s&&v.isRunnable(s)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");s=await s.invoke(e,this._patchConfig(t,r?.getChild(),(t?.recursionLimit??m.ov)-1))}return s}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let s;for await(const t of e)if(void 0===s)s=t;else try{s=l(s,t)}catch(e){s=t}const n=await this.func(s,{config:r});if(n&&v.isRunnable(n)){if(0===r?.recursionLimit)throw new Error("Recursion limit reached.");const e=await n.stream(s,this._patchConfig(r,t?.getChild(),(r?.recursionLimit??m.ov)-1));for await(const t of e)yield t}else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return o.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}class x extends v{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await n.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),s=await(r?.handleChainStart(this.toJSON(),b(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let a;for(const r of this.runnables())try{const n=await r.invoke(e,this._patchConfig(t,s?.getChild()));return await(s?.handleChainEnd(b(n,"output"))),n}catch(e){void 0===a&&(a=e)}if(void 0===a)throw new Error("No error stored at end of fallback.");throw await(s?.handleChainError(a)),a}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map((e=>n.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),i=await Promise.all(a.map(((t,r)=>t?.handleChainStart(this.toJSON(),b(e[r],"input"),void 0,void 0,void 0,void 0,s[r].runName))));let o;for(const t of this.runnables())try{const n=await t.batch(e,i.map(((e,t)=>this._patchConfig(s[t],e?.getChild()))),r);return await Promise.all(i.map(((e,t)=>e?.handleChainEnd(b(n[t],"output"))))),n}catch(e){void 0===o&&(o=e)}if(!o)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(i.map((e=>e?.handleChainError(o)))),o}}function I(e){if("function"==typeof e)return new T({func:e});if(v.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,s]of Object.entries(e))t[r]=I(s);return new P({steps:t})}}class A extends v{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof P&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const s=this.mapper.getStepsKeys(),[n,a]=c(e),i=this.mapper.transform(a,this._patchConfig(r,t?.getChild())),o=i.next();for await(const e of n){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!s.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of i)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return o.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}class E extends v{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return o.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}},7798:(e,t,r)=>{"use strict";r.d(t,{Le:()=>a,ov:()=>n,t8:()=>i});var s=r(3905);const n=25;async function a(e){return s.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function i(e,t){const r={...e};if(t)for(const n of Object.keys(t))if("metadata"===n)r[n]={...r[n],...t[n]};else if("tags"===n)r[n]=(r[n]??[]).concat(t[n]??[]);else if("configurable"===n)r[n]={...r[n],...t[n]};else if("callbacks"===n){const n=r.callbacks,a=t.callbacks??e.callbacks;if(Array.isArray(a))if(n)if(Array.isArray(n))r.callbacks=n.concat(a);else{const e=n.copy();for(const t of a)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=a;else if(a)if(n)if(Array.isArray(n)){const e=a.copy();for(const t of n)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=new s.Ye(a.parentRunId,{handlers:n.handlers.concat(a.handlers),inheritableHandlers:n.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(n.tags.concat(a.tags))),inheritableTags:Array.from(new Set(n.inheritableTags.concat(a.inheritableTags))),metadata:{...n.metadata,...a.metadata}});else r.callbacks=a}else r[n]=t[n]??r[n];return r}},9730:(e,t,r)=>{"use strict";r.d(t,{eq:()=>s.eq,sk:()=>n,lW:()=>s.lW});var s=r(3450);r(7798);class n extends s.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"RunnablePassthrough"}async invoke(e,t){return this._callWithConfig((e=>Promise.resolve(e)),e,t)}transform(e,t){return this._transformStreamWithConfig(e,(e=>e),t)}static assign(e){return new s.Vh(new s.dT({steps:e}))}}r(3908)},4075:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(6515);function n(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class a extends s.E{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=(r=e.start_time,s=e.id,`${new Date(r).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+s);var r,s;const n={...e};if(void 0!==n.parent_run_id){const e=this.runMap.get(n.parent_run_id);e&&(this._addChildRun(e,n),e.child_execution_order=Math.max(e.child_execution_order,n.child_execution_order),n.trace_id=e.trace_id,void 0!==e.dotted_order?n.dotted_order=[e.dotted_order,t].join("."):console.warn(`Parent run with UUID ${n.parent_run_id} not found.`))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),await(this.onRunCreate?.(n))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,s,n,a,i,o){const c=this._getExecutionOrder(s),l=Date.now(),u=i?{...n,metadata:i}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:a||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleChatModelStart(e,t,r,s,n,a,i,o){const c=this._getExecutionOrder(s),l=Date.now(),u=i?{...n,metadata:i}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:a||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleLLMEnd(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onLLMEnd?.(r)),await this._endTrace(r),r}async handleLLMError(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onLLMError?.(r)),await this._endTrace(r),r}async handleChainStart(e,t,r,s,n,a,i,o){const c=this._getExecutionOrder(s),l=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:i??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return await this._startTrace(u),await(this.onChainStart?.(u)),u}async handleChainEnd(e,t,r,s,a){const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=n(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),void 0!==a?.inputs&&(i.inputs=n(a.inputs,"input")),await(this.onChainEnd?.(i)),await this._endTrace(i),i}async handleChainError(e,t,r,s,a){const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=e.message,i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),void 0!==a?.inputs&&(i.inputs=n(a.inputs,"input")),await(this.onChainError?.(i)),await this._endTrace(i),i}async handleToolStart(e,t,r,s,n,a,i){const o=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:i??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return await this._startTrace(l),await(this.onToolStart?.(l)),l}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onToolEnd?.(r)),await this._endTrace(r),r}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onToolError?.(r)),await this._endTrace(r),r}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}async handleRetrieverStart(e,t,r,s,n,a,i){const o=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:i??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return await this._startTrace(l),await(this.onRetrieverStart?.(l)),l}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r),r}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverError?.(r)),await this._endTrace(r),r}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r,s,n,a){const i=this.runMap.get(r);if(!i||"llm"!==i?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return i.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await(this.onLLMNewToken?.(i,e)),i}}},9636:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var s=r(2693),n=r(5860);const a=[400,401,402,403,404,405,406,407,408,409],i=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&a.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??i;const t=n.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>s((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},6374:(e,t,r)=>{"use strict";r.d(t,{lS:()=>i,sA:()=>a});const s=()=>"undefined"!=typeof Deno;let n;async function a(){if(void 0===n){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||s()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":s()?"deno":"other":"node",e})();n={library:"langchain-js",runtime:e}}return n}function i(e){try{return"undefined"!=typeof process?"MISSING_ENV_VAR"?.[e]:void 0}catch(e){return}}},344:(e,t,r)=>{"use strict";r.d(t,{af:()=>y});var s={};r.r(s),r.d(s,{JsonPatchError:()=>d,_areEquals:()=>w,applyOperation:()=>g,applyPatch:()=>y,applyReducer:()=>b,deepClone:()=>h,getValueByPointer:()=>m,validate:()=>_,validator:()=>v});const n=Object.prototype.hasOwnProperty;function a(e,t){return n.call(e,t)}function i(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function o(e){let t=0;const r=e.length;let s;for(;t<r;){if(s=e.charCodeAt(t),!(s>=48&&s<=57))return!1;t++}return!0}function c(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(c(e[t]))return!0}else if("object"==typeof e){const r=function(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)a(e,r)&&t.push(r);return t}(e),s=r.length;for(var t=0;t<s;t++)if(c(e[r[t]]))return!0}return!1}function l(e,t){const r=[e];for(const e in t){const s="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==s&&r.push(`${e}: ${s}`)}return r.join("\n")}class u extends Error{constructor(e,t,r,s,n){super(l(e,{name:t,index:r,operation:s,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=l(e,{name:t,index:r,operation:s,tree:n})}}const d=u,h=i,p={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var s=e[t];return delete e[t],{newDocument:r,removed:s}},replace:function(e,t,r){var s=e[t];return e[t]=this.value,{newDocument:r,removed:s}},move:function(e,t,r){let s=m(r,this.path);s&&(s=i(s));const n=g(r,{op:"remove",path:this.from}).removed;return g(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:s}},copy:function(e,t,r){const s=m(r,this.from);return g(r,{op:"add",path:this.path,value:i(s)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:w(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var f={add:function(e,t,r){return o(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var s=e[t];return e[t]=this.value,{newDocument:r,removed:s}},move:p.move,copy:p.copy,test:p.test,_get:p._get};function m(e,t){if(""==t)return e;var r={op:"_get",path:t};return g(e,r),r.value}function g(e,t,r=!1,s=!0,n=!0,a=0){if(r&&("function"==typeof r?r(t,0,e,t.path):v(t,0)),""===t.path){let s={newDocument:e};if("add"===t.op)return s.newDocument=t.value,s;if("replace"===t.op)return s.newDocument=t.value,s.removed=e,s;if("move"===t.op||"copy"===t.op)return s.newDocument=m(e,t.from),"move"===t.op&&(s.removed=e),s;if("test"===t.op){if(s.test=w(e,t.value),!1===s.test)throw new d("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return s.newDocument=e,s}if("remove"===t.op)return s.removed=e,s.newDocument=null,s;if("_get"===t.op)return t.value=e,s;if(r)throw new d("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return s}{s||(e=i(e));const c=(t.path||"").split("/");let l,u,h,m=e,g=1,y=c.length;for(h="function"==typeof r?r:v;;){if(u=c[g],u&&-1!=u.indexOf("~")&&(u=u.replace(/~1/g,"/").replace(/~0/g,"~")),n&&("__proto__"==u||"prototype"==u&&g>0&&"constructor"==c[g-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===l&&(void 0===m[u]?l=c.slice(0,g).join("/"):g==y-1&&(l=t.path),void 0!==l&&h(t,0,e,l)),g++,Array.isArray(m)){if("-"===u)u=m.length;else{if(r&&!o(u))throw new d("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);o(u)&&(u=~~u)}if(g>=y){if(r&&"add"===t.op&&u>m.length)throw new d("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);const s=f[t.op].call(t,m,u,e);if(!1===s.test)throw new d("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return s}}else if(g>=y){const r=p[t.op].call(t,m,u,e);if(!1===r.test)throw new d("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}if(m=m[u],r&&g<y&&(!m||"object"!=typeof m))throw new d("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function y(e,t,r,s=!0,n=!0){if(r&&!Array.isArray(t))throw new d("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(e=i(e));const a=new Array(t.length);for(let s=0,i=t.length;s<i;s++)a[s]=g(e,t[s],r,!0,n,s),e=a[s].newDocument;return a.newDocument=e,a}function b(e,t,r){const s=g(e,t);if(!1===s.test)throw new d("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return s.newDocument}function v(e,t,r,s){if("object"!=typeof e||null===e||Array.isArray(e))throw new d("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(!p[e.op])throw new d("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r);if("string"!=typeof e.path)throw new d("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new d('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new d("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new d("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&c(e.value))throw new d("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r)if("add"==e.op){var n=e.path.split("/").length,a=s.split("/").length;if(n!==a+1&&n!==a)throw new d("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==s)throw new d("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var i=_([{op:"_get",path:e.from,value:void 0}],r);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new d("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}function _(e,t,r){try{if(!Array.isArray(e))throw new d("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)y(i(t),i(e),r||!0);else{r=r||v;for(var s=0;s<e.length;s++)r(e[s],s,t,void 0)}}catch(e){if(e instanceof d)return e;throw e}}function w(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,s,n,a=Array.isArray(e),i=Array.isArray(t);if(a&&i){if((s=e.length)!=t.length)return!1;for(r=s;0!=r--;)if(!w(e[r],t[r]))return!1;return!0}if(a!=i)return!1;var o=Object.keys(e);if((s=o.length)!==Object.keys(t).length)return!1;for(r=s;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=s;0!=r--;)if(!w(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}new WeakMap},7265:(e,t,r)=>{"use strict";r.d(t,{z7:()=>Zr,V6:()=>Ur});var s={};r.r(s),r.d(s,{APIConnectionError:()=>k,APIConnectionTimeoutError:()=>P,APIError:()=>w,APIUserAbortError:()=>O,AuthenticationError:()=>x,BadRequestError:()=>T,ConflictError:()=>E,InternalServerError:()=>C,NotFoundError:()=>A,OpenAIError:()=>_,PermissionDeniedError:()=>I,RateLimitError:()=>j,UnprocessableEntityError:()=>S});const n="4.24.3";let a,i,o,c,l,u,d,h,p,f=!1,m=null,g=null,y=null,b=null;class v{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}a||function(e,t={auto:!1}){if(f)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(a)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${a}'\``);f=t.auto,a=e.kind,i=e.fetch,m=e.Request,g=e.Response,y=e.Headers,o=e.FormData,b=e.Blob,c=e.File,l=e.ReadableStream,u=e.getMultipartRequestOptions,d=e.getDefaultAgent,h=e.fileFromPath,p=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let r,s,n,a;try{r=fetch,s=Request,n=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:r,Request:s,Response:n,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new v(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class _ extends Error{}class w extends _{constructor(e,t,r,s){super(`${w.makeMessage(e,t,r)}`),this.status=e,this.headers=s;const n=t;this.error=n,this.code=n?.code,this.param=n?.param,this.type=n?.type}static makeMessage(e,t,r){const s=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new k({cause:ie(t)});const n=t?.error;return 400===e?new T(e,n,r,s):401===e?new x(e,n,r,s):403===e?new I(e,n,r,s):404===e?new A(e,n,r,s):409===e?new E(e,n,r,s):422===e?new S(e,n,r,s):429===e?new j(e,n,r,s):e>=500?new C(e,n,r,s):new w(e,n,r,s)}}class O extends w{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class k extends w{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class P extends k{constructor({message:e}={}){super({message:e??"Request timed out."})}}class T extends w{constructor(){super(...arguments),this.status=400}}class x extends w{constructor(){super(...arguments),this.status=401}}class I extends w{constructor(){super(...arguments),this.status=403}}class A extends w{constructor(){super(...arguments),this.status=404}}class E extends w{constructor(){super(...arguments),this.status=409}}class S extends w{constructor(){super(...arguments),this.status=422}}class j extends w{constructor(){super(...arguments),this.status=429}}class C extends w{}class R{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;const s=new N;return new R((async function*(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const r of async function*(){if(!e.body)throw t.abort(),new _("Attempted to iterate over a response with no body");const r=new $,n=L(e.body);for await(const e of n)for(const t of r.decode(e)){const e=s.decode(t);e&&(yield e)}for(const e of r.flush()){const t=s.decode(e);t&&(yield t)}}())if(!n)if(r.data.startsWith("[DONE]"))n=!0;else if(null===r.event){let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if(e&&e.error)throw new w(void 0,e.error,void 0,void 0);yield e}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let r=!1;return new R((async function*(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const t of async function*(){const t=new $,r=L(e);for await(const e of r)for(const r of t.decode(e))yield r;for(const e of t.flush())yield e}())s||t&&(yield JSON.parse(t));s=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{s||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=s=>({next:()=>{if(0===s.length){const s=r.next();e.push(s),t.push(s)}return s.shift()}});return[new R((()=>s(e)),this.controller),new R((()=>s(t)),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new l({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:s,done:n}=await t.next();if(n)return e.close();const a=r.encode(JSON.stringify(s)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class N{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=function(e,t){const r=e.indexOf(":");return-1!==r?[e.substring(0,r),":",e.substring(r+":".length)]:[e,"",""]}(e);return s.startsWith(" ")&&(s=s.substring(1)),"event"===t?this.event=s:"data"===t&&this.data.push(s),null}}class ${constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=$.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split($.NEWLINE_REGEXP);return 1!==s.length||r?(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s):(this.buffer.push(s[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new _(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new _(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new _("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function L(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}$.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","","","","","\u2028","\u2029"]),$.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;const D=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,M=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function Z(e,t,r={}){if(e=await e,D(e)){const s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new c([s],t,r)}const s=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(M(e))t.push(await e.arrayBuffer());else{if(!z(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const r of e)t.push(r)}return t}(e);if(t||(t=function(e){return U(e.name)||U(e.filename)||U(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!r.type){const e=s[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new c(s,t,r)}const U=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,z=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],F=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],B=async e=>{const t=await V(e.body);return u(t,e)},V=async e=>{const t=new o;return await Promise.all(Object.entries(e||{}).map((([e,r])=>q(t,e,r)))),t},q=async(e,t,r)=>{if(void 0!==r){if(null==r)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if((e=>(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&M(e))(e)||D(e)||p(e))(r)){const s=await Z(r);e.append(t,s)}else if(Array.isArray(r))await Promise.all(r.map((r=>q(e,t+"[]",r))));else{if("object"!=typeof r)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`);await Promise.all(Object.entries(r).map((([r,s])=>q(e,`${t}[${r}]`,s))))}}};var K;async function H(e){const{response:t}=e;if(e.options.stream)return de("response",t.status,t.url,t.headers,t.body),R.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;if(t.headers.get("content-type")?.includes("application/json")){const e=await t.json();return de("response",t.status,t.url,t.headers,e),e}const r=await t.text();return de("response",t.status,t.url,t.headers,r),r}class J extends Promise{constructor(e,t=H){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new J(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class W{constructor(e,t,r,s){K.set(this,void 0),function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===s?n.call(e,r):n?n.value=r:t.set(e,r)}(this,K,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new _("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,s]of r)e.url.searchParams.set(t,s);t.query=void 0,t.path=e.url.toString()}return await function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}(this,K,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(K=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class G extends J{constructor(e,t,r){super(t,(async t=>new r(e,t.response,await H(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const X={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0},Y=e=>"object"==typeof e&&null!==e&&!ce(e)&&Object.keys(e).every((e=>le(X,e))),Q=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ee=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let te;const re=()=>te??(te=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":ee(Deno.build.os),"X-Stainless-Arch":Q(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":ee(process.platform),"X-Stainless-Arch":Q(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:r}of e){const e=r.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),se=new RegExp("^(?:[a-z]+:)?//","i"),ne=e=>new Promise((t=>setTimeout(t,e))),ae=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new _(`${e} must be an integer`);if(t<0)throw new _(`${e} must be a positive integer`);return t},ie=e=>e instanceof Error?e:new Error(e),oe=e=>"undefined"!=typeof process?"MISSING_ENV_VAR"?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function ce(e){if(!e)return!0;for(const t in e)return!1;return!0}function le(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ue(e,t){for(const r in t){if(!le(t,r))continue;const s=r.toLowerCase();if(!s)continue;const n=t[r];null===n?delete e[s]:void 0!==n&&(e[s]=n)}}function de(e,...t){"undefined"!=typeof process&&"true"==="MISSING_ENV_VAR".DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}class he extends W{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class pe extends W{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class fe{constructor(e){this._client=e}}class me extends fe{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}me||(me={});class ge extends fe{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}ge||(ge={});class ye extends fe{constructor(){super(...arguments),this.completions=new ge(this._client)}}!function(e){e.Completions=ge}(ye||(ye={}));class be extends fe{create(e,t){return this._client.post("/edits",{body:e,...t})}}be||(be={});class ve extends fe{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}ve||(ve={});class _e extends fe{create(e,t){return this._client.post("/files",B({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/files",we,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){const s=new Set(["processed","error","deleted"]),n=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await ne(t),a=await this.retrieve(e),Date.now()-n>r)throw new P({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class we extends he{}!function(e){e.FileObjectsPage=we}(_e||(_e={}));class Oe extends fe{createVariation(e,t){return this._client.post("/images/variations",B({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",B({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Oe||(Oe={});class ke extends fe{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}ke||(ke={});class Pe extends fe{create(e,t){return this._client.post("/audio/transcriptions",B({body:e,...t}))}}Pe||(Pe={});class Te extends fe{create(e,t){return this._client.post("/audio/translations",B({body:e,...t}))}}Te||(Te={});class xe extends fe{constructor(){super(...arguments),this.transcriptions=new Pe(this._client),this.translations=new Te(this._client),this.speech=new ke(this._client)}}!function(e){e.Transcriptions=Pe,e.Translations=Te,e.Speech=ke}(xe||(xe={}));class Ie extends fe{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Ie||(Ie={});class Ae extends fe{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ee,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Ee extends he{}!function(e){e.ModelsPage=Ee}(Ae||(Ae={}));class Se extends fe{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",je,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Y(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ce,{query:t,...r})}}class je extends pe{}class Ce extends pe{}!function(e){e.FineTuningJobsPage=je,e.FineTuningJobEventsPage=Ce}(Se||(Se={}));class Re extends fe{constructor(){super(...arguments),this.jobs=new Se(this._client)}}!function(e){e.Jobs=Se,e.FineTuningJobsPage=je,e.FineTuningJobEventsPage=Ce}(Re||(Re={}));class Ne extends fe{create(e,t){return this._client.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine-tunes/${e}`,t)}list(e){return this._client.getAPIList("/fine-tunes",$e,e)}cancel(e,t){return this._client.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){return this._client.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:t?.stream??!1})}}class $e extends he{}!function(e){e.FineTunesPage=$e}(Ne||(Ne={}));class Le extends fe{create(e,t,r){return this._client.post(`/assistants/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t={},r){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,De,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}del(e,t,r){return this._client.delete(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class De extends pe{}!function(e){e.AssistantFilesPage=De}(Le||(Le={}));class Me extends fe{constructor(){super(...arguments),this.files=new Le(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/assistants",Ze,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}class Ze extends pe{}function Ue(e){return"function"==typeof e.parse}!function(e){e.AssistantsPage=Ze,e.Files=Le,e.AssistantFilesPage=De}(Me||(Me={}));const ze=e=>"assistant"===e?.role,Fe=e=>"function"===e?.role,Be=e=>"tool"===e?.role;var Ve,qe,Ke,He,Je,We,Ge,Xe,Ye,Qe,et,tt,rt,st,nt,at,it,ot,ct,lt,ut=function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},dt=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};const ht=10;class pt{constructor(){Ve.add(this),this.controller=new AbortController,qe.set(this,void 0),Ke.set(this,(()=>{})),He.set(this,(()=>{})),Je.set(this,void 0),We.set(this,(()=>{})),Ge.set(this,(()=>{})),Xe.set(this,{}),this._chatCompletions=[],this.messages=[],Ye.set(this,!1),Qe.set(this,!1),et.set(this,!1),tt.set(this,!1),ot.set(this,(e=>{if(ut(this,Qe,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new O),e instanceof O)return ut(this,et,!0,"f"),this._emit("abort",e);if(e instanceof _)return this._emit("error",e);if(e instanceof Error){const t=new _(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new _(String(e)))})),ut(this,qe,new Promise(((e,t)=>{ut(this,Ke,e,"f"),ut(this,He,t,"f")})),"f"),ut(this,Je,new Promise(((e,t)=>{ut(this,We,e,"f"),ut(this,Ge,t,"f")})),"f"),dt(this,qe,"f").catch((()=>{})),dt(this,Je,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),dt(this,ot,"f"))}),0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Fe(e)||Be(e))&&e.content)this._emit("functionCallResult",e.content);else if(ze(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ze(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}_connected(){this.ended||(dt(this,Ke,"f").call(this),this._emit("connect"))}get ended(){return dt(this,Ye,"f")}get errored(){return dt(this,Qe,"f")}get aborted(){return dt(this,et,"f")}abort(){this.controller.abort()}on(e,t){return(dt(this,Xe,"f")[e]||(dt(this,Xe,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=dt(this,Xe,"f")[e];if(!r)return this;const s=r.findIndex((e=>e.listener===t));return s>=0&&r.splice(s,1),this}once(e,t){return(dt(this,Xe,"f")[e]||(dt(this,Xe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,r)=>{ut(this,tt,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)}))}async done(){ut(this,tt,!0,"f"),await dt(this,Je,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new _("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),dt(this,Ve,"m",rt).call(this)}async finalMessage(){return await this.done(),dt(this,Ve,"m",st).call(this)}async finalFunctionCall(){return await this.done(),dt(this,Ve,"m",nt).call(this)}async finalFunctionCallResult(){return await this.done(),dt(this,Ve,"m",at).call(this)}async totalUsage(){return await this.done(),dt(this,Ve,"m",it).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(dt(this,Ye,"f"))return;"end"===e&&(ut(this,Ye,!0,"f"),dt(this,We,"f").call(this));const r=dt(this,Xe,"f")[e];if(r&&(dt(this,Xe,"f")[e]=r.filter((e=>!e.once)),r.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return dt(this,tt,"f")||r?.length||Promise.reject(e),dt(this,He,"f").call(this,e),dt(this,Ge,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];dt(this,tt,"f")||r?.length||Promise.reject(e),dt(this,He,"f").call(this,e),dt(this,Ge,"f").call(this,e),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=dt(this,Ve,"m",st).call(this);t&&this._emit("finalMessage",t);const r=dt(this,Ve,"m",rt).call(this);r&&this._emit("finalContent",r);const s=dt(this,Ve,"m",nt).call(this);s&&this._emit("finalFunctionCall",s);const n=dt(this,Ve,"m",at).call(this);null!=n&&this._emit("finalFunctionCallResult",n),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",dt(this,Ve,"m",it).call(this))}async _createChatCompletion(e,t,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),dt(this,Ve,"m",ct).call(this,t);const n=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(n)}async _runChatCompletion(e,t,r){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){const s="function",{function_call:n="auto",stream:a,...i}=t,o="string"!=typeof n&&n?.name,{maxChatCompletions:c=ht}=r||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=(await this._createChatCompletion(e,{...i,function_call:n,functions:u,messages:[...this.messages]},r)).choices[0]?.message;if(!t)throw new _("missing message in ChatCompletion response");if(!t.function_call)return;const{name:a,arguments:c}=t.function_call,d=l[a];if(!d){const e=`Invalid function_call: ${JSON.stringify(a)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:s,name:a,content:e});continue}if(o&&o!==a){const e=`Invalid function_call: ${JSON.stringify(a)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:s,name:a,content:e});continue}let h;try{h=Ue(d)?await d.parse(c):c}catch(e){this._addMessage({role:s,name:a,content:e instanceof Error?e.message:String(e)});continue}const p=await d.function(h,this),f=dt(this,Ve,"m",lt).call(this,p);if(this._addMessage({role:s,name:a,content:f}),o)return}}async _runTools(e,t,r){const s="tool",{tool_choice:n="auto",stream:a,...i}=t,o="string"!=typeof n&&n?.function?.name,{maxChatCompletions:c=ht}=r||{},l={};for(const e of t.tools)"function"===e.type&&(l[e.function.name||e.function.function.name]=e.function);const u="tools"in t?t.tools.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=(await this._createChatCompletion(e,{...i,tool_choice:n,tools:u,messages:[...this.messages]},r)).choices[0]?.message;if(!t)throw new _("missing message in ChatCompletion response");if(!t.tool_calls)return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:r,arguments:n}=e.function,a=l[r];if(!a){const e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${u.map((e=>JSON.stringify(e.function.name))).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:t,content:e});continue}if(o&&o!==r){const e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:s,tool_call_id:t,content:e});continue}let i;try{i=Ue(a)?await a.parse(n):n}catch(e){const r=e instanceof Error?e.message:String(e);this._addMessage({role:s,tool_call_id:t,content:r});continue}const c=await a.function(i,this),d=dt(this,Ve,"m",lt).call(this,c);if(this._addMessage({role:s,tool_call_id:t,content:d}),o)return}}}}qe=new WeakMap,Ke=new WeakMap,He=new WeakMap,Je=new WeakMap,We=new WeakMap,Ge=new WeakMap,Xe=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,et=new WeakMap,tt=new WeakMap,ot=new WeakMap,Ve=new WeakSet,rt=function(){return dt(this,Ve,"m",st).call(this).content??null},st=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ze(t))return{...t,content:t.content??null}}throw new _("stream ended without producing a ChatCompletionMessage with role=assistant")},nt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ze(t)&&t?.function_call)return t.function_call;if(ze(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},at=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Fe(t)&&null!=t.content)return t.content;if(Be(t)&&null!=t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},it=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ct=function(e){if(null!=e.n&&e.n>1)throw new _("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},lt=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class ft extends pt{static runFunctions(e,t,r){const s=new ft,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run((()=>s._runFunctions(e,t,n))),s}static runTools(e,t,r){const s=new ft,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run((()=>s._runTools(e,t,n))),s}_addMessage(e){super._addMessage(e),ze(e)&&e.content&&this._emit("content",e.content)}}var mt,gt,yt,bt,vt,_t,wt,Ot=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},kt=function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r};class Pt extends pt{constructor(){super(...arguments),mt.add(this),gt.set(this,void 0)}get currentChatCompletionSnapshot(){return Ot(this,gt,"f")}static fromReadableStream(e){const t=new Pt;return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,r){const s=new Pt;return s._run((()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),s}async _createChatCompletion(e,t,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),Ot(this,mt,"m",yt).call(this);const n=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const e of n)Ot(this,mt,"m",bt).call(this,e);if(n.controller.signal?.aborted)throw new O;return this._addChatCompletion(Ot(this,mt,"m",vt).call(this))}async _fromReadableStream(e,t){const r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Ot(this,mt,"m",yt).call(this),this._connected();const s=R.fromReadableStream(e,this.controller);let n;for await(const e of s)n&&n!==e.id&&this._addChatCompletion(Ot(this,mt,"m",vt).call(this)),Ot(this,mt,"m",bt).call(this,e),n=e.id;if(s.controller.signal?.aborted)throw new O;return this._addChatCompletion(Ot(this,mt,"m",vt).call(this))}[(gt=new WeakMap,mt=new WeakSet,yt=function(){this.ended||kt(this,gt,void 0,"f")},bt=function(e){if(this.ended)return;const t=Ot(this,mt,"m",_t).call(this,e);this._emit("chunk",e,t);const r=e.choices[0]?.delta?.content,s=t.choices[0]?.message;null!=r&&"assistant"===s?.role&&s?.content&&this._emit("content",r,s.content)},vt=function(){if(this.ended)throw new _("stream has ended, this shouldn't happen");const e=Ot(this,gt,"f");if(!e)throw new _("request ended without sending any chunks");return kt(this,gt,void 0,"f"),function(e){const{id:t,choices:r,created:s,model:n}=e;return{id:t,choices:r.map((({message:t,finish_reason:r,index:s,logprobs:n})=>{if(!r)throw new _(`missing finish_reason for choice ${s}`);const{content:a=null,function_call:i,tool_calls:o}=t,c=t.role;if(!c)throw new _(`missing role for choice ${s}`);if(i){const{arguments:e,name:t}=i;if(null==e)throw new _(`missing function_call.arguments for choice ${s}`);if(!t)throw new _(`missing function_call.name for choice ${s}`);return{message:{content:a,function_call:{arguments:e,name:t},role:c},finish_reason:r,index:s,logprobs:n}}return o?{index:s,finish_reason:r,logprobs:n,message:{role:c,content:a,tool_calls:o.map(((t,r)=>{const{function:n,type:a,id:i}=t,{arguments:o,name:c}=n||{};if(null==i)throw new _(`missing choices[${s}].tool_calls[${r}].id\n${Tt(e)}`);if(null==a)throw new _(`missing choices[${s}].tool_calls[${r}].type\n${Tt(e)}`);if(null==c)throw new _(`missing choices[${s}].tool_calls[${r}].function.name\n${Tt(e)}`);if(null==o)throw new _(`missing choices[${s}].tool_calls[${r}].function.arguments\n${Tt(e)}`);return{id:i,type:a,function:{name:c,arguments:o}}}))}}:{message:{content:a,role:c},finish_reason:r,index:s,logprobs:n}})),created:s,model:n,object:"chat.completion"}}(e)},_t=function(e){var t,r,s;let n=Ot(this,gt,"f");const{choices:a,...i}=e;n?Object.assign(n,i):n=kt(this,gt,{...i,choices:[]},"f");for(const{delta:a,finish_reason:i,index:o,logprobs:c=null,...l}of e.choices){let e=n.choices[o];if(!e){n.choices[o]={finish_reason:i,index:o,message:a,logprobs:c,...l};continue}if(c&&(e.logprobs?c.content&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...c.content)):e.logprobs=c),i&&(e.finish_reason=i),Object.assign(e,l),!a)continue;const{content:u,function_call:d,role:h,tool_calls:p}=a;if(u&&(e.message.content=(e.message.content||"")+u),h&&(e.message.role=h),d&&(e.message.function_call?(d.name&&(e.message.function_call.name=d.name),d.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=d.arguments)):e.message.function_call=d),p){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:r,type:n,function:a}of p){const i=(s=e.message.tool_calls)[t]??(s[t]={});r&&(i.id=r),n&&(i.type=n),a&&(i.function??(i.function={arguments:""})),a?.name&&(i.function.name=a.name),a?.arguments&&(i.function.arguments+=a.arguments)}}}return n},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",(r=>{const s=t.shift();s?s(r):e.push(r)})),this.on("end",(()=>{r=!0;for(const e of t)e(void 0);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e=>t.push(e))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}))}}toReadableStream(){return new R(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Tt(e){return JSON.stringify(e)}class xt extends Pt{static fromReadableStream(e){const t=new xt;return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,r){const s=new xt,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run((()=>s._runFunctions(e,t,n))),s}static runTools(e,t,r){const s=new xt,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run((()=>s._runTools(e,t,n))),s}}class It extends fe{runFunctions(e,t){return e.stream?xt.runFunctions(this._client.chat.completions,e,t):ft.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?xt.runTools(this._client.chat.completions,e,t):ft.runTools(this._client.chat.completions,e,t)}stream(e,t){return Pt.createChatCompletion(this._client.chat.completions,e,t)}}class At extends fe{constructor(){super(...arguments),this.completions=new It(this._client)}}!function(e){e.Completions=It}(At||(At={}));class Et extends fe{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/messages/${t}/files/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(e,t,r={},s){return Y(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,St,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}}class St extends pe{}!function(e){e.MessageFilesPage=St}(Et||(Et={}));class jt extends fe{constructor(){super(...arguments),this.files=new Et(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(e,t={},r){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ct,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class Ct extends pe{}!function(e){e.ThreadMessagesPage=Ct,e.Files=Et,e.MessageFilesPage=St}(jt||(jt={}));class Rt extends fe{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(e,t,r={},s){return Y(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Nt,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}}class Nt extends pe{}!function(e){e.RunStepsPage=Nt}(Rt||(Rt={}));class $t extends fe{constructor(){super(...arguments),this.steps=new Rt(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(e,t={},r){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Lt,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}}class Lt extends pe{}!function(e){e.RunsPage=Lt,e.Steps=Rt,e.RunStepsPage=Nt}($t||($t={}));class Dt extends fe{constructor(){super(...arguments),this.runs=new $t(this._client),this.messages=new jt(this._client)}create(e={},t){return Y(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}!function(e){e.Runs=$t,e.RunsPage=Lt,e.Messages=jt,e.ThreadMessagesPage=Ct}(Dt||(Dt={}));class Mt extends fe{constructor(){super(...arguments),this.chat=new At(this._client),this.assistants=new Me(this._client),this.threads=new Dt(this._client)}}!function(e){e.Chat=At,e.Assistants=Me,e.AssistantsPage=Ze,e.Threads=Dt}(Mt||(Mt={}));class Zt extends class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:n}){this.baseURL=e,this.maxRetries=ae("maxRetries",t),this.timeout=ae("timeout",r),this.httpAgent=s,this.fetch=n??i}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...re(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then((r=>({method:e,path:t,...r}))))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}return null}buildRequest(e){const{method:t,path:r,query:s,headers:n={}}=e,a=F(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,i=this.calculateContentLength(a),o=this.buildURL(r,s);"timeout"in e&&ae("timeout",e.timeout);const c=e.timeout??this.timeout,l=e.httpAgent??this.httpAgent??d(o),u=c+1e3;return"number"==typeof l?.options?.timeout&&u>(l.options.timeout??0)&&(l.options.timeout=u),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...a&&{body:a},headers:this.buildHeaders({options:e,headers:n,contentLength:i}),...l&&{agent:l},signal:e.signal??null},url:o,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r}){const s={};return r&&(s["content-length"]=r),ue(s,this.defaultHeaders(e)),ue(s,t),F(e.body)&&"node"!==a&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,r,s){return w.generate(e,t,r,s)}request(e,t=null){return new J(this.makeRequest(e,t))}async makeRequest(e,t){const r=await e;null==t&&(t=r.maxRetries??this.maxRetries);const{req:s,url:n,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(s,{url:n,options:r}),de("request",n,r,s.headers),r.signal?.aborted)throw new O;const i=new AbortController,o=await this.fetchWithTimeout(n,s,a,i).catch(ie);if(o instanceof Error){if(r.signal?.aborted)throw new O;if(t)return this.retryRequest(r,t);if("AbortError"===o.name)throw new P;throw new k({cause:o})}const c=(l=o.headers,new Proxy(Object.fromEntries(l.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}));var l;if(!o.ok){if(t&&this.shouldRetry(o))return this.retryRequest(r,t,c);const e=await o.text().catch((e=>ie(e).message)),s=(e=>{try{return JSON.parse(e)}catch(e){return}})(e),a=s?void 0:e;throw de("response",o.status,n,c,a),this.makeStatusError(o.status,s,a,c)}return{response:o,options:r,controller:i}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new G(this,r,e)}buildURL(e,t){const r=(e=>se.test(e))(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ce(s)||(t={...s,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new _(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:n,...a}=t||{};n&&n.addEventListener("abort",(()=>s.abort()));const i=setTimeout((()=>s.abort()),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let s;const n=r?.["retry-after"];if(n){const e=parseInt(n);s=Number.isNaN(e)?Date.parse(n)-Date.now():1e3*e}if(!s||!Number.isInteger(s)||s<=0||s>6e4){const r=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,r)}return await ne(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e;return Math.min(.5*Math.pow(2,r),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS 4.24.3`}}{constructor({baseURL:e=oe("OPENAI_BASE_URL"),apiKey:t=oe("OPENAI_API_KEY"),organization:r=oe("OPENAI_ORG_ID")??null,...s}={}){if(void 0===t)throw new _("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const n={apiKey:t,organization:r,...s,baseURL:e||"https://api.openai.com/v1"};if(!n.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new _("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:n.baseURL,timeout:n.timeout??6e5,httpAgent:n.httpAgent,maxRetries:n.maxRetries,fetch:n.fetch}),this.completions=new me(this),this.chat=new ye(this),this.edits=new be(this),this.embeddings=new ve(this),this.files=new _e(this),this.images=new Oe(this),this.audio=new xe(this),this.moderations=new Ie(this),this.models=new Ae(this),this.fineTuning=new Re(this),this.fineTunes=new Ne(this),this.beta=new Mt(this),this._options=n,this.apiKey=t,this.organization=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}wt=Zt,Zt.OpenAI=wt,Zt.OpenAIError=_,Zt.APIError=w,Zt.APIConnectionError=k,Zt.APIConnectionTimeoutError=P,Zt.APIUserAbortError=O,Zt.NotFoundError=A,Zt.ConflictError=E,Zt.RateLimitError=j,Zt.BadRequestError=T,Zt.AuthenticationError=x,Zt.InternalServerError=C,Zt.PermissionDeniedError=I,Zt.UnprocessableEntityError=S;const{OpenAIError:Ut,APIError:zt,APIConnectionError:Ft,APIConnectionTimeoutError:Bt,APIUserAbortError:Vt,NotFoundError:qt,ConflictError:Kt,RateLimitError:Ht,BadRequestError:Jt,AuthenticationError:Wt,InternalServerError:Gt,PermissionDeniedError:Xt,UnprocessableEntityError:Yt}=s;var Qt;(Qt=Zt||(Zt={})).toFile=Z,Qt.fileFromPath=h,Qt.Page=he,Qt.CursorPage=pe,Qt.Completions=me,Qt.Chat=ye,Qt.Edits=be,Qt.Embeddings=ve,Qt.Files=_e,Qt.FileObjectsPage=we,Qt.Images=Oe,Qt.Audio=xe,Qt.Moderations=Ie,Qt.Models=Ae,Qt.ModelsPage=Ee,Qt.FineTuning=Re,Qt.FineTunes=Ne,Qt.FineTunesPage=$e,Qt.Beta=Mt;var er=r(3908);const tr="__run";class rr{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new rr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class sr extends rr{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new sr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}var nr=r(6374),ar="object"==typeof window?window:{},ir="0123456789abcdef".split(""),or=[-2147483648,8388608,32768,128],cr=[24,16,8,0],lr=[];function ur(e){e?(lr[0]=lr[16]=lr[1]=lr[2]=lr[3]=lr[4]=lr[5]=lr[6]=lr[7]=lr[8]=lr[9]=lr[10]=lr[11]=lr[12]=lr[13]=lr[14]=lr[15]=0,this.blocks=lr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ur.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===ar.ArrayBuffer&&(e=new Uint8Array(e));for(var r,s,n=0,a=e.length||0,i=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)for(s=this.start;n<a&&s<64;++n)i[s>>2]|=e[n]<<cr[3&s++];else for(s=this.start;n<a&&s<64;++n)(r=e.charCodeAt(n))<128?i[s>>2]|=r<<cr[3&s++]:r<2048?(i[s>>2]|=(192|r>>6)<<cr[3&s++],i[s>>2]|=(128|63&r)<<cr[3&s++]):r<55296||r>=57344?(i[s>>2]|=(224|r>>12)<<cr[3&s++],i[s>>2]|=(128|r>>6&63)<<cr[3&s++],i[s>>2]|=(128|63&r)<<cr[3&s++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),i[s>>2]|=(240|r>>18)<<cr[3&s++],i[s>>2]|=(128|r>>12&63)<<cr[3&s++],i[s>>2]|=(128|r>>6&63)<<cr[3&s++],i[s>>2]|=(128|63&r)<<cr[3&s++]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},ur.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=or[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},ur.prototype.hash=function(){var e,t,r=this.h0,s=this.h1,n=this.h2,a=this.h3,i=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)r=(t=(s=(t=(n=(t=(a=(t=(i=(t=r<<5|r>>>27)+(s&n|~s&a)+i+1518500249+o[e]<<0)<<5|i>>>27)+(r&(s=s<<30|s>>>2)|~r&n)+a+1518500249+o[e+1]<<0)<<5|a>>>27)+(i&(r=r<<30|r>>>2)|~i&s)+n+1518500249+o[e+2]<<0)<<5|n>>>27)+(a&(i=i<<30|i>>>2)|~a&r)+s+1518500249+o[e+3]<<0)<<5|s>>>27)+(n&(a=a<<30|a>>>2)|~n&i)+r+1518500249+o[e+4]<<0,n=n<<30|n>>>2;for(;e<40;e+=5)r=(t=(s=(t=(n=(t=(a=(t=(i=(t=r<<5|r>>>27)+(s^n^a)+i+1859775393+o[e]<<0)<<5|i>>>27)+(r^(s=s<<30|s>>>2)^n)+a+1859775393+o[e+1]<<0)<<5|a>>>27)+(i^(r=r<<30|r>>>2)^s)+n+1859775393+o[e+2]<<0)<<5|n>>>27)+(a^(i=i<<30|i>>>2)^r)+s+1859775393+o[e+3]<<0)<<5|s>>>27)+(n^(a=a<<30|a>>>2)^i)+r+1859775393+o[e+4]<<0,n=n<<30|n>>>2;for(;e<60;e+=5)r=(t=(s=(t=(n=(t=(a=(t=(i=(t=r<<5|r>>>27)+(s&n|s&a|n&a)+i-1894007588+o[e]<<0)<<5|i>>>27)+(r&(s=s<<30|s>>>2)|r&n|s&n)+a-1894007588+o[e+1]<<0)<<5|a>>>27)+(i&(r=r<<30|r>>>2)|i&s|r&s)+n-1894007588+o[e+2]<<0)<<5|n>>>27)+(a&(i=i<<30|i>>>2)|a&r|i&r)+s-1894007588+o[e+3]<<0)<<5|s>>>27)+(n&(a=a<<30|a>>>2)|n&i|a&i)+r-1894007588+o[e+4]<<0,n=n<<30|n>>>2;for(;e<80;e+=5)r=(t=(s=(t=(n=(t=(a=(t=(i=(t=r<<5|r>>>27)+(s^n^a)+i-899497514+o[e]<<0)<<5|i>>>27)+(r^(s=s<<30|s>>>2)^n)+a-899497514+o[e+1]<<0)<<5|a>>>27)+(i^(r=r<<30|r>>>2)^s)+n-899497514+o[e+2]<<0)<<5|n>>>27)+(a^(i=i<<30|i>>>2)^r)+s-899497514+o[e+3]<<0)<<5|s>>>27)+(n^(a=a<<30|a>>>2)^i)+r-899497514+o[e+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+s<<0,this.h2=this.h2+n<<0,this.h3=this.h3+a<<0,this.h4=this.h4+i<<0},ur.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,s=this.h3,n=this.h4;return ir[e>>28&15]+ir[e>>24&15]+ir[e>>20&15]+ir[e>>16&15]+ir[e>>12&15]+ir[e>>8&15]+ir[e>>4&15]+ir[15&e]+ir[t>>28&15]+ir[t>>24&15]+ir[t>>20&15]+ir[t>>16&15]+ir[t>>12&15]+ir[t>>8&15]+ir[t>>4&15]+ir[15&t]+ir[r>>28&15]+ir[r>>24&15]+ir[r>>20&15]+ir[r>>16&15]+ir[r>>12&15]+ir[r>>8&15]+ir[r>>4&15]+ir[15&r]+ir[s>>28&15]+ir[s>>24&15]+ir[s>>20&15]+ir[s>>16&15]+ir[s>>12&15]+ir[s>>8&15]+ir[s>>4&15]+ir[15&s]+ir[n>>28&15]+ir[n>>24&15]+ir[n>>20&15]+ir[n>>16&15]+ir[n>>12&15]+ir[n>>8&15]+ir[n>>4&15]+ir[15&n]},ur.prototype.toString=ur.prototype.hex,ur.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,s=this.h3,n=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,s>>24&255,s>>16&255,s>>8&255,255&s,n>>24&255,n>>16&255,n>>8&255,255&n]},ur.prototype.array=ur.prototype.digest,ur.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const dr=(...e)=>{return t=e.join("_"),new ur(!0).update(t).hex();var t},hr=new Map;class pr extends class{}{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(dr(e,t))??null)}async update(e,t,r){this.cache.set(dr(e,t),r)}static global(){return new pr(hr)}}var fr=r(1141),mr=r(9636),gr=r(9742),yr=Object.defineProperty;function br(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let r=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;r.length>1;){let s=null;for(let n=0;n<r.length-1;n++){const a=e.slice(r[n].start,r[n+1].end),i=t.get(a.join(","));null!=i&&(null==s||i<s[0])&&(s=[i,n])}if(null==s)break;{const e=s[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}}return r}(e,t).map((r=>t.get(e.slice(r.start,r.end).join(",")))).filter((e=>null!=e))}var vr,_r,wr=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const r=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[r,s,...n]=t.split(" "),a=Number.parseInt(s,10);return n.forEach(((t,r)=>e[t]=a+r)),e}),{});for(const[e,t]of Object.entries(r)){const r=gr.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],r="all"){const s=new RegExp(this.patStr,"ug"),n=wr.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter((e=>!i.has(e))):r);if(o.size>0){const t=wr.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw new Error(`The text contains a special token that is not allowed: ${r[0]}`)}let c=0;for(;;){let t=null,r=c;for(;n.lastIndex=r,t=n.exec(e),null!=t&&!i.has(t[0]);)r=t.index+1;const o=t?.index??e.length;for(const t of e.substring(c,o).matchAll(s)){const e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));null==r?a.push(...br(e,this.rankMap)):a.push(r)}if(null==t)break;let l=this.specialTokens[t[0]];a.push(l),c=t.index+t[0].length}return a}decode(e){const t=[];let r=0;for(let s=0;s<e.length;++s){const n=e[s],a=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=a&&(t.push(a),r+=a.length)}const s=new Uint8Array(r);let n=0;for(const e of t)s.set(e,n),n+=e.length;return this.textDecoder.decode(s)}},Or=wr;_r=e=>new RegExp(e.map((e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e))).join("|"),"g"),((e,t,r)=>{t in e?yr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(Or,"symbol"!=typeof(vr="specialTokenRegex")?vr+"":vr,_r);const kr={},Pr=new mr.L({});var Tr=r(3450);class xr extends Tr.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class Ir extends xr{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=pr.global():this.cache=void 0,this.caller=new mr.L(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await async function(e){return async function(e){return e in kr||(kr[e]=Pr.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new Or(e))).catch((t=>{throw delete kr[e],t}))),await kr[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}(e))}("modelName"in this?(r=this.modelName,r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}var r;if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new fr.nw(e):Array.isArray(e)?new fr.GU(e.map(er.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){const t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()},r=Object.entries(t).filter((([e,t])=>void 0!==t)),s=r.map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",");return s}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}var Ar=r(3905);class Er extends Ir{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r?.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=Er._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===Er.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=Er._convertInputToPromptValue(e).toChatMessages(),[s,n]=this._separateRunnableConfigFromCallOptions(t),a=await Ar.Ye.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),i={options:n,invocation_params:this?.invocationParams(n),batch_size:1},o=await(a?.handleChatModelStart(this.toJSON(),[r],void 0,void 0,i,void 0,void 0,s.runName));let c;try{for await(const e of this._streamResponseChunks(r,n,o?.[0]))yield e.message,c=c?c.concat(e):e}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[c]]}))))}}async _generateUncached(e,t,r){const s=e.map((e=>e.map(er.E1))),n=await Ar.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this?.invocationParams(t),batch_size:1},i=await(n?.handleChatModelStart(this.toJSON(),s,void 0,void 0,a,void 0,void 0,r.runName)),o=await Promise.allSettled(s.map(((e,r)=>this._generate(e,{...t,promptIndex:r},i?.[r])))),c=[],l=[];await Promise.all(o.map((async(e,t)=>{if("fulfilled"===e.status){const r=e.value;return c[t]=r.generations,l[t]=r.llmOutput,i?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}return await(i?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const u={generations:c,llmOutput:l.length?this._combineLLMOutput?.(...l):void 0};return Object.defineProperty(u,tr,{value:i?{runIds:i?.map((e=>e.runId))}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:n}){const a=e.map((e=>e.map(er.E1))),i=await Ar.Ye.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:s,invocation_params:this?.invocationParams(s),batch_size:1,cached:!0},c=await(i?.handleChatModelStart(this.toJSON(),a,void 0,void 0,o,void 0,void 0,n.runName)),l=[],u=(await Promise.allSettled(a.map((async(e,s)=>{const n=Er._convertInputToPromptValue(e).toString(),a=await t.lookup(n,r);return null==a&&l.push(s),a})))).map(((e,t)=>({result:e,runManager:c?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),d=[];await Promise.all(u.map((async({result:e,runManager:t},r)=>{if("fulfilled"===e.status){const s=e.value;return d[r]=s,s.length&&await(t?.handleLLMNewToken(s[0].text)),t?.handleLLMEnd({generations:[s]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const h={generations:d,missingPromptIndices:l};return Object.defineProperty(h,tr,{value:c?{runIds:c?.map((e=>e.runId))}:void 0,configurable:!0}),h}async generate(e,t,r){let s;s=Array.isArray(t)?{stop:t}:t;const n=e.map((e=>e.map(er.E1))),[a,i]=this._separateRunnableConfigFromCallOptions(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(n,i,a);const{cache:o}=this,c=this._getSerializedCacheKeyParametersForCall(i),{generations:l,missingPromptIndices:u}=await this._generateCached({messages:n,cache:o,llmStringKey:c,parsedOptions:i,handledOptions:a});let d={};if(u.length>0){const e=await this._generateUncached(u.map((e=>n[e])),i,a);await Promise.all(e.generations.map((async(e,t)=>{const r=u[t];l[r]=e;const s=Er._convertInputToPromptValue(n[r]).toString();return o.update(s,c,e)}))),d=e.llmOutput??{}}return{generations:l,llmOutput:d}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const s=e.map((e=>e.toChatMessages()));return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(er.E1)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new er.xk(e),n=await this.call([s],t,r);if("string"!=typeof n.content)throw new Error("Cannot use predict when output is not a string.");return n.content}}function Sr(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:s,azureOpenAIBasePath:n,baseURL:a}=e;if(s&&n&&t)return`${n}/${t}`;if(s){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return a}var jr=r(8841);function Cr(e){let t;return e.constructor.name===Bt.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===Vt.name?(t=new Error(e.message),t.name="AbortError"):t=e,t}function Rr(e){const t=(0,jr.Y_)(e.schema);return{type:"function",function:{name:e.name,description:e.description,parameters:t}}}function Nr(e,t){const r=[];for(const[s,n]of Object.entries(e.properties??{}))n.description&&t<2&&r.push(`// ${n.description}`),e.required?.includes(s)?r.push(`${s}: ${$r(n,t)},`):r.push(`${s}?: ${$r(n,t)},`);return r.map((e=>" ".repeat(t)+e)).join("\n")}function $r(e,t){if(void 0!==(r=e).anyOf&&Array.isArray(r.anyOf))return e.anyOf.map((e=>$r(e,t))).join(" | ");var r;switch(e.type){case"string":return e.enum?e.enum.map((e=>`"${e}"`)).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map((e=>`${e}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Nr(e,t+2),"}"].join("\n");case"array":return e.items?`${$r(e.items,t)}[]`:"any[]";default:return""}}function Lr(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!er.J.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function Dr(e,t){const r=e.role??t,s=e.content??"";let n;return n=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},"user"===r?new er.ro({content:s}):"assistant"===r?new er.GC({content:s,additional_kwargs:n}):"system"===r?new er.xq({content:s}):"function"===r?new er.Cr({content:s,additional_kwargs:n,name:e.name}):"tool"===r?new er.Xz({content:s,additional_kwargs:n,tool_call_id:e.tool_call_id}):new er.HD({content:s,role:r})}function Mr(e){return e.map((e=>({role:Lr(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id})))}class Zr extends Er{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,nr.lS)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,nr.lS)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,nr.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,nr.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,nr.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,nr.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,nr.lS)("OPENAI_ORGANIZATION"),this.modelName=e?.modelName??this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}invocationParams(e){var t;return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stop,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:(t=e?.tools,void 0!==t&&t.every((e=>Array.isArray(e.lc_namespace)))?e?.tools.map(Rr):e?.tools),tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){const s=Mr(e),n={...this.invocationParams(t),messages:s,stream:!0};let a;const i=await this.completionWithRetry(n,t);for await(const e of i){const s=e?.choices[0];if(!s)continue;const{delta:n}=s;if(!n)continue;const i=Dr(n,a);a=n.role??a;const o={prompt:t.promptIndex??0,completion:s.index??0};if("string"!=typeof i.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const c=new sr({message:i,text:i.content,generationInfo:o});yield c,r?.handleLLMNewToken(c.text??"",o,void 0,void 0,void 0,{chunk:c})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const s={},n=this.invocationParams(t),a=Mr(e);if(n.stream){const n=this._streamResponseChunks(e,t,r),a={};for await(const e of n){const t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}const i=Object.entries(a).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t)),{functions:o,function_call:c}=this.invocationParams(t),l=await this.getEstimatedTokenCountFromPrompt(e,o,c),u=await this.getNumTokensFromGenerations(i);return s.promptTokens=l,s.completionTokens=u,s.totalTokens=l+u,{generations:i,llmOutput:{estimatedTokenUsage:s}}}{const e=await this.completionWithRetry({...n,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:r,prompt_tokens:o,total_tokens:c}=e?.usage??{};r&&(s.completionTokens=(s.completionTokens??0)+r),o&&(s.promptTokens=(s.promptTokens??0)+o),c&&(s.totalTokens=(s.totalTokens??0)+c);const l=[];for(const t of e?.choices??[]){const e={text:t.message?.content??"",message:(i=t.message??{role:"assistant"},"assistant"===i.role?new er.gY(i.content||"",{function_call:i.function_call,tool_calls:i.tool_calls}):new er.J(i.content||"",i.role??"unknown"))};e.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},l.push(e)}return{generations:l,llmOutput:{tokenUsage:s}}}var i}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==r){const e=function(e){const t=["namespace functions {",""];for(const r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(Nr(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);s+=await this.getNumTokens(e),s+=9}return t&&e.find((e=>"system"===e._getType()))&&(s-=4),"none"===r?s+=1:"object"==typeof r&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map((async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content))))).reduce(((e,t)=>e+t),0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;"gpt-3.5-turbo-0301"===this.modelName?(r=4,s=-1):(r=3,s=1);const n=await Promise.all(e.map((async e=>{const n=await this.getNumTokens(e.content),a=await this.getNumTokens(Lr(e)),i=void 0!==e.name?s+await this.getNumTokens(e.name):0;let o=n+r+a+i;const c=e;return"function"===c._getType()&&(o-=2),c.additional_kwargs?.function_call&&(o+=3),c?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(c.additional_kwargs.function_call?.name)),c.additional_kwargs.function_call?.arguments&&(o+=await this.getNumTokens(JSON.stringify(JSON.parse(c.additional_kwargs.function_call?.arguments)))),t+=o,o})));return t+=3,{totalCount:t,countPerMessage:n}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,r)}catch(e){throw Cr(e)}}))}_getClientOptions(e){if(!this.client){const e=Sr({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new Zt(t)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}class Ur extends class{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new mr.L(e??{})}}{constructor(e,t){const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let s=r?.openAIApiKey??(0,nr.lS)("OPENAI_API_KEY");const n=r?.azureOpenAIApiKey??(0,nr.lS)("AZURE_OPENAI_API_KEY");if(!n&&!s)throw new Error("OpenAI or Azure OpenAI API key not found");const a=r?.azureOpenAIApiInstanceName??(0,nr.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),i=(r?.azureOpenAIApiEmbeddingsDeploymentName||r?.azureOpenAIApiDeploymentName)??((0,nr.lS)("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||(0,nr.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME")),o=r?.azureOpenAIApiVersion??(0,nr.lS)("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=r?.azureOpenAIBasePath??(0,nr.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=r?.configuration?.organization??(0,nr.lS)("OPENAI_ORGANIZATION"),this.modelName=r?.modelName??this.modelName,this.batchSize=r?.batchSize??(n?1:this.batchSize),this.stripNewLines=r?.stripNewLines??this.stripNewLines,this.timeout=r?.timeout,this.azureOpenAIApiVersion=o,this.azureOpenAIApiKey=n,this.azureOpenAIApiInstanceName=a,this.azureOpenAIApiDeploymentName=i,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");s=s??""}this.clientConfig={apiKey:s,organization:this.organization,baseURL:t?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params,...t,...e?.configuration}}async embedDocuments(e){const t=(r=this.stripNewLines?e.map((e=>e.replace(/\n/g," "))):e,s=this.batchSize,r.reduce(((e,t,r)=>{const n=Math.floor(r/s),a=e[n]||[];return e[n]=a.concat([t]),e}),[]));var r,s;const n=t.map((e=>this.embeddingWithRetry({model:this.modelName,input:e}))),a=await Promise.all(n),i=[];for(let e=0;e<a.length;e+=1){const r=t[e],{data:s}=a[e];for(let e=0;e<r.length;e+=1)i.push(s[e].embedding)}return i}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t[0].embedding}async embeddingWithRetry(e){if(!this.client){const e=Sr({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new Zt(t)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call((async()=>{try{return await this.client.embeddings.create(e,t)}catch(e){throw Cr(e)}}))}}},6379:(e,t,r)=>{"use strict";r.d(t,{z:()=>s.z7});var s=r(7265);r(4190)},4190:(e,t,r)=>{"use strict";function s({oldEntrypointName:e,newEntrypointName:t,newPackageName:r="@langchain/community"}){let s="";void 0===t?s=`/${e}`:""!==t&&(s=`/${t}`);let n=[`[WARNING]: Importing from "langchain/${e}" is deprecated.`,"",`Instead, please add the "${r}" package to your project with e.g.`,"",`    $ npm install ${r}`,"",`and import from "${r}${s}".`,"",'This will be mandatory after the next "langchain" minor version bump to 0.2.'].join("\n");"@langchain/core"===r&&(n=[`[WARNING]: Importing from "langchain/${e}" is deprecated.`,"",`Instead, please import from "${r}${s}".`,"",'This will be mandatory after the next "langchain" minor version bump to 0.2.'].join("\n")),console.warn(n)}r.d(t,{m:()=>s})},7570:(e,t,r)=>{"use strict";r.d(t,{Pf:()=>s.PromptTemplate}),r(4190),r(619),r(9242),r(7315);var s=r(1214);r(1307),r(7327),r(1141),r(6141)},7633:(e,t,r)=>{"use strict";r.d(t,{AN:()=>o}),r(4190);var s=r(9730);class n extends s.eq{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async e=>this.parseResult([{text:e}])),e,{...t,runType:"parser"}):this._callWithConfig((async e=>this.parseResult([{message:e,text:"string"==typeof e.content?e.content:JSON.stringify(e.content)}])),e,{...t,runType:"parser"})}}class a extends n{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}Error,r(3908),"undefined"!=typeof self&&self.location&&"null"!==self.location.origin&&(self.location.origin,self.location.pathname,location.search);class i extends a{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:"string"==typeof t.content?t.content:JSON.stringify(t.content)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class o extends i{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}r(344)},6786:(e,t,r)=>{"use strict";r.d(t,{sk:()=>s.sk,lW:()=>s.lW}),r(4190);var s=r(9730)}},l={};function u(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={id:e,loaded:!1,exports:{}};return c[e].call(r.exports,r,r.exports,u),r.loaded=!0,r.exports}u.m=c,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},u.a=(n,a,i)=>{var o;i&&((o=[]).d=1);var c,l,u,d=new Set,h=n.exports,p=new Promise(((e,t)=>{u=t,l=e}));p[t]=h,p[e]=e=>(o&&e(o),d.forEach(e),p.catch((e=>{}))),n.exports=p,a((n=>{var a;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var a=[];a.d=0,n.then((e=>{i[t]=e,s(a)}),(e=>{i[r]=e,s(a)}));var i={};return i[e]=e=>e(a),i}}var o={};return o[e]=e=>{},o[t]=n,o})))(n);var i=()=>c.map((e=>{if(e[r])throw e[r];return e[t]})),l=new Promise((t=>{(a=()=>t(i)).r=0;var r=e=>e!==o&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)));c.map((t=>t[e](r)))}));return a.r?l:i()}),(e=>(e?u(p[r]=e):l(h),s(o)))),o&&(o.d=0)},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,u.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);u.r(r);var s={};n=n||[null,a({}),a([]),a(a)];for(var i=2&t&&e;"object"==typeof i&&!~n.indexOf(i);i=a(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,u.d(r,s),r},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.f={},u.e=e=>Promise.all(Object.keys(u.f).reduce(((t,r)=>(u.f[r](e,t),t)),[])),u.u=e=>e+".bundle.js",u.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},o="todo-list:",u.l=(e,t,r,s)=>{if(i[e])i[e].push(t);else{var n,a;if(void 0!==r)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==o+r){n=d;break}}n||(a=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,u.nc&&n.setAttribute("nonce",u.nc),n.setAttribute("data-webpack",o+r),n.src=e),i[e]=[t];var h=(t,r)=>{n.onerror=n.onload=null,clearTimeout(p);var s=i[e];if(delete i[e],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((e=>e(r))),t)return t(r)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=h.bind(null,n.onerror),n.onload=h.bind(null,n.onload),a&&document.head.appendChild(n)}},u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;u.g.importScripts&&(e=u.g.location+"");var t=u.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),u.p=e})(),(()=>{var e={826:0};u.f.j=(t,r)=>{var s=u.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var n=new Promise(((r,n)=>s=e[t]=[r,n]));r.push(s[2]=n);var a=u.p+u.u(t),i=new Error;u.l(a,(r=>{if(u.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",i.name="ChunkLoadError",i.type=n,i.request=a,s[1](i)}}),"chunk-"+t,t)}};var t=(t,r)=>{var s,n,[a,i,o]=r,c=0;if(a.some((t=>0!==e[t]))){for(s in i)u.o(i,s)&&(u.m[s]=i[s]);o&&o(u)}for(t&&t(r);c<a.length;c++)n=a[c],u.o(e,n)&&e[n]&&e[n][0](),e[n]=0},r=self.webpackChunktodo_list=self.webpackChunktodo_list||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),u(8138)})();