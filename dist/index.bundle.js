/*! For license information please see index.bundle.js.LICENSE.txt */
(()=>{var e,t,r,n,s={265:(e,t,r)=>{"use strict";e=r.nmd(e);const n=(e=0)=>t=>`[${38+e};5;${t}m`,s=(e=0)=>(t,r,n)=>`[${38+e};2;${t};${r};${n}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[r,n]of Object.entries(t)){for(const[r,s]of Object.entries(n))t[r]={open:`[${s[0]}m`,close:`[${s[1]}m`},n[r]=t[r],e.set(s[0],s[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=n(),t.color.ansi16m=s(),t.bgColor.ansi256=n(10),t.bgColor.ansi16m=s(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map((e=>e+e)).join(""));const n=Number.parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},1156:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s;const a=new Uint8Array(16);function i(){if(!s&&(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(a)}const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));const c=function(e,t,r){if(n.randomUUID&&!t&&!e)return n.randomUUID();const s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}(s)}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,a=c(e),i=a[0],o=a[1],l=new s(function(e,t,r){return 3*(t+r)/4-r}(0,i,o)),u=0,d=o>0?i-4:i;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[u++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,n=e.length,s=n%3,a=[],i=16383,o=0,c=n-s;o<c;o+=i)a.push(l(e,o,o+i>c?c:o+i));return 1===s?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=a.length;i<o;++i)r[i]=a[i],n[a.charCodeAt(i)]=i;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,n){for(var s,a,i=[],o=t;o<n;o+=3)s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(r[(a=s)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},3204:e=>{"use strict";const t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,s=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,i=new RegExp("^"+a.source),o=new RegExp(a.source+s.source,"gu"),c=new RegExp("\\d+"+s.source,"gu"),l=(e,s)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(s={pascalCase:!1,preserveConsecutiveUppercase:!1,...s},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const a=!1===s.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(s.locale),l=!1===s.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(s.locale);return 1===e.length?s.pascalCase?l(e):a(e):(e!==a(e)&&(e=((e,n,s)=>{let a=!1,i=!1,o=!1;for(let c=0;c<e.length;c++){const l=e[c];a&&t.test(l)?(e=e.slice(0,c)+"-"+e.slice(c),a=!1,o=i,i=!0,c++):i&&o&&r.test(l)?(e=e.slice(0,c-1)+"-"+e.slice(c-1),o=i,i=!1,a=!0):(a=n(l)===l&&s(l)!==l,o=i,i=s(l)===l&&n(l)!==l)}return e})(e,a,l)),e=e.replace(i,""),e=s.preserveConsecutiveUppercase?((e,t)=>(n.lastIndex=0,e.replace(n,(e=>t(e)))))(e,a):a(e),s.pascalCase&&(e=l(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,c.lastIndex=0,e.replace(o,((e,r)=>t(r))).replace(c,(e=>t(e)))))(e,l))};e.exports=l,e.exports.default=l},2466:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new s(n,a||e,i),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],o]:e._events[c].push(o):(e._events[c]=o,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,a=n.length,i=new Array(a);s<a;s++)i[s]=n[s].fn;return i},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,s,a,i){var o=r?r+e:e;if(!this._events[o])return!1;var c,l,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,a),!0;case 6:return u.fn.call(u.context,t,n,s,a,i),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,s);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,s){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||s&&!o.once||n&&o.context!==n||i(this,a);else{for(var c=0,l=[],u=o.length;c<u;c++)(o[c].fn!==t||s&&!o[c].once||n&&o[c].context!==n)&&l.push(o[c]);l.length?this._events[a]=1===l.length?l[0]:l:i(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},7345:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},5860:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6729),s=r(8147),a=r(6506),i=()=>{},o=new s.TimeoutError;t.default=class extends n{constructor(e){var t,r,n,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=i,this._resolveIdle=i,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=i,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=i,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,n)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const a=void 0===this._timeout&&void 0===t.timeout?e():s.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(o)}));r(await a)}catch(e){n(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},7489:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=0,s=e.length;for(;s>0;){const a=s/2|0;let i=n+a;r(e[i],t)<=0?(n=++i,s-=a+1):s=a}return n}},6506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(7489);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const s=n.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},2693:(e,t,r)=>{"use strict";const n=r(8837),s=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class a extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const i=(e,t)=>new Promise(((r,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=n.operation(t);o.attempt((async n=>{try{r(await e(n))}catch(e){if(!(e instanceof Error))return void i(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof a)o.stop(),i(e.originalError);else if(e instanceof TypeError&&(c=e.message,!s.includes(c)))o.stop(),i(e);else{((e,t,r)=>{const n=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=n})(e,n,t);try{await t.onFailedAttempt(e)}catch(e){return void i(e)}o.retry(e)||i(o.mainError())}}var c}))}));e.exports=i,e.exports.default=i,e.exports.AbortError=a},8837:(e,t,r)=>{e.exports=r(2280)},2280:(e,t,r)=>{var n=r(793);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<t.retries;s++)n.push(this.createTimeout(s,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(s,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var s in n=[],e)"function"==typeof e[s]&&n.push(s);for(var a=0;a<n.length;a++){var i=n[a],o=e[i];e[i]=function(n){var s=t.operation(r),a=Array.prototype.slice.call(arguments,1),i=a.pop();a.push((function(e){s.retry(e)||(e&&(arguments[0]=s.mainError()),i.apply(this,arguments))})),s.attempt((function(){n.apply(e,a)}))}.bind(e,o),e[i].options=r}}},793:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var s=this._errors[n],a=s.message,i=(e[a]||0)+1;e[a]=i,i>=r&&(t=s,r=i)}return t}},8147:(e,t,r)=>{"use strict";const n=r(7345);class s extends Error{constructor(e){super(e),this.name="TimeoutError"}}const a=(e,t,r)=>new Promise(((a,i)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);const o=setTimeout((()=>{if("function"==typeof r){try{a(r())}catch(e){i(e)}return}const n=r instanceof Error?r:new s("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),i(n)}),t);n(e.then(a,i),(()=>{clearTimeout(o)}))}));e.exports=a,e.exports.default=a,e.exports.TimeoutError=s},8841:(e,t,r)=>{"use strict";t.Y_=void 0;const n=r(4357);Object.defineProperty(t,"Y_",{enumerable:!0,get:function(){return n.zodToJsonSchema}}),n.zodToJsonSchema},7181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultOptions=t.defaultOptions=void 0,t.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1},t.getDefaultOptions=e=>"string"==typeof e?Object.assign(Object.assign({},t.defaultOptions),{name:e}):Object.assign(Object.assign({},t.defaultOptions),e)},1908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRefs=void 0;const n=r(7181);t.getRefs=e=>{const t=(0,n.getDefaultOptions)(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return Object.assign(Object.assign({},t),{currentPath:r,propertyPath:void 0,seen:[]})}},6519:(e,t)=>{"use strict";function r(e,t,r,n){(null==n?void 0:n.errorMessages)&&r&&(e.errorMessage=Object.assign(Object.assign({},e.errorMessage),{[t]:r}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setResponseValueAndErrors=t.addErrorMessage=void 0,t.addErrorMessage=r,t.setResponseValueAndErrors=function(e,t,n,s,a){e[t]=n,r(e,t,s,a)}},9959:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDef=void 0;const n=r(8754),s=r(6840),a=r(2886),i=r(2722),o=r(5823),c=r(423),l=r(9444),u=r(4117),d=r(3245),h=r(4804),p=r(2105),m=r(2734),f=r(8392),g=r(8716),y=r(2295),b=r(2200),_=r(5907),v=r(993),w=r(8490),x=r(938),O=r(8289),P=r(1250),I=r(9033),T=r(3564),A=r(9226),k=r(9229),E=r(3133),C=r(9646),j=r(8e3),S=r(34);function N(e,t){const r=t.seen.find((t=>Object.is(t.def,e)));if(r)return R(r,t);const n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.push(n);const s=$(e,e.typeName,t);return s&&M(e,s),n.jsonSchema=s,s}t.parseDef=N;const R=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:0===e.path.length?"":1===e.path.length?`${e.path[0]}/`:e.path.join("/")};case"relative":return{$ref:Z(t.currentPath,e.path)};case"none":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):e.jsonSchema}},Z=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},$=(e,t,r)=>{switch(t){case n.ZodFirstPartyTypeKind.ZodString:return(0,k.parseStringDef)(e,r);case n.ZodFirstPartyTypeKind.ZodNumber:return(0,w.parseNumberDef)(e,r);case n.ZodFirstPartyTypeKind.ZodObject:return(0,x.parseObjectDef)(e,r);case n.ZodFirstPartyTypeKind.ZodBigInt:return(0,i.parseBigintDef)();case n.ZodFirstPartyTypeKind.ZodBoolean:return(0,o.parseBooleanDef)();case n.ZodFirstPartyTypeKind.ZodDate:return(0,u.parseDateDef)();case n.ZodFirstPartyTypeKind.ZodUndefined:return(0,C.parseUndefinedDef)();case n.ZodFirstPartyTypeKind.ZodNull:return(0,_.parseNullDef)(r);case n.ZodFirstPartyTypeKind.ZodArray:return(0,a.parseArrayDef)(e,r);case n.ZodFirstPartyTypeKind.ZodUnion:case n.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,j.parseUnionDef)(e,r);case n.ZodFirstPartyTypeKind.ZodIntersection:return(0,m.parseIntersectionDef)(e,r);case n.ZodFirstPartyTypeKind.ZodTuple:return(0,E.parseTupleDef)(e,r);case n.ZodFirstPartyTypeKind.ZodRecord:return(0,T.parseRecordDef)(e,r);case n.ZodFirstPartyTypeKind.ZodLiteral:return(0,f.parseLiteralDef)(e,r);case n.ZodFirstPartyTypeKind.ZodEnum:return(0,p.parseEnumDef)(e);case n.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,y.parseNativeEnumDef)(e);case n.ZodFirstPartyTypeKind.ZodNullable:return(0,v.parseNullableDef)(e,r);case n.ZodFirstPartyTypeKind.ZodOptional:return(0,O.parseOptionalDef)(e,r);case n.ZodFirstPartyTypeKind.ZodMap:return(0,g.parseMapDef)(e,r);case n.ZodFirstPartyTypeKind.ZodSet:return(0,A.parseSetDef)(e,r);case n.ZodFirstPartyTypeKind.ZodLazy:return N(e.getter()._def,r);case n.ZodFirstPartyTypeKind.ZodPromise:return(0,I.parsePromiseDef)(e,r);case n.ZodFirstPartyTypeKind.ZodNaN:case n.ZodFirstPartyTypeKind.ZodNever:return(0,b.parseNeverDef)();case n.ZodFirstPartyTypeKind.ZodEffects:return(0,h.parseEffectsDef)(e,r);case n.ZodFirstPartyTypeKind.ZodAny:return(0,s.parseAnyDef)();case n.ZodFirstPartyTypeKind.ZodUnknown:return(0,S.parseUnknownDef)();case n.ZodFirstPartyTypeKind.ZodDefault:return(0,d.parseDefaultDef)(e,r);case n.ZodFirstPartyTypeKind.ZodBranded:return(0,c.parseBrandedDef)(e,r);case n.ZodFirstPartyTypeKind.ZodCatch:return(0,l.parseCatchDef)(e,r);case n.ZodFirstPartyTypeKind.ZodPipeline:return(0,P.parsePipelineDef)(e,r);case n.ZodFirstPartyTypeKind.ZodFunction:case n.ZodFirstPartyTypeKind.ZodVoid:case n.ZodFirstPartyTypeKind.ZodSymbol:default:return}},M=(e,t)=>(e.description&&(t.description=e.description),t)},6840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAnyDef=void 0,t.parseAnyDef=function(){return{}}},2886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseArrayDef=void 0;const n=r(8754),s=r(6519),a=r(9959);t.parseArrayDef=function(e,t){var r,i;const o={type:"array"};return(null===(i=null===(r=e.type)||void 0===r?void 0:r._def)||void 0===i?void 0:i.typeName)!==n.ZodFirstPartyTypeKind.ZodAny&&(o.items=(0,a.parseDef)(e.type._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))),e.minLength&&(0,s.setResponseValueAndErrors)(o,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&(0,s.setResponseValueAndErrors)(o,"maxItems",e.maxLength.value,e.maxLength.message,t),o}},2722:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBigintDef=void 0,t.parseBigintDef=function(){return{type:"integer",format:"int64"}}},5823:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBooleanDef=void 0,t.parseBooleanDef=function(){return{type:"boolean"}}},423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBrandedDef=void 0;const n=r(9959);t.parseBrandedDef=function(e,t){return(0,n.parseDef)(e.type._def,t)}},9444:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCatchDef=void 0;const n=r(9959);t.parseCatchDef=(e,t)=>(0,n.parseDef)(e.innerType._def,t)},4117:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDateDef=void 0,t.parseDateDef=function(){return{type:"string",format:"date-time"}}},3245:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDefaultDef=void 0;const n=r(9959);t.parseDefaultDef=function(e,t){return Object.assign(Object.assign({},(0,n.parseDef)(e.innerType._def,t)),{default:e.defaultValue()})}},4804:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEffectsDef=void 0;const n=r(9959);t.parseEffectsDef=function(e,t){return"input"===t.effectStrategy?(0,n.parseDef)(e.schema._def,t):{}}},2105:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEnumDef=void 0,t.parseEnumDef=function(e){return{type:"string",enum:e.values}}},2734:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIntersectionDef=void 0;const n=r(9959);t.parseIntersectionDef=function(e,t){const r=[(0,n.parseDef)(e.left._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]})),(0,n.parseDef)(e.right._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","1"]}))].filter((e=>!!e));return r.length?{allOf:r}:void 0}},8392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLiteralDef=void 0,t.parseLiteralDef=function(e,t){const r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}},8716:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMapDef=void 0;const n=r(9959);t.parseMapDef=function(e,t){return{type:"array",maxItems:125,items:{type:"array",items:[(0,n.parseDef)(e.keyType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","0"]}))||{},(0,n.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items","items","1"]}))||{}],minItems:2,maxItems:2}}}},2295:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNativeEnumDef=void 0,t.parseNativeEnumDef=function(e){const t=e.values,r=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),n=Array.from(new Set(r.map((e=>typeof e))));return{type:1===n.length?"string"===n[0]?"string":"number":["string","number"],enum:r}}},2200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNeverDef=void 0,t.parseNeverDef=function(){return{not:{}}}},5907:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullDef=void 0,t.parseNullDef=function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}},993:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullableDef=void 0;const n=r(9959),s=r(8e3);t.parseNullableDef=function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:s.primitiveMappings[e.innerType._def.typeName],nullable:!0}:{type:[s.primitiveMappings[e.innerType._def.typeName],"null"]};const r=(0,n.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","0"]}));return r?"openApi3"===t.target?Object.assign(Object.assign({},r),{nullable:!0}):{anyOf:[r,{type:"null"}]}:void 0}},8490:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNumberDef=void 0;const n=r(6519);t.parseNumberDef=function(e,t){const r={type:"number"};if(!e.checks)return r;for(const s of e.checks)switch(s.kind){case"int":r.type="integer",(0,n.addErrorMessage)(r,"type",s.message,t);break;case"min":"jsonSchema7"===t.target?s.inclusive?(0,n.setResponseValueAndErrors)(r,"minimum",s.value,s.message,t):(0,n.setResponseValueAndErrors)(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),(0,n.setResponseValueAndErrors)(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?(0,n.setResponseValueAndErrors)(r,"maximum",s.value,s.message,t):(0,n.setResponseValueAndErrors)(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),(0,n.setResponseValueAndErrors)(r,"maximum",s.value,s.message,t));break;case"multipleOf":(0,n.setResponseValueAndErrors)(r,"multipleOf",s.value,s.message,t)}return r}},938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseObjectDef=void 0;const n=r(9959);t.parseObjectDef=function(e,t){var r;const s=Object.assign(Object.assign({type:"object"},Object.entries(e.shape()).reduce(((e,[r,s])=>{if(void 0===s||void 0===s._def)return e;const a=(0,n.parseDef)(s._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]}));return void 0===a?e:{properties:Object.assign(Object.assign({},e.properties),{[r]:a}),required:s.isOptional()?e.required:[...e.required,r]}}),{properties:{},required:[]})),{additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:null===(r=(0,n.parseDef)(e.catchall._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))||void 0===r||r});return s.required.length||delete s.required,s}},8289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseOptionalDef=void 0;const n=r(9959);t.parseOptionalDef=(e,t)=>{var r;if(t.currentPath.toString()===(null===(r=t.propertyPath)||void 0===r?void 0:r.toString()))return(0,n.parseDef)(e.innerType._def,t);const s=(0,n.parseDef)(e.innerType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf","1"]}));return s?{anyOf:[{not:{}},s]}:{}}},1250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePipelineDef=void 0;const n=r(9959);t.parsePipelineDef=(e,t)=>{const r=(0,n.parseDef)(e.in._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf","0"]}));return{allOf:[r,(0,n.parseDef)(e.out._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"allOf",r?"1":"0"]}))].filter((e=>void 0!==e))}}},9033:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePromiseDef=void 0;const n=r(9959);t.parsePromiseDef=function(e,t){return(0,n.parseDef)(e.type._def,t)}},3564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseRecordDef=void 0;const n=r(8754),s=r(9959),a=r(9229);t.parseRecordDef=function(e,t){var r,i,o;const c={type:"object",additionalProperties:(0,s.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalProperties"]}))||{}};if((null===(r=e.keyType)||void 0===r?void 0:r._def.typeName)===n.ZodFirstPartyTypeKind.ZodString&&(null===(i=e.keyType._def.checks)||void 0===i?void 0:i.length)){const r=Object.entries((0,a.parseStringDef)(e.keyType._def,t)).reduce(((e,[t,r])=>"type"===t?e:Object.assign(Object.assign({},e),{[t]:r})),{});return Object.assign(Object.assign({},c),{propertyNames:r})}return(null===(o=e.keyType)||void 0===o?void 0:o._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum?Object.assign(Object.assign({},c),{propertyNames:{enum:e.keyType._def.values}}):c}},9226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSetDef=void 0;const n=r(6519),s=r(9959);t.parseSetDef=function(e,t){const r={type:"array",items:(0,s.parseDef)(e.valueType._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items"]}))};return e.minSize&&(0,n.setResponseValueAndErrors)(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&(0,n.setResponseValueAndErrors)(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}},9229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringDef=void 0;const n=r(6519);t.parseStringDef=function(e,t){const r={type:"string"};if(e.checks)for(const i of e.checks)switch(i.kind){case"min":(0,n.setResponseValueAndErrors)(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":(0,n.setResponseValueAndErrors)(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":(0,n.setResponseValueAndErrors)(r,"format","email",i.message,t);break;case"url":(0,n.setResponseValueAndErrors)(r,"format","uri",i.message,t);break;case"uuid":(0,n.setResponseValueAndErrors)(r,"format","uuid",i.message,t);break;case"regex":a(r,i.regex.source,i.message,t);break;case"cuid":a(r,"^c[^\\s-]{8,}$",i.message,t);break;case"cuid2":a(r,"^[a-z][a-z0-9]*$",i.message,t);break;case"startsWith":a(r,"^"+s(i.value),i.message,t);break;case"endsWith":a(r,s(i.value)+"$",i.message,t);break;case"trim":break;case"datetime":(0,n.setResponseValueAndErrors)(r,"format","date-time",i.message,t);break;case"length":(0,n.setResponseValueAndErrors)(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),(0,n.setResponseValueAndErrors)(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t)}return r};const s=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),a=(e,t,r,s)=>{var a;e.pattern||(null===(a=e.allOf)||void 0===a?void 0:a.some((e=>e.pattern)))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push(Object.assign({pattern:e.pattern},e.errorMessage&&s.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}})),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push(Object.assign({pattern:t},r&&s.errorMessages&&{errorMessage:{pattern:r}}))):(0,n.setResponseValueAndErrors)(e,"pattern",t,r,s)}},3133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseTupleDef=void 0;const n=r(9959);t.parseTupleDef=function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,r)=>(0,n.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]})))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:(0,n.parseDef)(e.rest._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"additionalItems"]}))}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,r)=>(0,n.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"items",`${r}`]})))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}},9646:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUndefinedDef=void 0,t.parseUndefinedDef=function(){return{not:{}}}},8e3:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnionDef=t.primitiveMappings=void 0;const n=r(9959);t.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},t.parseUnionDef=function(e,r){if("openApi3"===r.target)return s(e,r);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in t.primitiveMappings&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,r)=>{const n=t.primitiveMappings[r._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName))){const e=n.reduce(((e,t)=>{const r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,r)=>r.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return s(e,r)};const s=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,r)=>(0,n.parseDef)(e._def,Object.assign(Object.assign({},t),{currentPath:[...t.currentPath,"anyOf",`${r}`]})))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return r.length?{anyOf:r}:void 0}},34:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnknownDef=void 0,t.parseUnknownDef=function(){return{}}},4357:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;const n=r(9959),s=r(1908);t.zodToJsonSchema=(e,t)=>{var r;const a=(0,s.getRefs)(t),i="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>{var s;return Object.assign(Object.assign({},e),{[t]:null!==(s=(0,n.parseDef)(r._def,Object.assign(Object.assign({},a),{currentPath:[...a.basePath,a.definitionPath,t]})))&&void 0!==s?s:{}})}),{}):void 0,o="string"==typeof t?t:null==t?void 0:t.name,c=null!==(r=(0,n.parseDef)(e._def,void 0===o?a:Object.assign(Object.assign({},a),{currentPath:[...a.basePath,a.definitionPath,o]})))&&void 0!==r?r:{},l=void 0===o?i?Object.assign(Object.assign({},c),{[a.definitionPath]:i}):c:{$ref:[..."relative"===a.$refStrategy?[]:a.basePath,a.definitionPath,o].join("/"),[a.definitionPath]:Object.assign(Object.assign({},i),{[o]:c})};return"jsonSchema7"===a.target&&(l.$schema="http://json-schema.org/draft-07/schema#"),l}},8280:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;const n=r(9110);t.ZodIssueCode=n.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class s extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(n);else if("invalid_return_type"===s.code)n(s.returnTypeError);else if("invalid_arguments"===s.code)n(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,n=0;for(;n<s.path.length;){const r=s.path[n];n===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,n.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=s,s.create=e=>new s(e)},6996:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;const s=n(r(9349));t.defaultErrorMap=s.default;let a=s.default;t.setErrorMap=function(e){a=e},t.getErrorMap=function(){return a}},6349:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(6996),t),s(r(3187),t),s(r(116),t),s(r(9110),t),s(r(5433),t),s(r(8280),t)},8762:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,(r=t.errorUtil||(t.errorUtil={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},r.toString=e=>"string"==typeof e?e:null==e?void 0:e.message},3187:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;const s=r(6996),a=n(r(9349));t.makeIssue=e=>{const{data:t,path:r,errorMaps:n,issueData:s}=e,a=[...r,...s.path||[]],i={...s,path:a};let o="";const c=n.filter((e=>!!e)).slice().reverse();for(const e of c)o=e(i,{data:t,defaultError:o}).message;return{...s,path:a,message:s.message||o}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,r){const n=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,(0,s.getErrorMap)(),a.default].filter((e=>!!e))});e.common.issues.push(n)};class i{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const s of r){if("aborted"===s.status)return t.INVALID;"dirty"===s.status&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const r=[];for(const e of t)r.push({key:await e.key,value:await e.value});return i.mergeObjectSync(e,r)}static mergeObjectSync(e,r){const n={};for(const s of r){const{key:r,value:a}=s;if("aborted"===r.status)return t.INVALID;if("aborted"===a.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===r.value||void 0===a.value&&!s.alwaysSet||(n[r.value]=a.value)}return{status:e.value,value:n}}}t.ParseStatus=i,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},116:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9110:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r=t.util||(t.util={})),(t.objectUtil||(t.objectUtil={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":return Array.isArray(e)?t.ZodParsedType.array:null===e?t.ZodParsedType.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?t.ZodParsedType.promise:"undefined"!=typeof Map&&e instanceof Map?t.ZodParsedType.map:"undefined"!=typeof Set&&e instanceof Set?t.ZodParsedType.set:"undefined"!=typeof Date&&e instanceof Date?t.ZodParsedType.date:t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},8754:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t},i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;const o=a(r(6349));t.z=o,i(r(6349),t),t.default=o},9349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(9110),s=r(8280);t.default=(e,t)=>{let r;switch(e.code){case s.ZodIssueCode.invalid_type:r=e.received===n.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case s.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,n.util.jsonStringifyReplacer)}`;break;case s.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${n.util.joinValues(e.keys,", ")}`;break;case s.ZodIssueCode.invalid_union:r="Invalid input";break;case s.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${n.util.joinValues(e.options)}`;break;case s.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${n.util.joinValues(e.options)}, received '${e.received}'`;break;case s.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case s.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case s.ZodIssueCode.invalid_date:r="Invalid date";break;case s.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:n.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case s.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case s.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case s.ZodIssueCode.custom:r="Invalid input";break;case s.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case s.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case s.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,n.util.assertNever(e)}return{message:r}}},5433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.date=t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=void 0;const n=r(6996),s=r(8762),a=r(3187),i=r(9110),o=r(8280);class c{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const l=(e,t)=>{if((0,a.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new o.ZodError(e.common.issues);return this._error=t,this._error}}};function u(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=n?n:t.defaultError}:{message:null!=r?r:t.defaultError},description:s}}class d{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return(0,i.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,i.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new a.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,i.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if((0,a.isAsync)(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,i.getParsedType)(e)},s=this._parseSync({data:e,path:n.path,parent:n});return l(n,s)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,i.getParsedType)(e)},n=this._parse({data:e,path:r.path,parent:r}),s=await((0,a.isAsync)(n)?n:Promise.resolve(n));return l(r,s)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const s=e(t),a=()=>n.addIssue({code:o.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then((e=>!!e||(a(),!1))):!!s||(a(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new Y({schema:this,typeName:oe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Q.create(this,this._def)}nullable(){return ee.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return N.create(this,this._def)}promise(){return X.create(this,this._def)}or(e){return $.create([this,e],this._def)}and(e){return U.create(this,e,this._def)}transform(e){return new Y({...u(this._def),schema:this,typeName:oe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new te({...u(this._def),innerType:this,defaultValue:t,typeName:oe.ZodDefault})}brand(){return new se({typeName:oe.ZodBranded,type:this,...u(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new re({...u(this._def),innerType:this,catchValue:t,typeName:oe.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ae.create(this,e)}readonly(){return ie.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=d,t.Schema=d,t.ZodSchema=d;const h=/^c[^\s-]{8,}$/i,p=/^[a-z][a-z0-9]*$/,m=/^[0-9A-HJKMNP-TV-Z]{26}$/,f=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,g=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let y;const b=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,_=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class v extends d{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==i.ZodParsedType.string){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.string,received:t.parsedType}),a.INVALID}const t=new a.ParseStatus;let r;for(const l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),t.dirty());else if("max"===l.kind)e.data.length>l.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),t.dirty());else if("length"===l.kind){const n=e.data.length>l.value,s=e.data.length<l.value;(n||s)&&(r=this._getOrReturnCtx(e,r),n?(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):s&&(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),t.dirty())}else if("email"===l.kind)g.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"email",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("emoji"===l.kind)y||(y=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),y.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"emoji",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("uuid"===l.kind)f.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"uuid",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("cuid"===l.kind)h.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"cuid",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("cuid2"===l.kind)p.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"cuid2",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("ulid"===l.kind)m.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"ulid",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty());else if("url"===l.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"url",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"regex",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),t.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{startsWith:l.value},message:l.message}),t.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:{endsWith:l.value},message:l.message}),t.dirty()):"datetime"===l.kind?((c=l).precision?c.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${c.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${c.precision}}Z$`):0===c.precision?c.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):c.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_string,validation:"datetime",message:l.message}),t.dirty()):"ip"===l.kind?(n=e.data,("v4"!==(s=l.version)&&s||!b.test(n))&&("v6"!==s&&s||!_.test(n))&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{validation:"ip",code:o.ZodIssueCode.invalid_string,message:l.message}),t.dirty())):i.util.assertNever(l);var n,s,c;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:o.ZodIssueCode.invalid_string,...s.errorUtil.errToObj(r)})}_addCheck(e){return new v({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...s.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...s.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...s.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...s.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...s.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...s.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...s.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...s.errorUtil.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...s.errorUtil.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...s.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...s.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...s.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...s.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...s.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...s.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...s.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,s.errorUtil.errToObj(e))}trim(){return new v({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new v({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new v({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function w(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}t.ZodString=v,v.create=e=>{var t;return new v({checks:[],typeName:oe.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...u(e)})};class x extends d{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==i.ZodParsedType.number){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.number,received:t.parsedType}),a.INVALID}let t;const r=new a.ParseStatus;for(const n of this._def.checks)"int"===n.kind?i.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==w(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.not_finite,message:n.message}),r.dirty()):i.util.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.errorUtil.toString(t))}setLimit(e,t,r,n){return new x({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.errorUtil.toString(n)}]})}_addCheck(e){return new x({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:s.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:s.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:s.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:s.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:s.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:s.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:s.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:s.errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&i.util.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=x,x.create=e=>new x({checks:[],typeName:oe.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...u(e)});class O extends d{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==i.ZodParsedType.bigint){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.bigint,received:t.parsedType}),a.INVALID}let t;const r=new a.ParseStatus;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):i.util.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.errorUtil.toString(t))}setLimit(e,t,r,n){return new O({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.errorUtil.toString(n)}]})}_addCheck(e){return new O({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:s.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:s.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:s.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:s.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=O,O.create=e=>{var t;return new O({checks:[],typeName:oe.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...u(e)})};class P extends d{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==i.ZodParsedType.boolean){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.boolean,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodBoolean=P,P.create=e=>new P({typeName:oe.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...u(e)});class I extends d{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==i.ZodParsedType.date){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.date,received:t.parsedType}),a.INVALID}if(isNaN(e.data.getTime())){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_date}),a.INVALID}const t=new a.ParseStatus;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):i.util.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new I({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:s.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:s.errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=I,I.create=e=>new I({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:oe.ZodDate,...u(e)});class T extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.symbol){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.symbol,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodSymbol=T,T.create=e=>new T({typeName:oe.ZodSymbol,...u(e)});class A extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.undefined,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodUndefined=A,A.create=e=>new A({typeName:oe.ZodUndefined,...u(e)});class k extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.null){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.null,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodNull=k,k.create=e=>new k({typeName:oe.ZodNull,...u(e)});class E extends d{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,a.OK)(e.data)}}t.ZodAny=E,E.create=e=>new E({typeName:oe.ZodAny,...u(e)});class C extends d{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,a.OK)(e.data)}}t.ZodUnknown=C,C.create=e=>new C({typeName:oe.ZodUnknown,...u(e)});class j extends d{_parse(e){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.never,received:t.parsedType}),a.INVALID}}t.ZodNever=j,j.create=e=>new j({typeName:oe.ZodNever,...u(e)});class S extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.void,received:t.parsedType}),a.INVALID}return(0,a.OK)(e.data)}}t.ZodVoid=S,S.create=e=>new S({typeName:oe.ZodVoid,...u(e)});class N extends d{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==i.ZodParsedType.array)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.array,received:t.parsedType}),a.INVALID;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,s=t.data.length<n.exactLength.value;(e||s)&&((0,a.addIssueToContext)(t,{code:e?o.ZodIssueCode.too_big:o.ZodIssueCode.too_small,minimum:s?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&((0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&((0,a.addIssueToContext)(t,{code:o.ZodIssueCode.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>n.type._parseAsync(new c(t,e,t.path,r))))).then((e=>a.ParseStatus.mergeArray(r,e)));const s=[...t.data].map(((e,r)=>n.type._parseSync(new c(t,e,t.path,r))));return a.ParseStatus.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new N({...this._def,minLength:{value:e,message:s.errorUtil.toString(t)}})}max(e,t){return new N({...this._def,maxLength:{value:e,message:s.errorUtil.toString(t)}})}length(e,t){return new N({...this._def,exactLength:{value:e,message:s.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}function R(e){if(e instanceof Z){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Q.create(R(n))}return new Z({...e._def,shape:()=>t})}return e instanceof N?new N({...e._def,type:R(e.element)}):e instanceof Q?Q.create(R(e.unwrap())):e instanceof ee?ee.create(R(e.unwrap())):e instanceof F?F.create(e.items.map((e=>R(e)))):e}t.ZodArray=N,N.create=(e,t)=>new N({type:e,minLength:null,maxLength:null,exactLength:null,typeName:oe.ZodArray,...u(t)});class Z extends d{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=i.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==i.ZodParsedType.object){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.object,received:t.parsedType}),a.INVALID}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:s}=this._getCached(),l=[];if(!(this._def.catchall instanceof j&&"strip"===this._def.unknownKeys))for(const e in r.data)s.includes(e)||l.push(e);const u=[];for(const e of s){const t=n[e],s=r.data[e];u.push({key:{status:"valid",value:e},value:t._parse(new c(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof j){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of l)u.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)l.length>0&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.unrecognized_keys,keys:l}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of l){const n=r.data[t];u.push({key:{status:"valid",value:t},value:e._parse(new c(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of u){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>a.ParseStatus.mergeObjectSync(t,e))):a.ParseStatus.mergeObjectSync(t,u)}get shape(){return this._def.shape()}strict(e){return s.errorUtil.errToObj,new Z({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,a,i,o;const c=null!==(i=null===(a=(n=this._def).errorMap)||void 0===a?void 0:a.call(n,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=s.errorUtil.errToObj(e).message)&&void 0!==o?o:c}:{message:c}}}:{}})}strip(){return new Z({...this._def,unknownKeys:"strip"})}passthrough(){return new Z({...this._def,unknownKeys:"passthrough"})}extend(e){return new Z({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Z({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:oe.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Z({...this._def,catchall:e})}pick(e){const t={};return i.util.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new Z({...this._def,shape:()=>t})}omit(e){const t={};return i.util.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new Z({...this._def,shape:()=>t})}deepPartial(){return R(this)}partial(e){const t={};return i.util.objectKeys(this.shape).forEach((r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()})),new Z({...this._def,shape:()=>t})}required(e){const t={};return i.util.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Q;)e=e._def.innerType;t[r]=e}})),new Z({...this._def,shape:()=>t})}keyof(){return W(i.util.objectKeys(this.shape))}}t.ZodObject=Z,Z.create=(e,t)=>new Z({shape:()=>e,unknownKeys:"strip",catchall:j.create(),typeName:oe.ZodObject,...u(t)}),Z.strictCreate=(e,t)=>new Z({shape:()=>e,unknownKeys:"strict",catchall:j.create(),typeName:oe.ZodObject,...u(t)}),Z.lazycreate=(e,t)=>new Z({shape:e,unknownKeys:"strip",catchall:j.create(),typeName:oe.ZodObject,...u(t)});class $ extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new o.ZodError(e.ctx.common.issues)));return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union,unionErrors:r}),a.INVALID}));{let e;const n=[];for(const s of r){const r={...t,common:{...t.common,issues:[]},parent:null},a=s._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=n.map((e=>new o.ZodError(e)));return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union,unionErrors:s}),a.INVALID}}get options(){return this._def.options}}t.ZodUnion=$,$.create=(e,t)=>new $({options:e,typeName:oe.ZodUnion,...u(t)});const M=e=>e instanceof q?M(e.schema):e instanceof Y?M(e.innerType()):e instanceof H?[e.value]:e instanceof J?e.options:e instanceof G?Object.keys(e.enum):e instanceof te?M(e._def.innerType):e instanceof A?[void 0]:e instanceof k?[null]:null;class D extends d{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.ZodParsedType.object)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.object,received:t.parsedType}),a.INVALID;const r=this.discriminator,n=t.data[r],s=this.optionsMap.get(n);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):((0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),a.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=M(r.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(n.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);n.set(s,r)}}return new D({typeName:oe.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...u(r)})}}function L(e,t){const r=(0,i.getParsedType)(e),n=(0,i.getParsedType)(t);if(e===t)return{valid:!0,data:e};if(r===i.ZodParsedType.object&&n===i.ZodParsedType.object){const r=i.util.objectKeys(t),n=i.util.objectKeys(e).filter((e=>-1!==r.indexOf(e))),s={...e,...t};for(const r of n){const n=L(e[r],t[r]);if(!n.valid)return{valid:!1};s[r]=n.data}return{valid:!0,data:s}}if(r===i.ZodParsedType.array&&n===i.ZodParsedType.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const s=L(e[n],t[n]);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}return r===i.ZodParsedType.date&&n===i.ZodParsedType.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}t.ZodDiscriminatedUnion=D;class U extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if((0,a.isAborted)(e)||(0,a.isAborted)(n))return a.INVALID;const s=L(e.value,n.value);return s.valid?(((0,a.isDirty)(e)||(0,a.isDirty)(n))&&t.dirty(),{status:t.value,value:s.data}):((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_intersection_types}),a.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=U,U.create=(e,t,r)=>new U({left:e,right:t,typeName:oe.ZodIntersection,...u(r)});class F extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.array)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.array,received:r.parsedType}),a.INVALID;if(r.data.length<this._def.items.length)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new c(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>a.ParseStatus.mergeArray(t,e))):a.ParseStatus.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new F({...this._def,rest:e})}}t.ZodTuple=F,F.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new F({items:e,typeName:oe.ZodTuple,rest:null,...u(t)})};class V extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.object)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.object,received:r.parsedType}),a.INVALID;const n=[],s=this._def.keyType,l=this._def.valueType;for(const e in r.data)n.push({key:s._parse(new c(r,e,r.path,e)),value:l._parse(new c(r,r.data[e],r.path,e))});return r.common.async?a.ParseStatus.mergeObjectAsync(t,n):a.ParseStatus.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new V(t instanceof d?{keyType:e,valueType:t,typeName:oe.ZodRecord,...u(r)}:{keyType:v.create(),valueType:e,typeName:oe.ZodRecord,...u(t)})}}t.ZodRecord=V;class B extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.map)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.map,received:r.parsedType}),a.INVALID;const n=this._def.keyType,s=this._def.valueType,l=[...r.data.entries()].map((([e,t],a)=>({key:n._parse(new c(r,e,r.path,[a,"key"])),value:s._parse(new c(r,t,r.path,[a,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of l){const n=await r.key,s=await r.value;if("aborted"===n.status||"aborted"===s.status)return a.INVALID;"dirty"!==n.status&&"dirty"!==s.status||t.dirty(),e.set(n.value,s.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of l){const n=r.key,s=r.value;if("aborted"===n.status||"aborted"===s.status)return a.INVALID;"dirty"!==n.status&&"dirty"!==s.status||t.dirty(),e.set(n.value,s.value)}return{status:t.value,value:e}}}}t.ZodMap=B,B.create=(e,t,r)=>new B({valueType:t,keyType:e,typeName:oe.ZodMap,...u(r)});class z extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==i.ZodParsedType.set)return(0,a.addIssueToContext)(r,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.set,received:r.parsedType}),a.INVALID;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&((0,a.addIssueToContext)(r,{code:o.ZodIssueCode.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const s=this._def.valueType;function l(e){const r=new Set;for(const n of e){if("aborted"===n.status)return a.INVALID;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const u=[...r.data.values()].map(((e,t)=>s._parse(new c(r,e,r.path,t))));return r.common.async?Promise.all(u).then((e=>l(e))):l(u)}min(e,t){return new z({...this._def,minSize:{value:e,message:s.errorUtil.toString(t)}})}max(e,t){return new z({...this._def,maxSize:{value:e,message:s.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=z,z.create=(e,t)=>new z({valueType:e,minSize:null,maxSize:null,typeName:oe.ZodSet,...u(t)});class K extends d{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.ZodParsedType.function)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.function,received:t.parsedType}),a.INVALID;function r(e,r){return(0,a.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,n.getErrorMap)(),n.defaultErrorMap].filter((e=>!!e)),issueData:{code:o.ZodIssueCode.invalid_arguments,argumentsError:r}})}function s(e,r){return(0,a.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,n.getErrorMap)(),n.defaultErrorMap].filter((e=>!!e)),issueData:{code:o.ZodIssueCode.invalid_return_type,returnTypeError:r}})}const c={errorMap:t.common.contextualErrorMap},l=t.data;if(this._def.returns instanceof X){const e=this;return(0,a.OK)((async function(...t){const n=new o.ZodError([]),a=await e._def.args.parseAsync(t,c).catch((e=>{throw n.addIssue(r(t,e)),n})),i=await Reflect.apply(l,this,a);return await e._def.returns._def.type.parseAsync(i,c).catch((e=>{throw n.addIssue(s(i,e)),n}))}))}{const e=this;return(0,a.OK)((function(...t){const n=e._def.args.safeParse(t,c);if(!n.success)throw new o.ZodError([r(t,n.error)]);const a=Reflect.apply(l,this,n.data),i=e._def.returns.safeParse(a,c);if(!i.success)throw new o.ZodError([s(a,i.error)]);return i.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new K({...this._def,args:F.create(e).rest(C.create())})}returns(e){return new K({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new K({args:e||F.create([]).rest(C.create()),returns:t||C.create(),typeName:oe.ZodFunction,...u(r)})}}t.ZodFunction=K;class q extends d{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=q,q.create=(e,t)=>new q({getter:e,typeName:oe.ZodLazy,...u(t)});class H extends d{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{received:t.data,code:o.ZodIssueCode.invalid_literal,expected:this._def.value}),a.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function W(e,t){return new J({values:e,typeName:oe.ZodEnum,...u(t)})}t.ZodLiteral=H,H.create=(e,t)=>new H({value:e,typeName:oe.ZodLiteral,...u(t)});class J extends d{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return(0,a.addIssueToContext)(t,{expected:i.util.joinValues(r),received:t.parsedType,code:o.ZodIssueCode.invalid_type}),a.INVALID}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return(0,a.addIssueToContext)(t,{received:t.data,code:o.ZodIssueCode.invalid_enum_value,options:r}),a.INVALID}return(0,a.OK)(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return J.create(e)}exclude(e){return J.create(this.options.filter((t=>!e.includes(t))))}}t.ZodEnum=J,J.create=W;class G extends d{_parse(e){const t=i.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==i.ZodParsedType.string&&r.parsedType!==i.ZodParsedType.number){const e=i.util.objectValues(t);return(0,a.addIssueToContext)(r,{expected:i.util.joinValues(e),received:r.parsedType,code:o.ZodIssueCode.invalid_type}),a.INVALID}if(-1===t.indexOf(e.data)){const e=i.util.objectValues(t);return(0,a.addIssueToContext)(r,{received:r.data,code:o.ZodIssueCode.invalid_enum_value,options:e}),a.INVALID}return(0,a.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=G,G.create=(e,t)=>new G({values:e,typeName:oe.ZodNativeEnum,...u(t)});class X extends d{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==i.ZodParsedType.promise&&!1===t.common.async)return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.promise,received:t.parsedType}),a.INVALID;const r=t.parsedType===i.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,a.OK)(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}t.ZodPromise=X,X.create=(e,t)=>new X({type:e,typeName:oe.ZodPromise,...u(t)});class Y extends d{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===oe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:e=>{(0,a.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===n.type){const e=n.transform(r.data,s);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r}))):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?a.INVALID:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?a.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,a.isValid)(e))return e;const i=n.transform(e.value,s);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>(0,a.isValid)(e)?Promise.resolve(n.transform(e.value,s)).then((e=>({status:t.value,value:e}))):e))}i.util.assertNever(n)}}t.ZodEffects=Y,t.ZodTransformer=Y,Y.create=(e,t,r)=>new Y({schema:e,typeName:oe.ZodEffects,effect:t,...u(r)}),Y.createWithPreprocess=(e,t,r)=>new Y({schema:t,effect:{type:"preprocess",transform:e},typeName:oe.ZodEffects,...u(r)});class Q extends d{_parse(e){return this._getType(e)===i.ZodParsedType.undefined?(0,a.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=Q,Q.create=(e,t)=>new Q({innerType:e,typeName:oe.ZodOptional,...u(t)});class ee extends d{_parse(e){return this._getType(e)===i.ZodParsedType.null?(0,a.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=ee,ee.create=(e,t)=>new ee({innerType:e,typeName:oe.ZodNullable,...u(t)});class te extends d{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===i.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=te,te.create=(e,t)=>new te({innerType:e,typeName:oe.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...u(t)});class re extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,a.isAsync)(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new o.ZodError(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new o.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=re,re.create=(e,t)=>new re({innerType:e,typeName:oe.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...u(t)});class ne extends d{_parse(e){if(this._getType(e)!==i.ZodParsedType.nan){const t=this._getOrReturnCtx(e);return(0,a.addIssueToContext)(t,{code:o.ZodIssueCode.invalid_type,expected:i.ZodParsedType.nan,received:t.parsedType}),a.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=ne,ne.create=e=>new ne({typeName:oe.ZodNaN,...u(e)}),t.BRAND=Symbol("zod_brand");class se extends d{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=se;class ae extends d{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?a.INVALID:"dirty"===e.status?(t.dirty(),(0,a.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?a.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ae({in:e,out:t,typeName:oe.ZodPipeline})}}t.ZodPipeline=ae;class ie extends d{_parse(e){const t=this._def.innerType._parse(e);return(0,a.isValid)(t)&&(t.value=Object.freeze(t.value)),t}}var oe;t.ZodReadonly=ie,ie.create=(e,t)=>new ie({innerType:e,typeName:oe.ZodReadonly,...u(t)}),t.custom=(e,t={},r)=>e?E.create().superRefine(((n,s)=>{var a,i;if(!e(n)){const e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,o=null===(i=null!==(a=e.fatal)&&void 0!==a?a:r)||void 0===i||i,c="string"==typeof e?{message:e}:e;s.addIssue({code:"custom",...c,fatal:o})}})):E.create(),t.late={object:Z.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(oe=t.ZodFirstPartyTypeKind||(t.ZodFirstPartyTypeKind={})),t.instanceof=(e,r={message:`Input not instance of ${e.name}`})=>(0,t.custom)((t=>t instanceof e),r);const ce=v.create;t.string=ce;const le=x.create;t.number=le;const ue=ne.create;t.nan=ue;const de=O.create;t.bigint=de;const he=P.create;t.boolean=he;const pe=I.create;t.date=pe;const me=T.create;t.symbol=me;const fe=A.create;t.undefined=fe;const ge=k.create;t.null=ge;const ye=E.create;t.any=ye;const be=C.create;t.unknown=be;const _e=j.create;t.never=_e;const ve=S.create;t.void=ve;const we=N.create;t.array=we;const xe=Z.create;t.object=xe;const Oe=Z.strictCreate;t.strictObject=Oe;const Pe=$.create;t.union=Pe;const Ie=D.create;t.discriminatedUnion=Ie;const Te=U.create;t.intersection=Te;const Ae=F.create;t.tuple=Ae;const ke=V.create;t.record=ke;const Ee=B.create;t.map=Ee;const Ce=z.create;t.set=Ce;const je=K.create;t.function=je;const Se=q.create;t.lazy=Se;const Ne=H.create;t.literal=Ne;const Re=J.create;t.enum=Re;const Ze=G.create;t.nativeEnum=Ze;const $e=X.create;t.promise=$e;const Me=Y.create;t.effect=Me,t.transformer=Me;const De=Q.create;t.optional=De;const Le=ee.create;t.nullable=Le;const Ue=Y.createWithPreprocess;t.preprocess=Ue;const Fe=ae.create;t.pipeline=Fe,t.ostring=()=>ce().optional(),t.onumber=()=>le().optional(),t.oboolean=()=>he().optional(),t.coerce={string:e=>v.create({...e,coerce:!0}),number:e=>x.create({...e,coerce:!0}),boolean:e=>P.create({...e,coerce:!0}),bigint:e=>O.create({...e,coerce:!0}),date:e=>I.create({...e,coerce:!0})},t.NEVER=a.INVALID},8138:(e,t,r)=>{"use strict";r.a(e,(async(e,t)=>{try{var n=r(8783),s=r(7570);document.addEventListener("submit",(e=>{e.preventDefault(),u()}));const a="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",i=new n.z({openAIApiKey:a}),o="Given a question, convert it into a standalone question.question: {question} standalone question:",c=s.Pf.fromTemplate(o).pipe(i),l=await c.invoke({question:"What are the technical requirements for running scrimba? I have a very old laptop which is not that powerful."});async function u(){const e=document.getElementById("user-input"),t=document.getElementById("chatbot-conversation-container"),r=e.value;e.value="";const n=document.createElement("div");n.classList.add("speech","speech-human"),t.appendChild(n),n.textContent=r,t.scrollTop=t.scrollHeight;const s=document.createElement("div");s.classList.add("speech","speech-ai"),t.appendChild(s),s.textContent=result,t.scrollTop=t.scrollHeight}console.log(l),t()}catch(d){t(d)}}),1)},6515:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var n=r(1156),s=r(6141);class a extends class{}{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,s.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||"true"!=="MISSING_ENV_VAR"?.LANGCHAIN_CALLBACKS_BACKGROUND}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return s.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return s.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends a{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n.Z()}),Object.assign(this,e)}}}}},3905:(e,t,r)=>{"use strict";r.d(t,{Ye:()=>H});var n=r(1156),s=r(6515),a=r(265),i=r(4075);function o(e,t){return`${e.open}${t}${e.close}`}function c(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function l(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:u}=a;class d extends i.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const e=this.runMap.get(r.parent_run_id);if(!e)break;t.push(e),r=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,r)=>{const n=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?o(a.bold,n):n})).join(" > ");return o(u.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[chain/start]")} [${t}] Entering Chain run with input: ${c(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[chain/end]")} [${t}] [${l(e)}] Exiting Chain run with output: ${c(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[chain/error]")} [${t}] [${l(e)}] Chain run errored with error: ${c(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${o(u.green,"[llm/start]")} [${t}] Entering LLM run with input: ${c(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[llm/end]")} [${t}] [${l(e)}] Exiting LLM run with output: ${c(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[llm/error]")} [${t}] [${l(e)}] LLM run errored with error: ${c(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[tool/end]")} [${t}] [${l(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[tool/error]")} [${t}] [${l(e)}] Tool run errored with error: ${c(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${c(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[retriever/end]")} [${t}] [${l(e)}] Exiting Retriever run with output: ${c(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[retriever/error]")} [${t}] [${l(e)}] Retriever run errored with error: ${c(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${o(u.blue,"[agent/action]")} [${r}] Agent selected action: ${c(t.actions[t.actions.length-1],"[action]")}`)}}const h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,p={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let m;const f=new Uint8Array(16);function g(){if(!m&&(m="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!m))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(f)}const y=[];for(let e=0;e<256;++e)y.push((e+256).toString(16).slice(1));const b=function(e,t,r){if(p.randomUUID&&!t&&!e)return p.randomUUID();const n=(e=e||{}).random||(e.rng||g)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return y[e[t+0]]+y[e[t+1]]+y[e[t+2]]+y[e[t+3]]+"-"+y[e[t+4]]+y[e[t+5]]+"-"+y[e[t+6]]+y[e[t+7]]+"-"+y[e[t+8]]+y[e[t+9]]+"-"+y[e[t+10]]+y[e[t+11]]+y[e[t+12]]+y[e[t+13]]+y[e[t+14]]+y[e[t+15]]}(n)};var _=r(2693),v=r(5860);const w=[400,401,403,404,405,406,407,408,409];class x{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t=v.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>_((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&w.includes(+t))throw e},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function O(e){return"function"==typeof e?._getType}function P(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}const I=()=>"undefined"!=typeof Deno;let T,A;async function k(){if(void 0===T){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||I()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":I()?"deno":"other":"node",e})(),t=function(){if(void 0!==A)return A;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const r of e){const e=E(r);void 0!==e&&(t[r]=e)}return A=t,t}();T={library:"langsmith",runtime:e,...t}}return T}function E(e){try{return"undefined"!=typeof process?"MISSING_ENV_VAR"?.[e]:void 0}catch(e){return}}const C=e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},j=async(e,t)=>{const r=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};function S(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function N(e){return"true"===E("LANGCHAIN_HIDE_INPUTS")?{}:e}function R(e){return"true"===E("LANGCHAIN_HIDE_OUTPUTS")?{}:e}function Z(e){if("string"!=typeof(t=e)||!h.test(t))throw new Error(`Invalid UUID: ${e}`);var t}class ${constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});const t=$.getDefaultClientConfig();this.apiUrl=S(e.apiUrl??t.apiUrl)??"",this.apiKey=S(e.apiKey??t.apiKey),this.webUrl=S(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new x(e.callerOptions??{})}static getDefaultClientConfig(){const e=E("LANGCHAIN_API_KEY");return{apiUrl:E("LANGCHAIN_ENDPOINT")??(e?"https://api.smith.langchain.com":"http://localhost:1984"),apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){if(!C(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:C(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _getResponse(e,t){const r=t?.toString()??"",n=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);return s}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(n));const s=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const i=await a.json();if(0===i.length)break;if(yield i,i.length<n)break;r+=i.length}}async*_getCursorPaginatedList(e,t=null,r="POST",n="runs"){let s=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(s)}),a=await t.json();if(!a)break;if(!a[n])break;yield a[n];const i=a.cursors;if(!i)break;if(!i.next)break;s.cursor=i.next}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},n=await k(),s=e.project_name;delete e.project_name;const a={session_name:s,...e,extra:{...e.extra,runtime:{...n,...r.runtime}}};a.inputs=N(a.inputs),a.outputs&&(a.outputs=R(a.outputs));const i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await j(i,"create run")}async updateRun(e,t){Z(e),t.inputs&&(t.inputs=N(t.inputs)),t.outputs&&(t.outputs=R(t.outputs));const r={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await j(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Z(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:E("LANGCHAIN_PROJECT")||"default"})).id;const n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(this.listRuns({id:e.child_run_ids})),r={},n={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),n[e.id]=e}e.child_runs=r[e.id]||[];for(const t in r)t!==e.id&&(n[t].child_runs=r[t]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,referenceExampleId:n,startTime:s,executionOrder:a,runType:i,error:o,id:c,query:l,filter:u,limit:d}){let h=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");h=(await this.readProject({projectName:t})).id}const p={session:h?[h]:null,run_type:i,reference_example:n,query:l,filter:u,execution_order:a,parent_run:r?[r]:null,start_time:s?s.toISOString():null,error:o,id:c,limit:d};for await(const e of this._getCursorPaginatedList("/runs/query",p))yield*e}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||b()};Z(e);const n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),s=await n.json();if(null===s||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){Z(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(t,"unshare run")}async readRunSharedLink(e){Z(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)r.append("id",e);Z(e);const n=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await n.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Z(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),n=await r.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};Z(e);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),s=await n.json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){Z(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(t,"unshare dataset")}async readSharedDataset(e){Z(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:n=!1,projectExtra:s=null,referenceDatasetId:a=null}){const i=n?"?upsert=true":"",o=`${this.apiUrl}/sessions${i}`,c=s||{};r&&(c.metadata=r);const l={name:e,extra:c,description:t};null!==a&&(l.reference_dataset_id=a);const u=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),d=await u.json();if(!u.ok)throw new Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return d}async updateProject(e,{name:t=null,description:r=null,metadata:n=null,projectExtra:s=null,endTime:a=null}){const i=`${this.apiUrl}/sessions/${e}`;let o=s;n&&(o={...o||{},metadata:n});const c={name:t,extra:o,description:r,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(fetch,i,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)}),u=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return u}async readProject({projectId:e,projectName:t}){let r="/sessions";const n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)Z(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");n.append("name",t)}const s=await this._get(r,n);let a;if(Array.isArray(s)){if(0===s.length)throw new Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:n,referenceDatasetName:s,referenceFree:a}={}){const i=new URLSearchParams;if(void 0!==e)for(const t of e)i.append("id",t);if(void 0!==t&&i.append("name",t),void 0!==r&&i.append("name_contains",r),void 0!==n)i.append("reference_dataset",n);else if(void 0!==s){const e=await this.readDataset({datasetName:s});i.append("reference_dataset",e.id)}void 0!==a&&i.append("reference_free",a.toString());for await(const e of this._getPaginated("/sessions",i))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");r=void 0===e?(await this.readProject({projectName:t})).id:e,Z(r);const n=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await j(n,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:n,description:s,dataType:a,name:i}){const o=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach((e=>{c.append("input_keys",e)})),n.forEach((e=>{c.append("output_keys",e)})),s&&c.append("description",s),a&&c.append("data_type",a),i&&c.append("name",i);const l=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok){const e=await l.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const n={name:e,description:t};r&&(n.data_type=r);const s=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok){const t=await s.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${s.status} ${s.statusText}`)}return await s.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)Z(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");n.append("name",t)}const s=await this._get(r,n);let a;if(Array.isArray(s)){if(0===s.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:n,datasetNameContains:s}={}){const a=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(const e of r)a.append("id",e);void 0!==n&&a.append("name",n),void 0!==s&&a.append("name_contains",s);for await(const e of this._getPaginated("/datasets",a))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",n=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(n=(await this.readDataset({datasetName:t})).id),void 0===n)throw new Error("Must provide datasetName or datasetId");Z(n),r+=`/${n}`;const s=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to delete ${r}: ${s.status} ${s.statusText}`);await s.json()}async createExample(e,t,{datasetId:r,datasetName:n,createdAt:s,exampleId:a}){let i=r;if(void 0===i&&void 0===n)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:n})).id);const o={dataset_id:i,inputs:e,outputs:t,created_at:(s||new Date).toISOString(),id:a},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const n=e.map((e=>O(e)?P(e):e)),s=O(t)?P(t):t;return this.createExample({input:n},{output:s},r)}async readExample(e){Z(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let n;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)n=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");n=(await this.readDataset({datasetName:t})).id}const s=new URLSearchParams({dataset:n});if(void 0!==r)for(const e of r)s.append("id",e);for await(const e of this._getPaginated("/examples",s))yield*e}async deleteExample(e){Z(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){Z(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:n}={loadChildRuns:!1}){let s,a;if("string"==typeof e)s=await this.readRun(e,{loadChildRuns:n});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);s=e}null!==s.reference_example_id&&void 0!==s.reference_example_id&&(a=await this.readExample(s.reference_example_id));const i=await t.evaluateRun(s,a);let o=r??{};return i.evaluatorInfo&&(o={...o,...i.evaluatorInfo}),await this.createFeedback(s.id,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,feedbackSourceType:"model"})}async createFeedback(e,t,{score:r,value:n,correction:s,comment:a,sourceInfo:i,feedbackSourceType:o="api",sourceRunId:c,feedbackId:l,eager:u=!1}){const d={type:o??"api",metadata:i??{}};void 0===c||void 0===d?.metadata||d.metadata.__run||(d.metadata.__run={run_id:c}),void 0!==d?.metadata&&void 0!==d.metadata.__run?.run_id&&Z(d.metadata.__run.run_id);const h={id:l??b(),run_id:e,key:t,score:r,value:n,correction:s,comment:a,feedback_source:d},p=`${this.apiUrl}/feedback`+(u?"/eager":""),m=await this.caller.call(fetch,p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms)});return await j(m,"create feedback"),h}async updateFeedback(e,{score:t,value:r,correction:n,comment:s}){const a={};null!=t&&(a.score=t),null!=r&&(a.value=r),null!=n&&(a.correction=n),null!=s&&(a.comment=s),Z(e);const i=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await j(i,"update feedback")}async readFeedback(e){Z(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Z(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const n=new URLSearchParams;if(e&&n.append("run",e.join(",")),t)for(const e of t)n.append("key",e);if(r)for(const e of r)n.append("source",e);for await(const e of this._getPaginated("/feedback",n))yield*e}}var M=r(6374);class D extends i.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:n}=e;this.projectName=r??(0,M.lS)("LANGCHAIN_PROJECT")??(0,M.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=n??new $({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await(0,M.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}var L=r(3908);let U;async function F(e,t){!0===t?await e():(void 0===U&&(U=new(0,v.default)({autoStart:!0,concurrency:1})),U.add(e))}class V{constructor(e,t,r,n,s,a,i,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>F((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class B extends V{getChild(e){const t=new H(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class z extends V{async handleLLMNewToken(e,t,r,n,s,a){await Promise.all(this.handlers.map((r=>F((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}}),r.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class K extends V{getChild(e){const t=new H(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,n,s){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,r,n,s){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class q extends V{getChild(e){const t=new H(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>F((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class H extends class{setHandler(e){return this.setHandlers([e])}}{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,r,s,a,i,o,c){return Promise.all(t.map((async t=>{const r=(0,n.Z)();return await Promise.all(this.handlers.map((n=>F((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMStart?.(e,[t],r,this._parentRunId,a,this.tags,this.metadata,c))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new z(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,r,s,a,i,o,c){return Promise.all(t.map((async t=>{const r=(0,n.Z)();return await Promise.all(this.handlers.map((n=>F((async()=>{if(!n.ignoreLLM)try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],r,this._parentRunId,a,this.tags,this.metadata,c));else if(n.handleLLMStart){const s=(0,L.zs)(t);await(n.handleLLMStart?.(e,[s],r,this._parentRunId,a,this.tags,this.metadata,c))}}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new z(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,r=(0,n.Z)(),s,a,i,o){return await Promise.all(this.handlers.map((n=>F((async()=>{if(!n.ignoreChain)try{await(n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`)}}),n.awaitHandlers)))),new K(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,n.Z)(),s,a,i,o){return await Promise.all(this.handlers.map((n=>F((async()=>{if(!n.ignoreAgent)try{await(n.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleToolStart: ${e}`)}}),n.awaitHandlers)))),new q(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,n.Z)(),s,a,i,o){return await Promise.all(this.handlers.map((n=>F((async()=>{if(!n.ignoreRetriever)try{await(n.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleRetrieverStart: ${e}`)}}),n.awaitHandlers)))),new B(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new H(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);r.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(const n of e)r.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===n.name))||r.addHandler(n,t);return r}static fromHandlers(e){class t extends s.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.Z)()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,n,s,a,i){let o;(e||t)&&(Array.isArray(e)||!e?(o=new H,o.setHandlers(e?.map(W)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(W):t?.handlers,!1));const c="true"===(0,M.lS)("LANGCHAIN_VERBOSE")||i?.verbose,l="true"===(0,M.lS)("LANGCHAIN_TRACING_V2"),u=l||((0,M.lS)("LANGCHAIN_TRACING")??!1);if(c||u){if(o||(o=new H),c&&!o.handlers.some((e=>e.name===d.prototype.name))){const e=new d;o.addHandler(e,!0)}u&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&l&&o.addHandler(await async function(){return new D}(),!0)}return(r||n)&&o&&(o.addTags(r??[]),o.addTags(n??[],!1)),(s||a)&&o&&(o.addMetadata(s??{}),o.addMetadata(a??{},!1)),o}}function W(e){return"name"in e?e:s.E.fromMethods(e)}},6141:(e,t,r)=>{"use strict";r.d(t,{i:()=>l,j:()=>c});var n=r(2466);function s(e,t){return t?.[e]||n(e)}function a(e,t,r){const n={};for(const s in e)Object.hasOwn(e,s)&&(n[t(s,r)]=e[s]);return n}function i(e){return Array.isArray(e)?[...e]:{...e}}function o(e,t){const r=i(e);for(const[e,n]of Object.entries(t)){const[t,...s]=e.split(".").reverse();let a=r;for(const e of s.reverse()){if(void 0===a[e])break;a[e]=i(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[n]})}return r}function c(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}r(3204);class l{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,c(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof l||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n,"lc_aliases",this)),Object.assign(t,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,n=r;const[s,...a]=e.split(".").reverse();for(const e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in n&&void 0!==n[e]||("object"==typeof t[e]&&null!=t[e]?n[e]={}:Array.isArray(t[e])&&(n[e]=[])),t=t[e],n=n[e]}s in t&&void 0!==t[s]&&(n[s]=n[s]||t[s])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:a(Object.keys(t).length?o(r,t):r,s,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},3908:(e,t,r)=>{"use strict";r.d(t,{Cr:()=>m,E1:()=>y,GC:()=>d,HD:()=>b,J:()=>g,Xz:()=>f,gY:()=>u,ro:()=>l,xk:()=>c,xq:()=>p,zs:()=>_});var n=r(6141);function s(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class a extends n.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){const e=this._getType();if("human"===e)return new l({...this});if("ai"===e)return new d({...this});if("system"===e)return new p({...this});if("function"===e)return new m({...this});if(g.isInstance(this))return new b({...this});throw new Error("Unknown message type.")}}function i(e){return Array.isArray(e)&&e.every((e=>"number"==typeof e.index))}class o extends a{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[e,n]of Object.entries(t))if(void 0===r[e])r[e]=n;else{if(typeof r[e]!=typeof n)throw new Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof r[e])r[e]=r[e]+n;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if("tool_calls"!==e||!i(r[e])||!i(n))throw new Error(`additional_kwargs[${e}] already exists in this message chunk.`);for(const t of n)void 0!==r[e]?.[t.index]?r[e]=r[e]?.map(((e,r)=>r!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}})):r[e][t.index]=t}else r[e]=this._mergeAdditionalKwargs(r[e],n)}return r}}class c extends a{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class l extends o{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new l({content:s(this.content,e.content),additional_kwargs:l._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class u extends a{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class d extends o{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new d({content:s(this.content,e.content),additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class h extends a{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class p extends o{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new p({content:s(this.content,e.content),additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class m extends o{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new m({content:s(this.content,e.content),additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class f extends o{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new f({content:s(this.content,e.content),additional_kwargs:f._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}class g extends a{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function y(e){if("string"==typeof e)return new c(e);if(function(e){return"function"==typeof e?._getType}(e))return e;const[t,r]=e;if("human"===t||"user"===t)return new c({content:r});if("ai"===t||"assistant"===t)return new u({content:r});if("system"===t)return new h({content:r});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class b extends o{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new b({content:s(this.content,e.content),additional_kwargs:b._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function _(e,t="Human",r="AI"){const n=[];for(const s of e){let e;if("human"===s._getType())e=t;else if("ai"===s._getType())e=r;else if("system"===s._getType())e="System";else if("function"===s._getType())e="Function";else if("tool"===s._getType())e="Tool";else{if("generic"!==s._getType())throw new Error(`Got unsupported message type: ${s._getType()}`);e=s.role}const a=s.name?`${s.name}, `:"";n.push(`${e}: ${a}${s.content}`)}return n.join("\n")}},1141:(e,t,r)=>{"use strict";r.d(t,{GU:()=>o,nw:()=>i});var n=r(6141),s=r(3908);class a extends n.i{}class i extends a{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new s.xk(this.value)]}}class o extends a{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,s.zs)(this.messages)}toChatMessages(){return this.messages}}},619:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var n=r(2399);class s extends n.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[e,n]of Object.entries(t))r[e]="string"==typeof n?n:await n();return{...r,...e}}async invoke(e,t){return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,1214));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(r.bind(r,1214));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(r.bind(r,7315));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}},9242:(e,t,r)=>{"use strict";r.d(t,{S:()=>a}),r(3908);var n=r(1141),s=(r(2399),r(619));r(1214);class a extends s.d{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new n.GU(t)}}},7315:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FewShotChatMessagePromptTemplate:()=>c,FewShotPromptTemplate:()=>o});var n=r(1307),s=r(7327),a=r(1214),i=r(9242);class o extends n.A{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},n={...this,inputVariables:t,partialVariables:r};return new o(n)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),n=await Promise.all(r.map((e=>this.examplePrompt.format(e)))),a=[this.prefix,...n,this.suffix].join(this.exampleSeparator);return(0,s.SM)(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await a.PromptTemplate.deserialize(t);let n;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return n=e.examples,new o({inputVariables:e.input_variables,examplePrompt:r,examples:n,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class c extends i.S{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.af)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=await this.getExamples(t);r=r.map((e=>{const t={};return this.examplePrompt.inputVariables.forEach((r=>{t[r]=e[r]})),t}));const n=[];for(const e of r){const t=await this.examplePrompt.formatMessages(e);n.push(...t)}return n}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),n=(await Promise.all(r.map((e=>this.examplePrompt.formatMessages(e))))).flat().map((e=>e.content)),a=[this.prefix,...n,this.suffix].join(this.exampleSeparator);return(0,s.SM)(a,this.templateFormat,t)}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},n={...this,inputVariables:t,partialVariables:r};return new c(n)}}},1214:(e,t,r)=>{"use strict";r.r(t),r.d(t,{PromptTemplate:()=>a});var n=r(1307),s=r(7327);class a extends n.A{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.af)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,s.SM)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,n="\n\n",s=""){const i=[s,...e,t].join(n);return new a({inputVariables:r,template:i})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){const n=new Set;return(0,s.$M)(e,t).forEach((e=>{"variable"===e.type&&n.add(e.name)})),new a({inputVariables:[...n],templateFormat:t,template:e,...r})}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},n={...this,inputVariables:t,partialVariables:r};return new a(n)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new a({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},1307:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(1141),s=r(619);class a extends s.d{async formatPromptValue(e){const t=await this.format(e);return new n.nw(t)}}},7327:(e,t,r)=>{"use strict";r.d(t,{$M:()=>o,SM:()=>i,af:()=>c});const n=e=>{const t=e.split(""),r=[],n=(e,r)=>{for(let n=r;n<t.length;n+=1)if(e.includes(t[n]))return n;return-1};let s=0;for(;s<t.length;)if("{"===t[s]&&s+1<t.length&&"{"===t[s+1])r.push({type:"literal",text:"{"}),s+=2;else if("}"===t[s]&&s+1<t.length&&"}"===t[s+1])r.push({type:"literal",text:"}"}),s+=2;else if("{"===t[s]){const e=n("}",s);if(e<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(s+1,e).join("")}),s=e+1}else{if("}"===t[s])throw new Error("Single '}' in template.");{const e=n("{}",s),a=(e<0?t.slice(s):t.slice(s,e)).join("");r.push({type:"literal",text:a}),s=e<0?t.length:e}}return r},s={"f-string":(e,t)=>n(e).reduce(((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw new Error(`Missing value for input ${r.name}`)}return e+r.text}),"")},a={"f-string":n},i=(e,t,r)=>s[t](e,r),o=(e,t)=>a[t](e),c=(e,t,r)=>{if(!(t in s)){const e=Object.keys(s);throw new Error(`Invalid template format. Got \`${t}\`;\n                         should be one of ${e}`)}try{const n=r.reduce(((e,t)=>(e[t]="foo",e)),{});i(e,t,n)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},2399:(e,t,r)=>{"use strict";r.d(t,{eq:()=>D});var n={};r.r(n),r.d(n,{JsonPatchError:()=>p,_areEquals:()=>O,applyOperation:()=>b,applyPatch:()=>_,applyReducer:()=>v,deepClone:()=>m,getValueByPointer:()=>y,validate:()=>x,validator:()=>w});var s=r(2693),a=r(3905);const i=Object.prototype.hasOwnProperty;function o(e,t){return i.call(e,t)}function c(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t=0;const r=e.length;let n;for(;t<r;){if(n=e.charCodeAt(t),!(n>=48&&n<=57))return!1;t++}return!0}function u(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(u(e[t]))return!0}else if("object"==typeof e){const r=function(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)o(e,r)&&t.push(r);return t}(e),n=r.length;for(var t=0;t<n;t++)if(u(e[r[t]]))return!0}return!1}function d(e,t){const r=[e];for(const e in t){const n="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==n&&r.push(`${e}: ${n}`)}return r.join("\n")}class h extends Error{constructor(e,t,r,n,s){super(d(e,{name:t,index:r,operation:n,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=d(e,{name:t,index:r,operation:n,tree:s})}}const p=h,m=c,f={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){let n=y(r,this.path);n&&(n=c(n));const s=b(r,{op:"remove",path:this.from}).removed;return b(r,{op:"add",path:this.path,value:s}),{newDocument:r,removed:n}},copy:function(e,t,r){const n=y(r,this.from);return b(r,{op:"add",path:this.path,value:c(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:O(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var g={add:function(e,t,r){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:f.move,copy:f.copy,test:f.test,_get:f._get};function y(e,t){if(""==t)return e;var r={op:"_get",path:t};return b(e,r),r.value}function b(e,t,r=!1,n=!0,s=!0,a=0){if(r&&("function"==typeof r?r(t,0,e,t.path):w(t,0)),""===t.path){let n={newDocument:e};if("add"===t.op)return n.newDocument=t.value,n;if("replace"===t.op)return n.newDocument=t.value,n.removed=e,n;if("move"===t.op||"copy"===t.op)return n.newDocument=y(e,t.from),"move"===t.op&&(n.removed=e),n;if("test"===t.op){if(n.test=O(e,t.value),!1===n.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return n.newDocument=e,n}if("remove"===t.op)return n.removed=e,n.newDocument=null,n;if("_get"===t.op)return t.value=e,n;if(r)throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return n}{n||(e=c(e));const i=(t.path||"").split("/");let o,u,d,h=e,m=1,y=i.length;for(d="function"==typeof r?r:w;;){if(u=i[m],u&&-1!=u.indexOf("~")&&(u=u.replace(/~1/g,"/").replace(/~0/g,"~")),s&&("__proto__"==u||"prototype"==u&&m>0&&"constructor"==i[m-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===o&&(void 0===h[u]?o=i.slice(0,m).join("/"):m==y-1&&(o=t.path),void 0!==o&&d(t,0,e,o)),m++,Array.isArray(h)){if("-"===u)u=h.length;else{if(r&&!l(u))throw new p("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);l(u)&&(u=~~u)}if(m>=y){if(r&&"add"===t.op&&u>h.length)throw new p("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);const n=g[t.op].call(t,h,u,e);if(!1===n.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return n}}else if(m>=y){const r=f[t.op].call(t,h,u,e);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}if(h=h[u],r&&m<y&&(!h||"object"!=typeof h))throw new p("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function _(e,t,r,n=!0,s=!0){if(r&&!Array.isArray(t))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=c(e));const a=new Array(t.length);for(let n=0,i=t.length;n<i;n++)a[n]=b(e,t[n],r,!0,s,n),e=a[n].newDocument;return a.newDocument=e,a}function v(e,t,r){const n=b(e,t);if(!1===n.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function w(e,t,r,n){if("object"!=typeof e||null===e||Array.isArray(e))throw new p("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(!f[e.op])throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r);if("string"!=typeof e.path)throw new p("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new p('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new p("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&u(e.value))throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r)if("add"==e.op){var s=e.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new p("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==n)throw new p("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var i=x([{op:"_get",path:e.from,value:void 0}],r);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new p("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}function x(e,t,r){try{if(!Array.isArray(e))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)_(c(t),c(e),r||!0);else{r=r||w;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(e){if(e instanceof p)return e;throw e}}function O(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,n,s,a=Array.isArray(e),i=Array.isArray(t);if(a&&i){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!O(e[r],t[r]))return!1;return!0}if(a!=i)return!1;var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=n;0!=r--;)if(!O(e[s=o[r]],t[s]))return!1;return!0}return e!=e&&t!=t}new WeakMap;var P=r(4075);class I extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new I({start:e=>function r(){return t.read().then((({done:t,value:n})=>{if(!t)return e.enqueue(n),r();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new I({async pull(t){const{value:r,done:n}=await e.next();n&&t.close(),t.enqueue(r)}})}}function T(e,t=2){const r=Array.from({length:t},(()=>[]));return r.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function A(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const r={...e};for(const[e,n]of Object.entries(t))r[e]=e in r?A(r[e],n):n;return r}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class k{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((r,n)=>{this.firstResult=e.next(),this.firstResult.then(t).then(r,n)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}class E{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){const t=this.ops.concat(e.ops),r=_({},t);return new C({ops:t,state:r[r.length-1].newDocument})}}class C extends E{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=_(this.state,e.ops);return new C({ops:t,state:r[r.length-1].newDocument})}}class j extends P.Z{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=I.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(void 0===e.parent_run_id)return!1;const t=e.tags??[];let r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every((e=>!this.excludeTags?.includes(e)))),r}async onRunCreate(e){if(void 0===e.parent_run_id&&await this.writer.write(new E({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]})),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new E({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const n=new E({ops:r});await this.writer.write(n)}finally{if(void 0===e.parent_run_id){const t=new E({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){const r=this.keyMapByRunId[e.id];if(void 0===r)return;const n=new E({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(n)}}var S=r(6141);async function N(e){return a.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function R(e,t){const r={...e};if(t)for(const n of Object.keys(t))if("metadata"===n)r[n]={...r[n],...t[n]};else if("tags"===n)r[n]=(r[n]??[]).concat(t[n]??[]);else if("configurable"===n)r[n]={...r[n],...t[n]};else if("callbacks"===n){const n=r.callbacks,s=t.callbacks??e.callbacks;if(Array.isArray(s))if(n)if(Array.isArray(n))r.callbacks=n.concat(s);else{const e=n.copy();for(const t of s)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=s;else if(s)if(n)if(Array.isArray(n)){const e=s.copy();for(const t of n)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=new a.Ye(s.parentRunId,{handlers:n.handlers.concat(s.handlers),inheritableHandlers:n.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(n.tags.concat(s.tags))),inheritableTags:Array.from(new Set(n.inheritableTags.concat(s.inheritableTags))),metadata:{...n.metadata,...s.metadata}});else r.callbacks=s}else r[n]=t[n]??r[n];return r}var Z=r(9636);class $ extends P.Z{constructor({config:e,onStart:t,onEnd:r,onError:n}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=n}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}function M(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class D extends S.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new L({bound:this,kwargs:e,config:{}})}map(){return new U({bound:this})}withRetry(e){return new F({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new L({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new K({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},(()=>e))}async batch(e,t,r){const n=this._getOptionsList(t??{},e.length),s=new Z.L({maxConcurrency:r?.maxConcurrency,onFailedAttempt:e=>{throw e}}),a=e.map(((e,t)=>s.call((async()=>{try{return await this.invoke(e,n[t])}catch(e){if(r?.returnExceptions)return e;throw e}}))));return Promise.all(a)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return I.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,[t,r]}async _callWithConfig(e,t,r){const n=await N(r),s=await(n?.handleChainStart(this.toJSON(),M(t,"input"),void 0,r?.runType,void 0,void 0,r?.runName??this.getName()));let a;try{a=await e.bind(this)(t,r,s)}catch(e){throw await(s?.handleChainError(e)),e}return await(s?.handleChainEnd(M(a,"output"))),a}async _batchWithConfig(e,t,r,n){const s=this._getOptionsList(r??{},t.length),a=await Promise.all(s.map(N)),i=await Promise.all(a.map(((e,r)=>e?.handleChainStart(this.toJSON(),M(t[r],"input"),void 0,s[r].runType,void 0,void 0,s[r].runName??this.getName()))));let o;try{o=await e(t,s,i,n)}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(M(o,"output"))))),o}async*_transformStreamWithConfig(e,t,r){let n,s,a=!0,i=!0;const o=await N(r);let c;try{const l=await async function(e,t,r,...n){const s=new k(t,r),a=await s.setup;return{output:e(s,a,...n),setup:a}}(t,async function*(){for await(const t of e){if(a)if(void 0===n)n=t;else try{n=A(n,t)}catch{n=void 0,a=!1}yield t}}(),(async()=>o?.handleChainStart(this.toJSON(),{input:""},void 0,r?.runType,void 0,void 0,r?.runName??this.getName())),r);c=l.setup;for await(const e of l.output)if(yield e,i)if(void 0===s)s=e;else try{s=A(s,e)}catch{s=void 0,i=!1}}catch(e){throw await(c?.handleChainError(e,void 0,void 0,void 0,{inputs:M(n,"input")})),e}await(c?.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:M(n,"input")}))}_patchConfig(e={},t,r){const n={...e};return void 0!==t?(delete n.runName,{...n,callbacks:t}):(void 0!==r&&(n.recursionLimit=r),n)}pipe(e){return new V({first:this,last:q(e)})}pick(e){return this.pipe(new W(e))}assign(e){return this.pipe(new H(new B({steps:e})))}async*transform(e,t){let r;for await(const t of e)r=void 0===r?t:A(r,t);yield*this._streamIterator(r,t)}async*streamLog(e,t,r){const n=new j({...r,autoClose:!1}),s=t??{},{callbacks:a}=s;if(void 0===a)s.callbacks=[n];else if(Array.isArray(a))s.callbacks=a.concat([n]);else{const e=a.copy();e.inheritableHandlers.push(n),s.callbacks=e}const i=await this.stream(e,s),o=async function(){try{for await(const e of i){const t=new E({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await n.writer.write(t)}}finally{await n.writer.close()}}();try{for await(const e of n)yield e}finally{await o}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:r}){return new L({bound:this,config:{},configFactories:[n=>({callbacks:[new $({config:n,onStart:e,onEnd:t,onError:r})]})]})}}class L extends D{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(e){const t=R(this.config,e);return R(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){const n=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig({...e,...this.kwargs})))):await this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,n,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig({...t,...this.kwargs}))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&D.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new L({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[n=>({callbacks:[new $({config:n,onStart:e,onEnd:t,onError:r})]})]})}}class U extends D{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new U({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r?.getChild()))}withListeners({onStart:e,onEnd:t,onError:r}){return new U({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class F extends L{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const n=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r?.getChild(n))}async _invoke(e,t,r){return s((n=>super.invoke(e,this._patchConfigForRetry(n,t,r))),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,n){const a={};try{await s((async s=>{const i=e.map(((e,t)=>t)).filter((e=>void 0===a[e.toString()]||a[e.toString()]instanceof Error)),o=i.map((t=>e[t])),c=i.map((e=>this._patchConfigForRetry(s,t?.[e],r?.[e]))),l=await super.batch(o,c,{...n,returnExceptions:!0});let u;for(let e=0;e<l.length;e+=1){const t=l[e],r=i[e];t instanceof Error&&void 0===u&&(u=t),a[r.toString()]=t}if(u)throw u;return l}),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==n?.returnExceptions)throw e}return Object.keys(a).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>a[parseInt(e,10)]))}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class V extends D{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await N(t),n=await(r?.handleChainStart(this.toJSON(),M(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let s,a=e;try{const e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){const s=e[r];a=await s.invoke(a,this._patchConfig(t,n?.getChild(`seq:step:${r+1}`)))}s=await this.last.invoke(a,this._patchConfig(t,n?.getChild(`seq:step:${this.steps.length}`)))}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(M(s,"output"))),s}async batch(e,t,r){const n=this._getOptionsList(t??{},e.length),s=await Promise.all(n.map(N)),a=await Promise.all(s.map(((t,r)=>t?.handleChainStart(this.toJSON(),M(e[r],"input"),void 0,void 0,void 0,void 0,n[r].runName))));let i,o=e;try{const e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){const s=e[t];o=await s.batch(o,a.map(((e,r)=>this._patchConfig(n[r],e?.getChild(`seq:step:${t+1}`)))),r)}i=await this.last.batch(o,a.map((e=>this._patchConfig(n[this.steps.length-1],e?.getChild(`seq:step:${this.steps.length}`)))),r)}catch(e){throw await Promise.all(a.map((t=>t?.handleChainError(e)))),e}return await Promise.all(a.map(((e,t)=>e?.handleChainEnd(M(i[t],"output"))))),i}async*_streamIterator(e,t){const r=await N(t),n=await(r?.handleChainStart(this.toJSON(),M(e,"input"),void 0,void 0,void 0,void 0,t?.runName)),s=[this.first,...this.middle,this.last];let a,i=!0;try{let r=s[0].transform(async function*(){yield e}(),this._patchConfig(t,n?.getChild("seq:step:1")));for(let e=1;e<s.length;e+=1){const a=s[e];r=await a.transform(r,this._patchConfig(t,n?.getChild(`seq:step:${e+1}`)))}for await(const e of r)if(yield e,i)if(void 0===a)a=e;else try{a=A(a,e)}catch(e){a=void 0,i=!1}}catch(e){throw await(n?.handleChainError(e)),e}await(n?.handleChainEnd(M(a,"output")))}pipe(e){return V.isRunnableSequence(e)?new V({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new V({first:this.first,middle:[...this.middle,this.last],last:q(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&D.isRunnable(e)}static from([e,...t],r){return new V({first:q(e),middle:t.slice(0,-1).map(q),last:q(t[t.length-1]),name:r})}}class B extends D{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=q(r)}static from(e){return new B({steps:e})}async invoke(e,t){const r=await N(t),n=await(r?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName)),s={};try{await Promise.all(Object.entries(this.steps).map((async([r,a])=>{s[r]=await a.invoke(e,this._patchConfig(t,n?.getChild(`map:key:${r}`)))})))}catch(e){throw await(n?.handleChainError(e)),e}return await(n?.handleChainEnd(s)),s}async*_transform(e,t,r){const n={...this.steps},s=T(e,Object.keys(n).length),a=new Map(Object.entries(n).map((([e,n],a)=>{const i=n.transform(s[a],this._patchConfig(r,t?.getChild(`map:key:${e}`)));return[e,i.next().then((t=>({key:e,gen:i,result:t})))]})));for(;a.size;){const{key:e,result:t,gen:r}=await Promise.race(a.values());a.delete(e),t.done||(yield{[e]:t.value},a.set(e,r.next().then((t=>({key:e,gen:r,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return I.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}class z extends D{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new z({func:e})}async _invoke(e,t,r){let n=await this.func(e,{config:t});if(n&&D.isRunnable(n)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");n=await n.invoke(e,this._patchConfig(t,r?.getChild(),(t?.recursionLimit??25)-1))}return n}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let n;for await(const t of e)if(void 0===n)n=t;else try{n=A(n,t)}catch(e){n=t}const s=await this.func(n,{config:r});if(s&&D.isRunnable(s)){if(0===r?.recursionLimit)throw new Error("Recursion limit reached.");const e=await s.stream(n,this._patchConfig(r,t?.getChild(),(r?.recursionLimit??25)-1));for await(const t of e)yield t}else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return I.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}class K extends D{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await a.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),n=await(r?.handleChainStart(this.toJSON(),M(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let s;for(const r of this.runnables())try{const s=await r.invoke(e,this._patchConfig(t,n?.getChild()));return await(n?.handleChainEnd(M(s,"output"))),s}catch(e){void 0===s&&(s=e)}if(void 0===s)throw new Error("No error stored at end of fallback.");throw await(n?.handleChainError(s)),s}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");const n=this._getOptionsList(t??{},e.length),s=await Promise.all(n.map((e=>a.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),i=await Promise.all(s.map(((t,r)=>t?.handleChainStart(this.toJSON(),M(e[r],"input"),void 0,void 0,void 0,void 0,n[r].runName))));let o;for(const t of this.runnables())try{const s=await t.batch(e,i.map(((e,t)=>this._patchConfig(n[t],e?.getChild()))),r);return await Promise.all(i.map(((e,t)=>e?.handleChainEnd(M(s[t],"output"))))),s}catch(e){void 0===o&&(o=e)}if(!o)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(i.map((e=>e?.handleChainError(o)))),o}}function q(e){if("function"==typeof e)return new z({func:e});if(D.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[r,n]of Object.entries(e))t[r]=q(n);return new B({steps:t})}}class H extends D{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof B&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const n=this.mapper.getStepsKeys(),[s,a]=T(e),i=this.mapper.transform(a,this._patchConfig(r,t?.getChild())),o=i.next();for await(const e of s){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!n.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of i)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return I.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}class W extends D{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){return I.fromAsyncGenerator(this.transform(async function*(){yield e}(),t))}}},4075:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(6515);function s(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class a extends n.E{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=(r=e.start_time,n=e.id,`${new Date(r).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+n);var r,n;const s={...e};if(void 0!==s.parent_run_id){const e=this.runMap.get(s.parent_run_id);e&&(this._addChildRun(e,s),e.child_execution_order=Math.max(e.child_execution_order,s.child_execution_order),s.trace_id=e.trace_id,void 0!==e.dotted_order?s.dotted_order=[e.dotted_order,t].join("."):console.warn(`Parent run with UUID ${s.parent_run_id} not found.`))}else s.trace_id=s.id,s.dotted_order=t;this.runMap.set(s.id,s),await(this.onRunCreate?.(s))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,n,s,a,i,o){const c=this._getExecutionOrder(n),l=Date.now(),u=i?{...s,metadata:i}:s,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:a||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleChatModelStart(e,t,r,n,s,a,i,o){const c=this._getExecutionOrder(n),l=Date.now(),u=i?{...s,metadata:i}:s,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:a||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleLLMEnd(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onLLMEnd?.(r)),await this._endTrace(r),r}async handleLLMError(e,t){const r=this.runMap.get(t);if(!r||"llm"!==r?.run_type)throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onLLMError?.(r)),await this._endTrace(r),r}async handleChainStart(e,t,r,n,s,a,i,o){const c=this._getExecutionOrder(n),l=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:i??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(u),await(this.onChainStart?.(u)),u}async handleChainEnd(e,t,r,n,a){const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=s(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),void 0!==a?.inputs&&(i.inputs=s(a.inputs,"input")),await(this.onChainEnd?.(i)),await this._endTrace(i),i}async handleChainError(e,t,r,n,a){const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=e.message,i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),void 0!==a?.inputs&&(i.inputs=s(a.inputs,"input")),await(this.onChainError?.(i)),await this._endTrace(i),i}async handleToolStart(e,t,r,n,s,a,i){const o=this._getExecutionOrder(n),c=Date.now(),l={id:r,name:i??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(l),await(this.onToolStart?.(l)),l}async handleToolEnd(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onToolEnd?.(r)),await this._endTrace(r),r}async handleToolError(e,t){const r=this.runMap.get(t);if(!r||"tool"!==r?.run_type)throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onToolError?.(r)),await this._endTrace(r),r}async handleAgentAction(e,t){const r=this.runMap.get(t);if(!r||"chain"!==r?.run_type)return;const n=r;n.actions=n.actions||[],n.actions.push(e),n.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(r))}async handleAgentEnd(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(r)))}async handleRetrieverStart(e,t,r,n,s,a,i){const o=this._getExecutionOrder(n),c=Date.now(),l={id:r,name:i??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(l),await(this.onRetrieverStart?.(l)),l}async handleRetrieverEnd(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverEnd?.(r)),await this._endTrace(r),r}async handleRetrieverError(e,t){const r=this.runMap.get(t);if(!r||"retriever"!==r?.run_type)throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await(this.onRetrieverError?.(r)),await this._endTrace(r),r}async handleText(e,t){const r=this.runMap.get(t);r&&"chain"===r?.run_type&&(r.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(r)))}async handleLLMNewToken(e,t,r,n,s,a){const i=this.runMap.get(r);if(!i||"llm"!==i?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return i.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await(this.onLLMNewToken?.(i,e)),i}}},9636:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var n=r(2693),s=r(5860);const a=[400,401,402,403,404,405,406,407,408,409],i=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&a.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??i;const t=s.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>n((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise(((t,r)=>{e.signal?.addEventListener("abort",(()=>{r(new Error("AbortError"))}))}))]):this.call(t,...r)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},6374:(e,t,r)=>{"use strict";r.d(t,{lS:()=>i,sA:()=>a});const n=()=>"undefined"!=typeof Deno;let s;async function a(){if(void 0===s){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||n()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":n()?"deno":"other":"node",e})();s={library:"langchain-js",runtime:e}}return s}function i(e){try{return"undefined"!=typeof process?"MISSING_ENV_VAR"?.[e]:void 0}catch(e){return}}},8783:(e,t,r)=>{"use strict";r.d(t,{z:()=>Mr});var n={};r.r(n),r.d(n,{APIConnectionError:()=>O,APIConnectionTimeoutError:()=>P,APIError:()=>w,APIUserAbortError:()=>x,AuthenticationError:()=>T,BadRequestError:()=>I,ConflictError:()=>E,InternalServerError:()=>S,NotFoundError:()=>k,OpenAIError:()=>v,PermissionDeniedError:()=>A,RateLimitError:()=>j,UnprocessableEntityError:()=>C});const s="4.24.3";let a,i,o,c,l,u,d,h,p,m=!1,f=null,g=null,y=null,b=null;class _{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}a||function(e,t={auto:!1}){if(m)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(a)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${a}'\``);m=t.auto,a=e.kind,i=e.fetch,f=e.Request,g=e.Response,y=e.Headers,o=e.FormData,b=e.Blob,c=e.File,l=e.ReadableStream,u=e.getMultipartRequestOptions,d=e.getDefaultAgent,h=e.fileFromPath,p=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let r,n,s,a;try{r=fetch,n=Request,s=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:r,Request:n,Response:s,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new _(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class v extends Error{}class w extends v{constructor(e,t,r,n){super(`${w.makeMessage(e,t,r)}`),this.status=e,this.headers=n;const s=t;this.error=s,this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,r){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e)return new O({cause:ie(t)});const s=t?.error;return 400===e?new I(e,s,r,n):401===e?new T(e,s,r,n):403===e?new A(e,s,r,n):404===e?new k(e,s,r,n):409===e?new E(e,s,r,n):422===e?new C(e,s,r,n):429===e?new j(e,s,r,n):e>=500?new S(e,s,r,n):new w(e,s,r,n)}}class x extends w{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class O extends w{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class P extends O{constructor({message:e}={}){super({message:e??"Request timed out."})}}class I extends w{constructor(){super(...arguments),this.status=400}}class T extends w{constructor(){super(...arguments),this.status=401}}class A extends w{constructor(){super(...arguments),this.status=403}}class k extends w{constructor(){super(...arguments),this.status=404}}class E extends w{constructor(){super(...arguments),this.status=409}}class C extends w{constructor(){super(...arguments),this.status=422}}class j extends w{constructor(){super(...arguments),this.status=429}}class S extends w{}class N{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;const n=new R;return new N((async function*(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const r of async function*(){if(!e.body)throw t.abort(),new v("Attempted to iterate over a response with no body");const r=new Z,s=$(e.body);for await(const e of s)for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}())if(!s)if(r.data.startsWith("[DONE]"))s=!0;else if(null===r.event){let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if(e&&e.error)throw new w(void 0,e.error,void 0,void 0);yield e}s=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{s||t.abort()}}),t)}static fromReadableStream(e,t){let r=!1;return new N((async function*(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const t of async function*(){const t=new Z,r=$(e);for await(const e of r)for(const r of t.decode(e))yield r;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new N((()=>n(e)),this.controller),new N((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new l({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:s}=await t.next();if(s)return e.close();const a=r.encode(JSON.stringify(n)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class R{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){const r=e.indexOf(":");return-1!==r?[e.substring(0,r),":",e.substring(r+":".length)]:[e,"",""]}(e);return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class Z{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Z.NEWLINE_CHARS.has(t[t.length-1]||"");let n=t.split(Z.NEWLINE_REGEXP);return 1!==n.length||r?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),r||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new v(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new v(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new v("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function $(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}Z.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","","","","","\u2028","\u2029"]),Z.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;const M=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,D=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function L(e,t,r={}){if(e=await e,M(e)){const n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new c([n],t,r)}const n=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(D(e))t.push(await e.arrayBuffer());else{if(!F(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const r of e)t.push(r)}return t}(e);if(t||(t=function(e){return U(e.name)||U(e.filename)||U(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!r.type){const e=n[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new c(n,t,r)}const U=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,F=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],V=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],B=async e=>{const t=await z(e.body);return u(t,e)},z=async e=>{const t=new o;return await Promise.all(Object.entries(e||{}).map((([e,r])=>K(t,e,r)))),t},K=async(e,t,r)=>{if(void 0!==r){if(null==r)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if((e=>(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&D(e))(e)||M(e)||p(e))(r)){const n=await L(r);e.append(t,n)}else if(Array.isArray(r))await Promise.all(r.map((r=>K(e,t+"[]",r))));else{if("object"!=typeof r)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`);await Promise.all(Object.entries(r).map((([r,n])=>K(e,`${t}[${r}]`,n))))}}};var q;async function H(e){const{response:t}=e;if(e.options.stream)return de("response",t.status,t.url,t.headers,t.body),N.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;if(t.headers.get("content-type")?.includes("application/json")){const e=await t.json();return de("response",t.status,t.url,t.headers,e),e}const r=await t.text();return de("response",t.status,t.url,t.headers,r),r}class W extends Promise{constructor(e,t=H){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new W(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class J{constructor(e,t,r,n){q.set(this,void 0),function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?s.call(e,r):s?s.value=r:t.set(e,r)}(this,q,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new v("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,n]of r)e.url.searchParams.set(t,n);t.query=void 0,t.path=e.url.toString()}return await function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,q,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(q=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class G extends W{constructor(e,t,r){super(t,(async t=>new r(e,t.response,await H(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const X={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0},Y=e=>"object"==typeof e&&null!==e&&!ce(e)&&Object.keys(e).every((e=>le(X,e))),Q=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ee=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let te;const re=()=>te??(te=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":ee(Deno.build.os),"X-Stainless-Arch":Q(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":ee(process.platform),"X-Stainless-Arch":Q(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:r}of e){const e=r.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),ne=new RegExp("^(?:[a-z]+:)?//","i"),se=e=>new Promise((t=>setTimeout(t,e))),ae=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new v(`${e} must be an integer`);if(t<0)throw new v(`${e} must be a positive integer`);return t},ie=e=>e instanceof Error?e:new Error(e),oe=e=>"undefined"!=typeof process?"MISSING_ENV_VAR"?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function ce(e){if(!e)return!0;for(const t in e)return!1;return!0}function le(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ue(e,t){for(const r in t){if(!le(t,r))continue;const n=r.toLowerCase();if(!n)continue;const s=t[r];null===s?delete e[n]:void 0!==s&&(e[n]=s)}}function de(e,...t){"undefined"!=typeof process&&"true"==="MISSING_ENV_VAR".DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}class he extends J{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class pe extends J{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class me{constructor(e){this._client=e}}class fe extends me{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}fe||(fe={});class ge extends me{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}ge||(ge={});class ye extends me{constructor(){super(...arguments),this.completions=new ge(this._client)}}!function(e){e.Completions=ge}(ye||(ye={}));class be extends me{create(e,t){return this._client.post("/edits",{body:e,...t})}}be||(be={});class _e extends me{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}_e||(_e={});class ve extends me{create(e,t){return this._client.post("/files",B({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/files",we,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){const n=new Set(["processed","error","deleted"]),s=Date.now();let a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await se(t),a=await this.retrieve(e),Date.now()-s>r)throw new P({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class we extends he{}!function(e){e.FileObjectsPage=we}(ve||(ve={}));class xe extends me{createVariation(e,t){return this._client.post("/images/variations",B({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",B({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}xe||(xe={});class Oe extends me{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Oe||(Oe={});class Pe extends me{create(e,t){return this._client.post("/audio/transcriptions",B({body:e,...t}))}}Pe||(Pe={});class Ie extends me{create(e,t){return this._client.post("/audio/translations",B({body:e,...t}))}}Ie||(Ie={});class Te extends me{constructor(){super(...arguments),this.transcriptions=new Pe(this._client),this.translations=new Ie(this._client),this.speech=new Oe(this._client)}}!function(e){e.Transcriptions=Pe,e.Translations=Ie,e.Speech=Oe}(Te||(Te={}));class Ae extends me{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Ae||(Ae={});class ke extends me{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ee,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Ee extends he{}!function(e){e.ModelsPage=Ee}(ke||(ke={}));class Ce extends me{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",je,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Y(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Se,{query:t,...r})}}class je extends pe{}class Se extends pe{}!function(e){e.FineTuningJobsPage=je,e.FineTuningJobEventsPage=Se}(Ce||(Ce={}));class Ne extends me{constructor(){super(...arguments),this.jobs=new Ce(this._client)}}!function(e){e.Jobs=Ce,e.FineTuningJobsPage=je,e.FineTuningJobEventsPage=Se}(Ne||(Ne={}));class Re extends me{create(e,t){return this._client.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine-tunes/${e}`,t)}list(e){return this._client.getAPIList("/fine-tunes",Ze,e)}cancel(e,t){return this._client.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){return this._client.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:t?.stream??!1})}}class Ze extends he{}!function(e){e.FineTunesPage=Ze}(Re||(Re={}));class $e extends me{create(e,t,r){return this._client.post(`/assistants/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t={},r){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,Me,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}del(e,t,r){return this._client.delete(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class Me extends pe{}!function(e){e.AssistantFilesPage=Me}($e||($e={}));class De extends me{constructor(){super(...arguments),this.files=new $e(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/assistants",Le,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}class Le extends pe{}function Ue(e){return"function"==typeof e.parse}!function(e){e.AssistantsPage=Le,e.Files=$e,e.AssistantFilesPage=Me}(De||(De={}));const Fe=e=>"assistant"===e?.role,Ve=e=>"function"===e?.role,Be=e=>"tool"===e?.role;var ze,Ke,qe,He,We,Je,Ge,Xe,Ye,Qe,et,tt,rt,nt,st,at,it,ot,ct,lt,ut=function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},dt=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const ht=10;class pt{constructor(){ze.add(this),this.controller=new AbortController,Ke.set(this,void 0),qe.set(this,(()=>{})),He.set(this,(()=>{})),We.set(this,void 0),Je.set(this,(()=>{})),Ge.set(this,(()=>{})),Xe.set(this,{}),this._chatCompletions=[],this.messages=[],Ye.set(this,!1),Qe.set(this,!1),et.set(this,!1),tt.set(this,!1),ot.set(this,(e=>{if(ut(this,Qe,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new x),e instanceof x)return ut(this,et,!0,"f"),this._emit("abort",e);if(e instanceof v)return this._emit("error",e);if(e instanceof Error){const t=new v(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new v(String(e)))})),ut(this,Ke,new Promise(((e,t)=>{ut(this,qe,e,"f"),ut(this,He,t,"f")})),"f"),ut(this,We,new Promise(((e,t)=>{ut(this,Je,e,"f"),ut(this,Ge,t,"f")})),"f"),dt(this,Ke,"f").catch((()=>{})),dt(this,We,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),dt(this,ot,"f"))}),0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Ve(e)||Be(e))&&e.content)this._emit("functionCallResult",e.content);else if(Fe(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Fe(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}_connected(){this.ended||(dt(this,qe,"f").call(this),this._emit("connect"))}get ended(){return dt(this,Ye,"f")}get errored(){return dt(this,Qe,"f")}get aborted(){return dt(this,et,"f")}abort(){this.controller.abort()}on(e,t){return(dt(this,Xe,"f")[e]||(dt(this,Xe,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=dt(this,Xe,"f")[e];if(!r)return this;const n=r.findIndex((e=>e.listener===t));return n>=0&&r.splice(n,1),this}once(e,t){return(dt(this,Xe,"f")[e]||(dt(this,Xe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,r)=>{ut(this,tt,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)}))}async done(){ut(this,tt,!0,"f"),await dt(this,We,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new v("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),dt(this,ze,"m",rt).call(this)}async finalMessage(){return await this.done(),dt(this,ze,"m",nt).call(this)}async finalFunctionCall(){return await this.done(),dt(this,ze,"m",st).call(this)}async finalFunctionCallResult(){return await this.done(),dt(this,ze,"m",at).call(this)}async totalUsage(){return await this.done(),dt(this,ze,"m",it).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(dt(this,Ye,"f"))return;"end"===e&&(ut(this,Ye,!0,"f"),dt(this,Je,"f").call(this));const r=dt(this,Xe,"f")[e];if(r&&(dt(this,Xe,"f")[e]=r.filter((e=>!e.once)),r.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return dt(this,tt,"f")||r?.length||Promise.reject(e),dt(this,He,"f").call(this,e),dt(this,Ge,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];dt(this,tt,"f")||r?.length||Promise.reject(e),dt(this,He,"f").call(this,e),dt(this,Ge,"f").call(this,e),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=dt(this,ze,"m",nt).call(this);t&&this._emit("finalMessage",t);const r=dt(this,ze,"m",rt).call(this);r&&this._emit("finalContent",r);const n=dt(this,ze,"m",st).call(this);n&&this._emit("finalFunctionCall",n);const s=dt(this,ze,"m",at).call(this);null!=s&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",dt(this,ze,"m",it).call(this))}async _createChatCompletion(e,t,r){const n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),dt(this,ze,"m",ct).call(this,t);const s=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(s)}async _runChatCompletion(e,t,r){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){const n="function",{function_call:s="auto",stream:a,...i}=t,o="string"!=typeof s&&s?.name,{maxChatCompletions:c=ht}=r||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=(await this._createChatCompletion(e,{...i,function_call:s,functions:u,messages:[...this.messages]},r)).choices[0]?.message;if(!t)throw new v("missing message in ChatCompletion response");if(!t.function_call)return;const{name:a,arguments:c}=t.function_call,d=l[a];if(!d){const e=`Invalid function_call: ${JSON.stringify(a)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:n,name:a,content:e});continue}if(o&&o!==a){const e=`Invalid function_call: ${JSON.stringify(a)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,name:a,content:e});continue}let h;try{h=Ue(d)?await d.parse(c):c}catch(e){this._addMessage({role:n,name:a,content:e instanceof Error?e.message:String(e)});continue}const p=await d.function(h,this),m=dt(this,ze,"m",lt).call(this,p);if(this._addMessage({role:n,name:a,content:m}),o)return}}async _runTools(e,t,r){const n="tool",{tool_choice:s="auto",stream:a,...i}=t,o="string"!=typeof s&&s?.function?.name,{maxChatCompletions:c=ht}=r||{},l={};for(const e of t.tools)"function"===e.type&&(l[e.function.name||e.function.function.name]=e.function);const u="tools"in t?t.tools.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=(await this._createChatCompletion(e,{...i,tool_choice:s,tools:u,messages:[...this.messages]},r)).choices[0]?.message;if(!t)throw new v("missing message in ChatCompletion response");if(!t.tool_calls)return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:r,arguments:s}=e.function,a=l[r];if(!a){const e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${u.map((e=>JSON.stringify(e.function.name))).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}if(o&&o!==r){const e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}let i;try{i=Ue(a)?await a.parse(s):s}catch(e){const r=e instanceof Error?e.message:String(e);this._addMessage({role:n,tool_call_id:t,content:r});continue}const c=await a.function(i,this),d=dt(this,ze,"m",lt).call(this,c);if(this._addMessage({role:n,tool_call_id:t,content:d}),o)return}}}}Ke=new WeakMap,qe=new WeakMap,He=new WeakMap,We=new WeakMap,Je=new WeakMap,Ge=new WeakMap,Xe=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,et=new WeakMap,tt=new WeakMap,ot=new WeakMap,ze=new WeakSet,rt=function(){return dt(this,ze,"m",nt).call(this).content??null},nt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Fe(t))return{...t,content:t.content??null}}throw new v("stream ended without producing a ChatCompletionMessage with role=assistant")},st=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Fe(t)&&t?.function_call)return t.function_call;if(Fe(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},at=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ve(t)&&null!=t.content)return t.content;if(Be(t)&&null!=t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},it=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ct=function(e){if(null!=e.n&&e.n>1)throw new v("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},lt=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class mt extends pt{static runFunctions(e,t,r){const n=new mt,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,s))),n}static runTools(e,t,r){const n=new mt,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,s))),n}_addMessage(e){super._addMessage(e),Fe(e)&&e.content&&this._emit("content",e.content)}}var ft,gt,yt,bt,_t,vt,wt,xt=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Ot=function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r};class Pt extends pt{constructor(){super(...arguments),ft.add(this),gt.set(this,void 0)}get currentChatCompletionSnapshot(){return xt(this,gt,"f")}static fromReadableStream(e){const t=new Pt;return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,r){const n=new Pt;return n._run((()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}async _createChatCompletion(e,t,r){const n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),xt(this,ft,"m",yt).call(this);const s=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const e of s)xt(this,ft,"m",bt).call(this,e);if(s.controller.signal?.aborted)throw new x;return this._addChatCompletion(xt(this,ft,"m",_t).call(this))}async _fromReadableStream(e,t){const r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),xt(this,ft,"m",yt).call(this),this._connected();const n=N.fromReadableStream(e,this.controller);let s;for await(const e of n)s&&s!==e.id&&this._addChatCompletion(xt(this,ft,"m",_t).call(this)),xt(this,ft,"m",bt).call(this,e),s=e.id;if(n.controller.signal?.aborted)throw new x;return this._addChatCompletion(xt(this,ft,"m",_t).call(this))}[(gt=new WeakMap,ft=new WeakSet,yt=function(){this.ended||Ot(this,gt,void 0,"f")},bt=function(e){if(this.ended)return;const t=xt(this,ft,"m",vt).call(this,e);this._emit("chunk",e,t);const r=e.choices[0]?.delta?.content,n=t.choices[0]?.message;null!=r&&"assistant"===n?.role&&n?.content&&this._emit("content",r,n.content)},_t=function(){if(this.ended)throw new v("stream has ended, this shouldn't happen");const e=xt(this,gt,"f");if(!e)throw new v("request ended without sending any chunks");return Ot(this,gt,void 0,"f"),function(e){const{id:t,choices:r,created:n,model:s}=e;return{id:t,choices:r.map((({message:t,finish_reason:r,index:n,logprobs:s})=>{if(!r)throw new v(`missing finish_reason for choice ${n}`);const{content:a=null,function_call:i,tool_calls:o}=t,c=t.role;if(!c)throw new v(`missing role for choice ${n}`);if(i){const{arguments:e,name:t}=i;if(null==e)throw new v(`missing function_call.arguments for choice ${n}`);if(!t)throw new v(`missing function_call.name for choice ${n}`);return{message:{content:a,function_call:{arguments:e,name:t},role:c},finish_reason:r,index:n,logprobs:s}}return o?{index:n,finish_reason:r,logprobs:s,message:{role:c,content:a,tool_calls:o.map(((t,r)=>{const{function:s,type:a,id:i}=t,{arguments:o,name:c}=s||{};if(null==i)throw new v(`missing choices[${n}].tool_calls[${r}].id\n${It(e)}`);if(null==a)throw new v(`missing choices[${n}].tool_calls[${r}].type\n${It(e)}`);if(null==c)throw new v(`missing choices[${n}].tool_calls[${r}].function.name\n${It(e)}`);if(null==o)throw new v(`missing choices[${n}].tool_calls[${r}].function.arguments\n${It(e)}`);return{id:i,type:a,function:{name:c,arguments:o}}}))}}:{message:{content:a,role:c},finish_reason:r,index:n,logprobs:s}})),created:n,model:s,object:"chat.completion"}}(e)},vt=function(e){var t,r,n;let s=xt(this,gt,"f");const{choices:a,...i}=e;s?Object.assign(s,i):s=Ot(this,gt,{...i,choices:[]},"f");for(const{delta:a,finish_reason:i,index:o,logprobs:c=null,...l}of e.choices){let e=s.choices[o];if(!e){s.choices[o]={finish_reason:i,index:o,message:a,logprobs:c,...l};continue}if(c&&(e.logprobs?c.content&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...c.content)):e.logprobs=c),i&&(e.finish_reason=i),Object.assign(e,l),!a)continue;const{content:u,function_call:d,role:h,tool_calls:p}=a;if(u&&(e.message.content=(e.message.content||"")+u),h&&(e.message.role=h),d&&(e.message.function_call?(d.name&&(e.message.function_call.name=d.name),d.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=d.arguments)):e.message.function_call=d),p){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:r,type:s,function:a}of p){const i=(n=e.message.tool_calls)[t]??(n[t]={});r&&(i.id=r),s&&(i.type=s),a&&(i.function??(i.function={arguments:""})),a?.name&&(i.function.name=a.name),a?.arguments&&(i.function.arguments+=a.arguments)}}}return s},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",(r=>{const n=t.shift();n?n(r):e.push(r)})),this.on("end",(()=>{r=!0;for(const e of t)e(void 0);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e=>t.push(e))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}))}}toReadableStream(){return new N(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function It(e){return JSON.stringify(e)}class Tt extends Pt{static fromReadableStream(e){const t=new Tt;return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,r){const n=new Tt,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,s))),n}static runTools(e,t,r){const n=new Tt,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,s))),n}}class At extends me{runFunctions(e,t){return e.stream?Tt.runFunctions(this._client.chat.completions,e,t):mt.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Tt.runTools(this._client.chat.completions,e,t):mt.runTools(this._client.chat.completions,e,t)}stream(e,t){return Pt.createChatCompletion(this._client.chat.completions,e,t)}}class kt extends me{constructor(){super(...arguments),this.completions=new At(this._client)}}!function(e){e.Completions=At}(kt||(kt={}));class Et extends me{retrieve(e,t,r,n){return this._client.get(`/threads/${e}/messages/${t}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e,t,r={},n){return Y(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,Ct,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class Ct extends pe{}!function(e){e.MessageFilesPage=Ct}(Et||(Et={}));class jt extends me{constructor(){super(...arguments),this.files=new Et(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e,t={},r){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,St,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class St extends pe{}!function(e){e.ThreadMessagesPage=St,e.Files=Et,e.MessageFilesPage=Ct}(jt||(jt={}));class Nt extends me{retrieve(e,t,r,n){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e,t,r={},n){return Y(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Rt,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class Rt extends pe{}!function(e){e.RunStepsPage=Rt}(Nt||(Nt={}));class Zt extends me{constructor(){super(...arguments),this.steps=new Nt(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e,t={},r){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,$t,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}submitToolOutputs(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class $t extends pe{}!function(e){e.RunsPage=$t,e.Steps=Nt,e.RunStepsPage=Rt}(Zt||(Zt={}));class Mt extends me{constructor(){super(...arguments),this.runs=new Zt(this._client),this.messages=new jt(this._client)}create(e={},t){return Y(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}!function(e){e.Runs=Zt,e.RunsPage=$t,e.Messages=jt,e.ThreadMessagesPage=St}(Mt||(Mt={}));class Dt extends me{constructor(){super(...arguments),this.chat=new kt(this._client),this.assistants=new De(this._client),this.threads=new Mt(this._client)}}!function(e){e.Chat=kt,e.Assistants=De,e.AssistantsPage=Le,e.Threads=Mt}(Dt||(Dt={}));class Lt extends class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:s}){this.baseURL=e,this.maxRetries=ae("maxRetries",t),this.timeout=ae("timeout",r),this.httpAgent=n,this.fetch=s??i}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...re(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then((r=>({method:e,path:t,...r}))))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}return null}buildRequest(e){const{method:t,path:r,query:n,headers:s={}}=e,a=V(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,i=this.calculateContentLength(a),o=this.buildURL(r,n);"timeout"in e&&ae("timeout",e.timeout);const c=e.timeout??this.timeout,l=e.httpAgent??this.httpAgent??d(o),u=c+1e3;return"number"==typeof l?.options?.timeout&&u>(l.options.timeout??0)&&(l.options.timeout=u),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...a&&{body:a},headers:this.buildHeaders({options:e,headers:s,contentLength:i}),...l&&{agent:l},signal:e.signal??null},url:o,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r}){const n={};return r&&(n["content-length"]=r),ue(n,this.defaultHeaders(e)),ue(n,t),V(e.body)&&"node"!==a&&delete n["content-type"],this.validateHeaders(n,t),n}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,r,n){return w.generate(e,t,r,n)}request(e,t=null){return new W(this.makeRequest(e,t))}async makeRequest(e,t){const r=await e;null==t&&(t=r.maxRetries??this.maxRetries);const{req:n,url:s,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(n,{url:s,options:r}),de("request",s,r,n.headers),r.signal?.aborted)throw new x;const i=new AbortController,o=await this.fetchWithTimeout(s,n,a,i).catch(ie);if(o instanceof Error){if(r.signal?.aborted)throw new x;if(t)return this.retryRequest(r,t);if("AbortError"===o.name)throw new P;throw new O({cause:o})}const c=(l=o.headers,new Proxy(Object.fromEntries(l.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}));var l;if(!o.ok){if(t&&this.shouldRetry(o))return this.retryRequest(r,t,c);const e=await o.text().catch((e=>ie(e).message)),n=(e=>{try{return JSON.parse(e)}catch(e){return}})(e),a=n?void 0:e;throw de("response",o.status,s,c,a),this.makeStatusError(o.status,n,a,c)}return{response:o,options:r,controller:i}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new G(this,r,e)}buildURL(e,t){const r=(e=>ne.test(e))(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return ce(n)||(t={...n,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new v(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,r,n){const{signal:s,...a}=t||{};s&&s.addEventListener("abort",(()=>n.abort()));const i=setTimeout((()=>n.abort()),r);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...a}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let n;const s=r?.["retry-after"];if(s){const e=parseInt(s);n=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!n||!Number.isInteger(n)||n<=0||n>6e4){const r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await se(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e;return Math.min(.5*Math.pow(2,r),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS 4.24.3`}}{constructor({baseURL:e=oe("OPENAI_BASE_URL"),apiKey:t=oe("OPENAI_API_KEY"),organization:r=oe("OPENAI_ORG_ID")??null,...n}={}){if(void 0===t)throw new v("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const s={apiKey:t,organization:r,...n,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new v("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new fe(this),this.chat=new ye(this),this.edits=new be(this),this.embeddings=new _e(this),this.files=new ve(this),this.images=new xe(this),this.audio=new Te(this),this.moderations=new Ae(this),this.models=new ke(this),this.fineTuning=new Ne(this),this.fineTunes=new Re(this),this.beta=new Dt(this),this._options=s,this.apiKey=t,this.organization=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}wt=Lt,Lt.OpenAI=wt,Lt.OpenAIError=v,Lt.APIError=w,Lt.APIConnectionError=O,Lt.APIConnectionTimeoutError=P,Lt.APIUserAbortError=x,Lt.NotFoundError=k,Lt.ConflictError=E,Lt.RateLimitError=j,Lt.BadRequestError=I,Lt.AuthenticationError=T,Lt.InternalServerError=S,Lt.PermissionDeniedError=A,Lt.UnprocessableEntityError=C;const{OpenAIError:Ut,APIError:Ft,APIConnectionError:Vt,APIConnectionTimeoutError:Bt,APIUserAbortError:zt,NotFoundError:Kt,ConflictError:qt,RateLimitError:Ht,BadRequestError:Wt,AuthenticationError:Jt,InternalServerError:Gt,PermissionDeniedError:Xt,UnprocessableEntityError:Yt}=n;var Qt;(Qt=Lt||(Lt={})).toFile=L,Qt.fileFromPath=h,Qt.Page=he,Qt.CursorPage=pe,Qt.Completions=fe,Qt.Chat=ye,Qt.Edits=be,Qt.Embeddings=_e,Qt.Files=ve,Qt.FileObjectsPage=we,Qt.Images=xe,Qt.Audio=Te,Qt.Moderations=Ae,Qt.Models=ke,Qt.ModelsPage=Ee,Qt.FineTuning=Ne,Qt.FineTunes=Re,Qt.FineTunesPage=Ze,Qt.Beta=Dt;var er=r(3908);const tr="__run";class rr{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new rr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class nr extends rr{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new nr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}var sr=r(6374),ar="object"==typeof window?window:{},ir="0123456789abcdef".split(""),or=[-2147483648,8388608,32768,128],cr=[24,16,8,0],lr=[];function ur(e){e?(lr[0]=lr[16]=lr[1]=lr[2]=lr[3]=lr[4]=lr[5]=lr[6]=lr[7]=lr[8]=lr[9]=lr[10]=lr[11]=lr[12]=lr[13]=lr[14]=lr[15]=0,this.blocks=lr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ur.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===ar.ArrayBuffer&&(e=new Uint8Array(e));for(var r,n,s=0,a=e.length||0,i=this.blocks;s<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)for(n=this.start;s<a&&n<64;++s)i[n>>2]|=e[s]<<cr[3&n++];else for(n=this.start;s<a&&n<64;++s)(r=e.charCodeAt(s))<128?i[n>>2]|=r<<cr[3&n++]:r<2048?(i[n>>2]|=(192|r>>6)<<cr[3&n++],i[n>>2]|=(128|63&r)<<cr[3&n++]):r<55296||r>=57344?(i[n>>2]|=(224|r>>12)<<cr[3&n++],i[n>>2]|=(128|r>>6&63)<<cr[3&n++],i[n>>2]|=(128|63&r)<<cr[3&n++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++s)),i[n>>2]|=(240|r>>18)<<cr[3&n++],i[n>>2]|=(128|r>>12&63)<<cr[3&n++],i[n>>2]|=(128|r>>6&63)<<cr[3&n++],i[n>>2]|=(128|63&r)<<cr[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=i[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},ur.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=or[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},ur.prototype.hash=function(){var e,t,r=this.h0,n=this.h1,s=this.h2,a=this.h3,i=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)r=(t=(n=(t=(s=(t=(a=(t=(i=(t=r<<5|r>>>27)+(n&s|~n&a)+i+1518500249+o[e]<<0)<<5|i>>>27)+(r&(n=n<<30|n>>>2)|~r&s)+a+1518500249+o[e+1]<<0)<<5|a>>>27)+(i&(r=r<<30|r>>>2)|~i&n)+s+1518500249+o[e+2]<<0)<<5|s>>>27)+(a&(i=i<<30|i>>>2)|~a&r)+n+1518500249+o[e+3]<<0)<<5|n>>>27)+(s&(a=a<<30|a>>>2)|~s&i)+r+1518500249+o[e+4]<<0,s=s<<30|s>>>2;for(;e<40;e+=5)r=(t=(n=(t=(s=(t=(a=(t=(i=(t=r<<5|r>>>27)+(n^s^a)+i+1859775393+o[e]<<0)<<5|i>>>27)+(r^(n=n<<30|n>>>2)^s)+a+1859775393+o[e+1]<<0)<<5|a>>>27)+(i^(r=r<<30|r>>>2)^n)+s+1859775393+o[e+2]<<0)<<5|s>>>27)+(a^(i=i<<30|i>>>2)^r)+n+1859775393+o[e+3]<<0)<<5|n>>>27)+(s^(a=a<<30|a>>>2)^i)+r+1859775393+o[e+4]<<0,s=s<<30|s>>>2;for(;e<60;e+=5)r=(t=(n=(t=(s=(t=(a=(t=(i=(t=r<<5|r>>>27)+(n&s|n&a|s&a)+i-1894007588+o[e]<<0)<<5|i>>>27)+(r&(n=n<<30|n>>>2)|r&s|n&s)+a-1894007588+o[e+1]<<0)<<5|a>>>27)+(i&(r=r<<30|r>>>2)|i&n|r&n)+s-1894007588+o[e+2]<<0)<<5|s>>>27)+(a&(i=i<<30|i>>>2)|a&r|i&r)+n-1894007588+o[e+3]<<0)<<5|n>>>27)+(s&(a=a<<30|a>>>2)|s&i|a&i)+r-1894007588+o[e+4]<<0,s=s<<30|s>>>2;for(;e<80;e+=5)r=(t=(n=(t=(s=(t=(a=(t=(i=(t=r<<5|r>>>27)+(n^s^a)+i-899497514+o[e]<<0)<<5|i>>>27)+(r^(n=n<<30|n>>>2)^s)+a-899497514+o[e+1]<<0)<<5|a>>>27)+(i^(r=r<<30|r>>>2)^n)+s-899497514+o[e+2]<<0)<<5|s>>>27)+(a^(i=i<<30|i>>>2)^r)+n-899497514+o[e+3]<<0)<<5|n>>>27)+(s^(a=a<<30|a>>>2)^i)+r-899497514+o[e+4]<<0,s=s<<30|s>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+n<<0,this.h2=this.h2+s<<0,this.h3=this.h3+a<<0,this.h4=this.h4+i<<0},ur.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,s=this.h4;return ir[e>>28&15]+ir[e>>24&15]+ir[e>>20&15]+ir[e>>16&15]+ir[e>>12&15]+ir[e>>8&15]+ir[e>>4&15]+ir[15&e]+ir[t>>28&15]+ir[t>>24&15]+ir[t>>20&15]+ir[t>>16&15]+ir[t>>12&15]+ir[t>>8&15]+ir[t>>4&15]+ir[15&t]+ir[r>>28&15]+ir[r>>24&15]+ir[r>>20&15]+ir[r>>16&15]+ir[r>>12&15]+ir[r>>8&15]+ir[r>>4&15]+ir[15&r]+ir[n>>28&15]+ir[n>>24&15]+ir[n>>20&15]+ir[n>>16&15]+ir[n>>12&15]+ir[n>>8&15]+ir[n>>4&15]+ir[15&n]+ir[s>>28&15]+ir[s>>24&15]+ir[s>>20&15]+ir[s>>16&15]+ir[s>>12&15]+ir[s>>8&15]+ir[s>>4&15]+ir[15&s]},ur.prototype.toString=ur.prototype.hex,ur.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,s=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,s>>24&255,s>>16&255,s>>8&255,255&s]},ur.prototype.array=ur.prototype.digest,ur.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const dr=(...e)=>{return t=e.join("_"),new ur(!0).update(t).hex();var t},hr=new Map;class pr extends class{}{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(dr(e,t))??null)}async update(e,t,r){this.cache.set(dr(e,t),r)}static global(){return new pr(hr)}}var mr=r(1141),fr=r(9636),gr=r(9742),yr=Object.defineProperty;function br(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let r=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;r.length>1;){let n=null;for(let s=0;s<r.length-1;s++){const a=e.slice(r[s].start,r[s+1].end),i=t.get(a.join(","));null!=i&&(null==n||i<n[0])&&(n=[i,s])}if(null==n)break;{const e=n[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}}return r}(e,t).map((r=>t.get(e.slice(r.start,r.end).join(",")))).filter((e=>null!=e))}var _r,vr,wr=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const r=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[r,n,...s]=t.split(" "),a=Number.parseInt(n,10);return s.forEach(((t,r)=>e[t]=a+r)),e}),{});for(const[e,t]of Object.entries(r)){const r=gr.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],r="all"){const n=new RegExp(this.patStr,"ug"),s=wr.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter((e=>!i.has(e))):r);if(o.size>0){const t=wr.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw new Error(`The text contains a special token that is not allowed: ${r[0]}`)}let c=0;for(;;){let t=null,r=c;for(;s.lastIndex=r,t=s.exec(e),null!=t&&!i.has(t[0]);)r=t.index+1;const o=t?.index??e.length;for(const t of e.substring(c,o).matchAll(n)){const e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));null==r?a.push(...br(e,this.rankMap)):a.push(r)}if(null==t)break;let l=this.specialTokens[t[0]];a.push(l),c=t.index+t[0].length}return a}decode(e){const t=[];let r=0;for(let n=0;n<e.length;++n){const s=e[n],a=this.textMap.get(s)??this.inverseSpecialTokens[s];null!=a&&(t.push(a),r+=a.length)}const n=new Uint8Array(r);let s=0;for(const e of t)n.set(e,s),s+=e.length;return this.textDecoder.decode(n)}},xr=wr;vr=e=>new RegExp(e.map((e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e))).join("|"),"g"),((e,t,r)=>{t in e?yr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(xr,"symbol"!=typeof(_r="specialTokenRegex")?_r+"":_r,vr);const Or={},Pr=new fr.L({});var Ir=r(2399);class Tr extends Ir.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class Ar extends Tr{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=pr.global():this.cache=void 0,this.caller=new fr.L(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await async function(e){return async function(e){return e in Or||(Or[e]=Pr.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new xr(e))).catch((t=>{throw delete Or[e],t}))),await Or[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}(e))}("modelName"in this?(r=this.modelName,r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}var r;if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new mr.nw(e):Array.isArray(e)?new mr.GU(e.map(er.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){const t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()},r=Object.entries(t).filter((([e,t])=>void 0!==t)),n=r.map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",");return n}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}var kr=r(3905);class Er extends Ar{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r?.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=Er._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===Er.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=Er._convertInputToPromptValue(e).toChatMessages(),[n,s]=this._separateRunnableConfigFromCallOptions(t),a=await kr.Ye.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),i={options:s,invocation_params:this?.invocationParams(s),batch_size:1},o=await(a?.handleChatModelStart(this.toJSON(),[r],void 0,void 0,i,void 0,void 0,n.runName));let c;try{for await(const e of this._streamResponseChunks(r,s,o?.[0]))yield e.message,c=c?c.concat(e):e}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[c]]}))))}}async _generateUncached(e,t,r){const n=e.map((e=>e.map(er.E1))),s=await kr.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this?.invocationParams(t),batch_size:1},i=await(s?.handleChatModelStart(this.toJSON(),n,void 0,void 0,a,void 0,void 0,r.runName)),o=await Promise.allSettled(n.map(((e,r)=>this._generate(e,{...t,promptIndex:r},i?.[r])))),c=[],l=[];await Promise.all(o.map((async(e,t)=>{if("fulfilled"===e.status){const r=e.value;return c[t]=r.generations,l[t]=r.llmOutput,i?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}return await(i?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const u={generations:c,llmOutput:l.length?this._combineLLMOutput?.(...l):void 0};return Object.defineProperty(u,tr,{value:i?{runIds:i?.map((e=>e.runId))}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:n,handledOptions:s}){const a=e.map((e=>e.map(er.E1))),i=await kr.Ye.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),o={options:n,invocation_params:this?.invocationParams(n),batch_size:1,cached:!0},c=await(i?.handleChatModelStart(this.toJSON(),a,void 0,void 0,o,void 0,void 0,s.runName)),l=[],u=(await Promise.allSettled(a.map((async(e,n)=>{const s=Er._convertInputToPromptValue(e).toString(),a=await t.lookup(s,r);return null==a&&l.push(n),a})))).map(((e,t)=>({result:e,runManager:c?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),d=[];await Promise.all(u.map((async({result:e,runManager:t},r)=>{if("fulfilled"===e.status){const n=e.value;return d[r]=n,n.length&&await(t?.handleLLMNewToken(n[0].text)),t?.handleLLMEnd({generations:[n]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const h={generations:d,missingPromptIndices:l};return Object.defineProperty(h,tr,{value:c?{runIds:c?.map((e=>e.runId))}:void 0,configurable:!0}),h}async generate(e,t,r){let n;n=Array.isArray(t)?{stop:t}:t;const s=e.map((e=>e.map(er.E1))),[a,i]=this._separateRunnableConfigFromCallOptions(n);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(s,i,a);const{cache:o}=this,c=this._getSerializedCacheKeyParametersForCall(i),{generations:l,missingPromptIndices:u}=await this._generateCached({messages:s,cache:o,llmStringKey:c,parsedOptions:i,handledOptions:a});let d={};if(u.length>0){const e=await this._generateUncached(u.map((e=>s[e])),i,a);await Promise.all(e.generations.map((async(e,t)=>{const r=u[t];l[r]=e;const n=Er._convertInputToPromptValue(s[r]).toString();return o.update(n,c,e)}))),d=e.llmOutput??{}}return{generations:l,llmOutput:d}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const n=e.map((e=>e.toChatMessages()));return this.generate(n,t,r)}async call(e,t,r){return(await this.generate([e.map(er.E1)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const n=e.toChatMessages();return this.call(n,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const n=new er.xk(e),s=await this.call([n],t,r);if("string"!=typeof s.content)throw new Error("Cannot use predict when output is not a string.");return s.content}}var Cr=r(8841);function jr(e){const t=(0,Cr.Y_)(e.schema);return{type:"function",function:{name:e.name,description:e.description,parameters:t}}}function Sr(e,t){const r=[];for(const[n,s]of Object.entries(e.properties??{}))s.description&&t<2&&r.push(`// ${s.description}`),e.required?.includes(n)?r.push(`${n}: ${Nr(s,t)},`):r.push(`${n}?: ${Nr(s,t)},`);return r.map((e=>" ".repeat(t)+e)).join("\n")}function Nr(e,t){if(void 0!==(r=e).anyOf&&Array.isArray(r.anyOf))return e.anyOf.map((e=>Nr(e,t))).join(" | ");var r;switch(e.type){case"string":return e.enum?e.enum.map((e=>`"${e}"`)).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map((e=>`${e}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Sr(e,t+2),"}"].join("\n");case"array":return e.items?`${Nr(e.items,t)}[]`:"any[]";default:return""}}function Rr(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!er.J.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function Zr(e,t){const r=e.role??t,n=e.content??"";let s;return s=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},"user"===r?new er.ro({content:n}):"assistant"===r?new er.GC({content:n,additional_kwargs:s}):"system"===r?new er.xq({content:n}):"function"===r?new er.Cr({content:n,additional_kwargs:s,name:e.name}):"tool"===r?new er.Xz({content:n,additional_kwargs:s,tool_call_id:e.tool_call_id}):new er.HD({content:n,role:r})}function $r(e){return e.map((e=>({role:Rr(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id})))}class Mr extends Er{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,sr.lS)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,sr.lS)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,sr.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,sr.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,sr.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,sr.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,sr.lS)("OPENAI_ORGANIZATION"),this.modelName=e?.modelName??this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}invocationParams(e){var t;return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stop,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:(t=e?.tools,void 0!==t&&t.every((e=>Array.isArray(e.lc_namespace)))?e?.tools.map(jr):e?.tools),tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){const n=$r(e),s={...this.invocationParams(t),messages:n,stream:!0};let a;const i=await this.completionWithRetry(s,t);for await(const e of i){const n=e?.choices[0];if(!n)continue;const{delta:s}=n;if(!s)continue;const i=Zr(s,a);a=s.role??a;const o={prompt:t.promptIndex??0,completion:n.index??0};if("string"!=typeof i.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const c=new nr({message:i,text:i.content,generationInfo:o});yield c,r?.handleLLMNewToken(c.text??"",o,void 0,void 0,void 0,{chunk:c})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){const n={},s=this.invocationParams(t),a=$r(e);if(s.stream){const s=this._streamResponseChunks(e,t,r),a={};for await(const e of s){const t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}const i=Object.entries(a).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t)),{functions:o,function_call:c}=this.invocationParams(t),l=await this.getEstimatedTokenCountFromPrompt(e,o,c),u=await this.getNumTokensFromGenerations(i);return n.promptTokens=l,n.completionTokens=u,n.totalTokens=l+u,{generations:i,llmOutput:{estimatedTokenUsage:n}}}{const e=await this.completionWithRetry({...s,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:r,prompt_tokens:o,total_tokens:c}=e?.usage??{};r&&(n.completionTokens=(n.completionTokens??0)+r),o&&(n.promptTokens=(n.promptTokens??0)+o),c&&(n.totalTokens=(n.totalTokens??0)+c);const l=[];for(const t of e?.choices??[]){const e={text:t.message?.content??"",message:(i=t.message??{role:"assistant"},"assistant"===i.role?new er.gY(i.content||"",{function_call:i.function_call,tool_calls:i.tool_calls}):new er.J(i.content||"",i.role??"unknown"))};e.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},l.push(e)}return{generations:l,llmOutput:{tokenUsage:n}}}var i}async getEstimatedTokenCountFromPrompt(e,t,r){let n=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==r){const e=function(e){const t=["namespace functions {",""];for(const r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(Sr(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);n+=await this.getNumTokens(e),n+=9}return t&&e.find((e=>"system"===e._getType()))&&(n-=4),"none"===r?n+=1:"object"==typeof r&&(n+=await this.getNumTokens(r.name)+4),n}async getNumTokensFromGenerations(e){return(await Promise.all(e.map((async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content))))).reduce(((e,t)=>e+t),0)}async getNumTokensFromMessages(e){let t=0,r=0,n=0;"gpt-3.5-turbo-0301"===this.modelName?(r=4,n=-1):(r=3,n=1);const s=await Promise.all(e.map((async e=>{const s=await this.getNumTokens(e.content),a=await this.getNumTokens(Rr(e)),i=void 0!==e.name?n+await this.getNumTokens(e.name):0;let o=s+r+a+i;const c=e;return"function"===c._getType()&&(o-=2),c.additional_kwargs?.function_call&&(o+=3),c?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(c.additional_kwargs.function_call?.name)),c.additional_kwargs.function_call?.arguments&&(o+=await this.getNumTokens(JSON.stringify(JSON.parse(c.additional_kwargs.function_call?.arguments)))),t+=o,o})));return t+=3,{totalCount:t,countPerMessage:s}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,r)}catch(e){const t=function(e){let t;return e.constructor.name===Bt.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===zt.name?(t=new Error(e.message),t.name="AbortError"):t=e,t}(e);throw t}}))}_getClientOptions(e){if(!this.client){const e=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:a}=e;if(n&&s&&t)return`${s}/${t}`;if(n){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return a}({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new Lt(t)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}r(4190)},4190:(e,t,r)=>{"use strict";function n({oldEntrypointName:e,newEntrypointName:t,newPackageName:r="@langchain/community"}){let n="";void 0===t?n=`/${e}`:""!==t&&(n=`/${t}`);let s=[`[WARNING]: Importing from "langchain/${e}" is deprecated.`,"",`Instead, please add the "${r}" package to your project with e.g.`,"",`    $ npm install ${r}`,"",`and import from "${r}${n}".`,"",'This will be mandatory after the next "langchain" minor version bump to 0.2.'].join("\n");"@langchain/core"===r&&(s=[`[WARNING]: Importing from "langchain/${e}" is deprecated.`,"",`Instead, please import from "${r}${n}".`,"",'This will be mandatory after the next "langchain" minor version bump to 0.2.'].join("\n")),console.warn(s)}r.d(t,{m:()=>n})},7570:(e,t,r)=>{"use strict";r.d(t,{Pf:()=>n.PromptTemplate}),r(4190),r(619),r(9242),r(7315);var n=r(1214);r(1307),r(7327),r(1141),r(6141)}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={id:e,loaded:!1,exports:{}};return s[e].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i.a=(s,a,i)=>{var o;i&&((o=[]).d=1);var c,l,u,d=new Set,h=s.exports,p=new Promise(((e,t)=>{u=t,l=e}));p[t]=h,p[e]=e=>(o&&e(o),d.forEach(e),p.catch((e=>{}))),s.exports=p,a((s=>{var a;c=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[e])return s;if(s.then){var a=[];a.d=0,s.then((e=>{i[t]=e,n(a)}),(e=>{i[r]=e,n(a)}));var i={};return i[e]=e=>e(a),i}}var o={};return o[e]=e=>{},o[t]=s,o})))(s);var i=()=>c.map((e=>{if(e[r])throw e[r];return e[t]})),l=new Promise((t=>{(a=()=>t(i)).r=0;var r=e=>e!==o&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)));c.map((t=>t[e](r)))}));return a.r?l:i()}),(e=>(e?u(p[r]=e):l(h),n(o)))),o&&(o.d=0)},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),i(8138)})();